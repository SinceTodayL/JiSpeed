import{aD as q,d as B,aJ as U,m as te,r as f,n as O,$ as r,a as V,a6 as J,b as I,o as p,f as n,w as o,e as l,h as v,s as L,q as oe,B as E,g as w,t as h,Y as ne,z as T,L as Q,c as P,v as k,aK as le,_ as Y,F as G,C as H,bQ as se,c6 as ie,c7 as re}from"./index-Bzxd5AZU.js";import{f as ce,u as ue}from"./merchant-CLPTxSKU.js";import{_ as W}from"./Spin-vB0L5ALT.js";import{a as X,_ as Z}from"./FormItem-DfEbt8I2.js";import{_ as pe}from"./Alert-CiEQzoMz.js";function de($,m){return q({url:`/api/merchants/${$}/applications`,method:"post",data:{CompanyName:m.companyName,ApplicationMaterials:m.applicationMaterials}})}function me($,m){return q({url:`/api/merchants/${$}/applications`,method:"get",params:m})}const fe={class:"profile-info-container"},_e={class:"max-w-600px"},ge={class:"flex gap-12px"},ve=B({name:"ProfileInfo",__name:"profile-info",setup($,{expose:m}){const c=U();te();const N=f(null),y=f(!1),_=f(!1),a=O({merchantName:"",status:1,contactInfo:"",location:""}),s=f({merchantName:"",status:1,contactInfo:"",location:""}),F=f(!1),A={merchantName:[{required:!0,message:r("page.profile.merchantNamePlaceholder"),trigger:"blur"}],location:[{required:!0,message:r("page.profile.locationPlaceholder"),trigger:"blur"}],contactInfo:[{required:!0,message:r("page.profile.contactInfoPlaceholder"),trigger:"blur"}]},g=[{label:r("page.profile.statusActive"),value:1},{label:r("page.profile.statusInactive"),value:0}],M=V(()=>a.merchantName!==s.value.merchantName||a.status!==s.value.status||a.contactInfo!==s.value.contactInfo||a.location!==s.value.location),d=async()=>{try{if(y.value=!0,console.log("å¼€å§‹èŽ·å–å•†å®¶ä¿¡æ¯"),console.log("merchantId:",c.merchantId),!c.merchantId){console.error("merchantId ä¸ºç©ºï¼Œæ— æ³•è°ƒç”¨API"),window.$message?.error("å•†å®¶IDæœªæ‰¾åˆ°ï¼Œè¯·é‡æ–°ç™»å½•");return}const t=await ce(c.merchantId);console.log("ðŸ”™ APIå®Œæ•´è¿”å›žç»“æžœ:",JSON.stringify(t,null,2));let e=null;if(t?.data?.data?(e=t.data.data,console.log("ä½¿ç”¨åµŒå¥—æ•°æ®ç»“æž„ result.data.data:",e)):t?.data?(e=t.data,console.log("ä½¿ç”¨ç›´æŽ¥æ•°æ®ç»“æž„ result.data:",e)):t&&typeof t=="object"&&(e=t,console.log("ä½¿ç”¨åŽŸå§‹è¿”å›žæ•°æ®:",e)),e&&typeof e=="object"){console.log("æ‰¾åˆ°å•†å®¶æ•°æ®:",e);const u={merchantName:e.merchantName||"",status:e.status??1,contactInfo:e.contactInfo||"",location:e.location||""};console.log("ðŸ”§ å‡†å¤‡æ›´æ–°è¡¨å•æ•°æ®:",u),await ne(),a.merchantName=u.merchantName,a.status=u.status,a.contactInfo=u.contactInfo,a.location=u.location,console.log("ðŸ“ è¡¨å•æ•°æ®å·²æ›´æ–°:",{merchantName:a.merchantName,status:a.status,contactInfo:a.contactInfo,location:a.location}),s.value.merchantName=u.merchantName,s.value.status=u.status,s.value.contactInfo=u.contactInfo,s.value.location=u.location,F.value=!0,c.setMerchantInfo(e),console.log("æ•°æ®åŠ è½½å®Œæˆï¼Œè¡¨å•å·²å¡«å……")}else console.error("æœªæ‰¾åˆ°æœ‰æ•ˆçš„å•†å®¶æ•°æ®"),console.log("å®Œæ•´APIå“åº”:",t),window.$message?.warning("èŽ·å–åˆ°çš„å•†å®¶ä¿¡æ¯æ ¼å¼ä¸æ­£ç¡®")}catch(t){console.error("èŽ·å–å•†å®¶ä¿¡æ¯å¤±è´¥:",t),window.$message?.error(r("page.profile.loadFailed"))}finally{y.value=!1}},S=async()=>{try{await N.value?.validate(),_.value=!0;const t={};a.merchantName!==s.value.merchantName&&(t.merchantName=a.merchantName),a.status!==s.value.status&&(t.status=a.status),a.contactInfo!==s.value.contactInfo&&(t.contactInfo=a.contactInfo),a.location!==s.value.location&&(t.location=a.location);const e=await ue(c.merchantId,t);e?.data&&(Object.assign(s.value,a),c.setMerchantInfo(e.data),window.$message?.success(r("page.profile.updateSuccess")))}catch(t){console.error("æ›´æ–°å•†å®¶ä¿¡æ¯å¤±è´¥:",t),window.$message?.error(r("page.profile.updateFailed"))}finally{_.value=!1}},z=()=>{Object.assign(a,s.value)};return m({loadMerchantInfo:d}),J(async()=>{if(!c.merchantId){window.$message?.warning("å•†å®¶IDæœªæ‰¾åˆ°ï¼Œè¯·é‡æ–°ç™»å½•");return}await d()}),(t,e)=>{const u=L,x=Z,R=oe,C=E,D=X,j=W;return p(),I("div",fe,[n(j,{show:y.value},{default:o(()=>[l("div",_e,[n(D,{ref_key:"formRef",ref:N,model:a,rules:A,"label-placement":"left","label-width":"120",class:"profile-form"},{default:o(()=>[n(x,{label:v(r)("page.profile.merchantName"),path:"merchantName"},{default:o(()=>[n(u,{value:a.merchantName,"onUpdate:value":e[0]||(e[0]=b=>a.merchantName=b),placeholder:v(r)("page.profile.merchantNamePlaceholder"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(x,{label:v(r)("page.profile.status"),path:"status"},{default:o(()=>[n(R,{value:a.status,"onUpdate:value":e[1]||(e[1]=b=>a.status=b),options:g,placeholder:v(r)("page.profile.status")},null,8,["value","placeholder"])]),_:1},8,["label"]),n(x,{label:v(r)("page.profile.contactInfo"),path:"contactInfo"},{default:o(()=>[n(u,{value:a.contactInfo,"onUpdate:value":e[2]||(e[2]=b=>a.contactInfo=b),placeholder:v(r)("page.profile.contactInfoPlaceholder"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(x,{label:v(r)("page.profile.location"),path:"location"},{default:o(()=>[n(u,{value:a.location,"onUpdate:value":e[3]||(e[3]=b=>a.location=b),placeholder:v(r)("page.profile.locationPlaceholder"),type:"textarea",rows:3,clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(x,{class:"form-actions"},{default:o(()=>[l("div",ge,[n(C,{type:"primary",loading:_.value,disabled:!M.value,onClick:S},{default:o(()=>[w(h(v(r)("page.profile.save")),1)]),_:1},8,["loading","disabled"]),n(C,{disabled:!M.value||_.value,onClick:z},{default:o(()=>[w(h(v(r)("page.profile.cancel")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model"])])]),_:1},8,["show"])])}}}),he=T(ve,[["__scopeId","data-v-a9e27115"]]),ye={class:"application-form-container"},be={class:"mb-24px"},Ie={class:"flex gap-12px"},Ne={class:"flex items-center justify-between mb-16px"},we={key:0,class:"space-y-20px"},xe={class:"flex items-start justify-between gap-16px"},ke={class:"flex-1 min-w-0"},$e={class:"text-18px font-semibold text-gray-800 mb-4px"},Ae={class:"text-12px text-gray-500"},Me={class:"application-content"},Se={class:"info-section"},Ce={class:"info-grid"},Pe={class:"info-item"},Fe={class:"info-value"},Re={key:0,class:"info-item"},ze={class:"info-value"},De={key:1,class:"info-item"},je={class:"info-value"},Be={key:0,class:"info-section"},Te={class:"content-box content-normal"},qe={key:1,class:"info-section"},Ue={class:"content-box content-error"},Oe=B({name:"ApplicationForm",__name:"application-form",setup($,{expose:m}){const c=U(),N=f(null),y=f(!1),_=f(!1),a=O({companyName:"",applicationMaterials:""}),s=f([]),F={companyName:[{required:!0,message:"è¯·è¾“å…¥å…¬å¸åç§°",trigger:"blur"},{min:2,max:100,message:"å…¬å¸åç§°é•¿åº¦åº”ä¸º2-100ä¸ªå­—ç¬¦",trigger:"blur"}],applicationMaterials:[{required:!0,message:"è¯·è¾“å…¥ç”³è¯·ç†ç”±",trigger:"blur"},{min:10,max:1e3,message:"ç”³è¯·ç†ç”±é•¿åº¦åº”ä¸º10-1000ä¸ªå­—ç¬¦",trigger:"blur"}]},A={0:{label:"å¾…å®¡æ ¸",type:"info"},1:{label:"å·²é€šè¿‡",type:"success"},2:{label:"å·²æ‹’ç»",type:"error"}},g=V(()=>!s.value.some(t=>t.auditStatus==="0")),M=async()=>{try{if(await N.value?.validate(),!c.merchantId){window.$message?.error("å•†å®¶IDæœªæ‰¾åˆ°ï¼Œè¯·é‡æ–°ç™»å½•");return}if(!g.value){window.$message?.warning("æ‚¨æœ‰å¾…å®¡æ ¸çš„ç”³è¯·ï¼Œè¯·ç­‰å¾…å®¡æ ¸ç»“æžœåŽå†æäº¤æ–°ç”³è¯·");return}y.value=!0,(await de(c.merchantId,{companyName:a.companyName,applicationMaterials:a.applicationMaterials}))?.data&&(window.$message?.success("ç”³è¯·æäº¤æˆåŠŸï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸"),a.companyName="",a.applicationMaterials="",console.log("ç”³è¯·æäº¤æˆåŠŸ !"),await S())}catch(t){console.error("æäº¤ç”³è¯·å¤±è´¥:",t),window.$message?.error("æäº¤ç”³è¯·å¤±è´¥ï¼Œè¯·ç¨åŽå†è¯•")}finally{y.value=!1}},d=()=>{a.companyName="",a.applicationMaterials=""},S=async()=>{try{if(!c.merchantId){console.warn("merchantId ä¸ºç©ºï¼Œæ— æ³•åŠ è½½ç”³è¯·åˆ—è¡¨");return}_.value=!0,console.log("å¼€å§‹èŽ·å–ç”³è¯·åˆ—è¡¨, merchantId:",c.merchantId);const t=await me(c.merchantId,{size:20,page:1});console.log("APIå®Œæ•´è¿”å›žç»“æžœ:",JSON.stringify(t,null,2));const e=t;e?.data&&Array.isArray(e.data)?s.value=e.data:(console.warn("APIè¿”å›žæ•°æ®æ ¼å¼å¼‚å¸¸:",t),console.log("æ£€æŸ¥æ•°æ®è·¯å¾„ result.data:",e?.data),console.log("æ•°æ®ç±»åž‹:",typeof e?.data,"is Array:",Array.isArray(e?.data)),s.value=[])}catch(t){console.error("åŠ è½½ç”³è¯·åˆ—è¡¨å¤±è´¥:",t),window.$message?.error("åŠ è½½ç”³è¯·åˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"),s.value=[]}finally{_.value=!1}},z=t=>new Date(t).toLocaleString("zh-CN");return m({loadApplications:S}),J(async()=>{console.log("ç”³è¯·è¡¨å•ç»„ä»¶æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½ç”³è¯·åˆ—è¡¨..."),await S()}),(t,e)=>{const u=le,x=L,R=Z,C=E,D=X,j=pe,b=Q,K=Y,ee=se,ae=W;return p(),I("div",ye,[l("div",be,[e[7]||(e[7]=l("h3",{class:"text-18px font-semibold mb-16px"},"å•†å®¶ç»è¥èµ„æ ¼ç”³è¯·",-1)),n(b,{title:"æäº¤æ–°ç”³è¯·",bordered:!0,size:"small"},{"header-extra":o(()=>[g.value?k("",!0):(p(),P(u,{key:0,type:"warning",size:"small"},{default:o(()=>e[2]||(e[2]=[w(" æœ‰å¾…å®¡æ ¸ç”³è¯· ")])),_:1,__:[2]}))]),default:o(()=>[n(D,{ref_key:"formRef",ref:N,model:a,rules:F,"label-placement":"left","label-width":"120",class:"application-form"},{default:o(()=>[n(R,{label:"å…¬å¸åç§°",path:"companyName"},{default:o(()=>[n(x,{value:a.companyName,"onUpdate:value":e[0]||(e[0]=i=>a.companyName=i),placeholder:"è¯·è¾“å…¥å…¬å¸åç§°",disabled:!g.value,clearable:""},null,8,["value","disabled"])]),_:1}),n(R,{label:"ç”³è¯·ç†ç”±",path:"applicationMaterials"},{default:o(()=>[n(x,{value:a.applicationMaterials,"onUpdate:value":e[1]||(e[1]=i=>a.applicationMaterials=i),placeholder:"è¯·è¯¦ç»†è¯´æ˜Žæ‚¨çš„ç”³è¯·ç†ç”±ï¼ŒåŒ…æ‹¬ä¸šåŠ¡èŒƒå›´ã€è¿è¥è®¡åˆ’ç­‰",type:"textarea",rows:4,disabled:!g.value,clearable:""},null,8,["value","disabled"])]),_:1}),n(R,null,{default:o(()=>[l("div",Ie,[n(C,{type:"primary",loading:y.value,disabled:!g.value,onClick:M},{default:o(()=>e[3]||(e[3]=[w(" æäº¤ç”³è¯· ")])),_:1,__:[3]},8,["loading","disabled"]),n(C,{disabled:y.value||!g.value,onClick:d},{default:o(()=>e[4]||(e[4]=[w(" é‡ç½®è¡¨å• ")])),_:1,__:[4]},8,["disabled"])])]),_:1})]),_:1},8,["model"]),g.value?k("",!0):(p(),P(j,{key:0,type:"warning","show-icon":"",class:"mt-16px"},{header:o(()=>e[5]||(e[5]=[w("æ¸©é¦¨æç¤º")])),default:o(()=>[e[6]||(e[6]=w(" æ‚¨å½“å‰æœ‰å¾…å®¡æ ¸çš„ç”³è¯·ï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ç»“æžœåŽå†æäº¤æ–°ç”³è¯·ã€‚ "))]),_:1,__:[6]}))]),_:1})]),l("div",null,[l("div",Ne,[e[9]||(e[9]=l("h3",{class:"text-18px font-semibold"},"ç”³è¯·è®°å½•",-1)),n(C,{size:"small",type:"primary",loading:_.value,onClick:S},{icon:o(()=>[n(K,{icon:"mdi:refresh"})]),default:o(()=>[e[8]||(e[8]=w(" åˆ·æ–°è®°å½• "))]),_:1,__:[8]},8,["loading"])]),n(ae,{show:_.value},{default:o(()=>[s.value.length>0?(p(),I("div",we,[(p(!0),I(G,null,H(s.value,i=>(p(),P(b,{key:i.applyId,bordered:!0,size:"medium",class:"application-record"},{header:o(()=>[l("div",xe,[l("div",ke,[l("h4",$e,h(i.companyName),1),l("p",Ae,"ç”³è¯·ID: "+h(i.applyId),1)]),n(u,{type:A[i.auditStatus]?.type,size:"medium"},{default:o(()=>[w(h(A[i.auditStatus]?.label),1)]),_:2},1032,["type"])])]),default:o(()=>[l("div",Me,[l("div",Se,[e[13]||(e[13]=l("h5",{class:"section-title"},"åŸºæœ¬ä¿¡æ¯",-1)),l("div",Ce,[l("div",Pe,[e[10]||(e[10]=l("span",{class:"info-label"},"æäº¤æ—¶é—´",-1)),l("span",Fe,h(z(i.submittedAt)),1)]),i.auditAt?(p(),I("div",Re,[e[11]||(e[11]=l("span",{class:"info-label"},"å®¡æ ¸æ—¶é—´",-1)),l("span",ze,h(z(i.auditAt)),1)])):k("",!0),i.adminId?(p(),I("div",De,[e[12]||(e[12]=l("span",{class:"info-label"},"å®¡æ ¸ç®¡ç†å‘˜",-1)),l("span",je,h(i.adminId),1)])):k("",!0)])]),i.applicationMaterials?(p(),I("div",Be,[e[14]||(e[14]=l("h5",{class:"section-title"},"ç”³è¯·ç†ç”±",-1)),l("div",Te,h(i.applicationMaterials),1)])):k("",!0),i.rejectReason&&i.auditStatus==="2"?(p(),I("div",qe,[e[15]||(e[15]=l("h5",{class:"section-title text-red-600"},"æ‹’ç»åŽŸå› ",-1)),l("div",Ue,h(i.rejectReason),1)])):k("",!0)])]),_:2},1024))),128))])):(p(),P(ee,{key:1,description:"æš‚æ— ç”³è¯·è®°å½•",class:"py-40px"}))]),_:1},8,["show"])])])}}}),Ve=T(Oe,[["__scopeId","data-v-9256667c"]]),Je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Le={class:"flex items-center gap-8px"},Ee=B({name:"profile",__name:"index",setup($){const m=f("profile"),c=f(),N=f(),y=[{key:"profile",label:"æˆ‘çš„ä¿¡æ¯",icon:"mdi:account-circle"},{key:"application",label:"å…¥é©»ç”³è¯·",icon:"mdi:file-document-edit"}],_=a=>{m.value=a,a==="profile"&&c.value?(console.log("ðŸ”„ åˆ‡æ¢åˆ°æˆ‘çš„ä¿¡æ¯é¡µé¢ï¼Œåˆ·æ–°å•†å®¶ä¿¡æ¯..."),c.value.loadMerchantInfo?.()):a==="application"&&N.value&&(console.log("ðŸ”„ åˆ‡æ¢åˆ°å…¥é©»ç”³è¯·é¡µé¢ï¼Œåˆ·æ–°ç”³è¯·åˆ—è¡¨..."),N.value.loadApplications?.())};return(a,s)=>{const F=Y,A=re,g=ie,M=Q;return p(),I("div",Je,[n(M,{title:v(r)("page.profile.title"),bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[n(g,{value:m.value,"onUpdate:value":[s[0]||(s[0]=d=>m.value=d),_],type:"line",animated:""},{default:o(()=>[(p(),I(G,null,H(y,d=>n(A,{key:d.key,name:d.key,tab:d.label},{tab:o(()=>[l("div",Le,[n(F,{icon:d.icon,class:"text-16px"},null,8,["icon"]),l("span",null,h(d.label),1)])]),default:o(()=>[d.key==="profile"?(p(),P(he,{key:0,ref_for:!0,ref_key:"profileInfoRef",ref:c},null,512)):k("",!0),d.key==="application"?(p(),P(Ve,{key:1,ref_for:!0,ref_key:"applicationFormRef",ref:N},null,512)):k("",!0)]),_:2},1032,["name","tab"])),64))]),_:1},8,["value"])]),_:1},8,["title"])])}}}),Xe=T(Ee,[["__scopeId","data-v-b46f504b"]]);export{Xe as default};
