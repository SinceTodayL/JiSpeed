import{at as v,d as b,m as R,aw as T,r as g,n as N,aj as $,b as z,o as E,f as a,w as m,e as r,h as d,K as I,N as B,B as h,g as l,aA as C,aS as j,y as F}from"./index-BAcIoLG0.js";import{N as M,a as y}from"./Popconfirm-DY2152Ng.js";import{N as O}from"./Space-Dst7QrTu.js";import"./RadioGroup-DJUe5P8e.js";function U(o,n){const u=new URLSearchParams;n?.size&&u.append("size",n.size.toString()),n?.page&&u.append("page",n.page.toString()),n?.auditStatus!==void 0&&u.append("auditStatus",n.auditStatus.toString());const i=u.toString(),c=`/api/merchants/${o}/refunds${i?`?${i}`:""}`;return v({url:c,method:"get"})}function K(o,n){return v({url:`/api/merchants/${o}/refunds/${n}/approve`,method:"patch",data:{}})}function V(o,n){return v({url:`/api/merchants/${o}/refunds/${n}/reject`,method:"patch"})}const q={1:"待处理",2:"已同意",3:"已拒绝"};function G(o){return q[o]||"未知状态"}const J={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden <sm:overflow-auto"},L={class:"mb-4"},Q={class:"flex items-center gap-4"},W={class:"mb-4"};function H(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!j(o)}const X=b({name:"refund-management",__name:"index",setup(o){R();const n=T(),u=g([]),i=g(!1),c=g([]),f=N({auditStatus:null}),w=g([]),S=[{label:"全部",value:null},{label:"待处理",value:1},{label:"已同意",value:2},{label:"已拒绝",value:3}],p=async()=>{i.value=!0;try{if(console.log("开始获取退款申请数据，商家ID:",n.merchantId),!n.merchantId){console.warn("商家ID为空，无法获取退款数据"),i.value=!1;return}const t=await U(n.merchantId,{auditStatus:f.auditStatus||void 0});console.log("获取到退款申请ID列表:",t);const e=t?.data;if(Array.isArray(e)&&e.length>0){console.log("获取到退款申请ID:",e.length,"个"),console.error("缺少API：需要根据退款ID获取退款详情的接口");const s=e.map(P=>({refundId:P,orderId:"未知订单ID - 需要API",userId:"未知用户ID - 需要API",merchantId:n.merchantId,refundAmount:0,refundReason:"无法获取 - 需要退款详情API",auditStatus:f.auditStatus||1,createTime:"无法获取 - 需要API",updateTime:"无法获取 - 需要API"}));c.value=s,u.value=[...s],window.$message?.warning("缺少退款详情API，无法显示完整信息")}else console.log("没有找到退款申请数据"),c.value=[],u.value=[]}catch(t){console.error("获取退款申请数据失败:",t);let e="获取退款数据失败，请稍后重试";const s=t;s?.response?.status===401?e="认证失败，请重新登录":s?.response?.status===403?e="权限不足，无法访问退款数据":s?.response?.status===404?e="API端点不存在，请检查后端服务状态":s?.code==="ERR_NETWORK"&&(e="网络连接失败，请检查后端服务是否运行"),window.$message?.error(e),c.value=[],u.value=[]}finally{i.value=!1}},A=async t=>{try{await K(n.merchantId,t)&&(window.$message?.success("退款申请已同意"),await p())}catch(e){console.error("同意退款失败:",e),window.$message?.error("同意退款失败，请重试")}},x=async t=>{try{await V(n.merchantId,t)&&(window.$message?.success("退款申请已拒绝"),await p())}catch(e){console.error("拒绝退款失败:",e),window.$message?.error("拒绝退款失败，请重试")}},k=()=>{p()},_=()=>{f.auditStatus=null,p()},D=[{type:"selection",disabled(t){return t.auditStatus!==1}},{key:"index",title:"序号",width:60,render:(t,e)=>e+1},{key:"refundId",title:"退款申请ID",width:200,ellipsis:{tooltip:!0}},{key:"orderId",title:"关联订单ID",width:200,ellipsis:{tooltip:!0},render:t=>a("span",{class:"text-orange-500"},[t.orderId==="未知订单ID - 需要API"?"⚠️ 需要API":t.orderId])},{key:"refundAmount",title:"退款金额",width:120,render:t=>a("span",{class:"text-green-600 font-semibold"},[t.refundAmount===0?"⚠️ 需要API":`¥${t.refundAmount.toFixed(2)}`])},{key:"refundReason",title:"退款理由",width:200,ellipsis:{tooltip:!0},render:t=>a("span",{class:t.refundReason.includes("需要API")?"text-orange-500":""},[t.refundReason])},{key:"auditStatus",title:"审核状态",width:100,render:t=>{const e=G(t.auditStatus);let s="default";switch(t.auditStatus){case 1:s="warning";break;case 2:s="success";break;case 3:s="error";break}return a(C,{type:s},H(e)?e:{default:()=>[e]})}},{key:"createTime",title:"申请时间",width:180,render:t=>a("span",{class:t.createTime.includes("需要API")?"text-orange-500":""},[t.createTime])},{key:"operate",title:"操作",width:200,render:t=>t.auditStatus!==1?a("span",{class:"text-gray-400"},[l("已处理")]):a(O,{size:8},{default:()=>[a(y,{onPositiveClick:()=>A(t.refundId),positiveText:"确认同意",negativeText:"取消"},{default:()=>"确认同意此退款申请？",trigger:()=>a(h,{size:"small",type:"success",ghost:!0},{default:()=>[l("同意退款")]})}),a(y,{onPositiveClick:()=>x(t.refundId),positiveText:"确认拒绝",negativeText:"取消"},{default:()=>"确认拒绝此退款申请？",trigger:()=>a(h,{size:"small",type:"error",ghost:!0},{default:()=>[l("拒绝退款")]})})]})}];return $(()=>{p()}),(t,e)=>(E(),z("div",J,[a(d(I),{title:"退款管理",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:m(()=>[r("div",L,[a(d(I),{bordered:!1,size:"small"},{default:m(()=>[r("div",Q,[a(d(B),{value:f.auditStatus,"onUpdate:value":e[0]||(e[0]=s=>f.auditStatus=s),options:S,placeholder:"审核状态",clearable:"",class:"w-200px"},null,8,["value"]),a(d(h),{type:"primary",onClick:k},{default:m(()=>e[2]||(e[2]=[l(" 搜索 ")])),_:1,__:[2]}),a(d(h),{onClick:_},{default:m(()=>e[3]||(e[3]=[l(" 重置 ")])),_:1,__:[3]})])]),_:1})]),r("div",W,[a(d(I),{bordered:!0,size:"small"},{default:m(()=>e[4]||(e[4]=[r("div",{class:"text-orange-600"},[r("div",{class:"font-semibold mb-2"},"⚠️ API 缺失提醒："),r("ul",{class:"list-disc list-inside space-y-1 text-sm"},[r("li",null,[r("strong",null,"缺少API："),l("GET /api/refunds/{refundId} - 获取单个退款申请详情")]),r("li",null,[r("strong",null,"或者："),l("POST /api/refunds/batch - 批量获取退款申请详情")]),r("li",null,[r("strong",null,"影响："),l("无法显示退款金额、申请理由、关联订单、申请时间等信息")]),r("li",null,[r("strong",null,"建议："),l("请联系后端开发人员添加获取退款详情的API接口")])])],-1)])),_:1,__:[4]})]),a(d(M),{"checked-row-keys":w.value,"onUpdate:checkedRowKeys":e[1]||(e[1]=s=>w.value=s),columns:D,data:u.value,size:"small",loading:i.value,"row-key":s=>s.refundId,pagination:{pageSize:20,showSizePicker:!0,showQuickJumper:!0,pageSizes:[10,20,50,100]},"single-line":!1,class:"sm:h-320px"},null,8,["checked-row-keys","data","loading","row-key"])]),_:1})]))}}),se=F(X,[["__scopeId","data-v-41c001cd"]]);export{se as default};
