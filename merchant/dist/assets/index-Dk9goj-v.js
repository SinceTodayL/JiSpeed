import{at as q,d as T,aw as O,m as te,r as f,n as U,$ as r,a as V,aj as E,b as N,o as d,f as n,w as o,e as l,h,q as J,N as oe,B as L,g as x,t as y,aO as ne,y as B,K as Q,c as P,s as k,aA as le,_ as G,F as H,A as W,aQ as se,bg as ie,bh as re}from"./index-D6ldqbnU.js";import{f as ce,u as ue}from"./merchant-Z65Hux2M.js";import{_ as X}from"./Spin-BLgfA2f8.js";import{a as Y,_ as Z}from"./FormItem-Y94Aopc1.js";import{_ as de}from"./Alert-DSGiC-EM.js";function pe(A,m){return q({url:`/api/merchants/${A}/applications`,method:"post",data:{CompanyName:m.companyName,ApplicationMaterials:m.applicationMaterials}})}function me(A,m){return q({url:`/api/merchants/${A}/applications`,method:"get",params:m})}const fe={class:"profile-info-container"},_e={class:"max-w-600px"},ge={class:"flex gap-12px"},ve=T({name:"ProfileInfo",__name:"profile-info",setup(A,{expose:m}){const u=O();te();const w=f(null),b=f(!1),_=f(!1),a=U({merchantName:"",status:1,contactInfo:"",location:""}),s=f({merchantName:"",status:1,contactInfo:"",location:""}),F=f(!1),$={merchantName:[{required:!0,message:r("page.profile.merchantNamePlaceholder"),trigger:"blur"}],location:[{required:!0,message:r("page.profile.locationPlaceholder"),trigger:"blur"}],contactInfo:[{required:!0,message:r("page.profile.contactInfoPlaceholder"),trigger:"blur"}]},g=[{label:r("page.profile.statusActive"),value:1},{label:r("page.profile.statusInactive"),value:0}],M=V(()=>a.merchantName!==s.value.merchantName||a.status!==s.value.status||a.contactInfo!==s.value.contactInfo||a.location!==s.value.location),p=async()=>{try{if(b.value=!0,console.log("开始获取商家信息"),console.log("merchantId:",u.merchantId),!u.merchantId){console.error("merchantId 为空，无法调用API"),window.$message?.error("商家ID未找到，请重新登录");return}const t=await ce(u.merchantId);console.log("🔙 API完整返回结果:",JSON.stringify(t,null,2));let e=null;const v=t;if(v?.data?.data?(e=v.data.data,console.log("使用嵌套数据结构 result.data.data:",e)):v?.data?(e=v.data,console.log("使用直接数据结构 result.data:",e)):t&&typeof t=="object"&&(e=t,console.log("使用原始返回数据:",e)),e&&typeof e=="object"){console.log("找到商家数据:",e);const c={merchantName:e.merchantName||"",status:e.status??1,contactInfo:e.contactInfo||"",location:e.location||""};console.log("🔧 准备更新表单数据:",c),await ne(),a.merchantName=c.merchantName,a.status=c.status,a.contactInfo=c.contactInfo,a.location=c.location,console.log("📝 表单数据已更新:",{merchantName:a.merchantName,status:a.status,contactInfo:a.contactInfo,location:a.location}),s.value.merchantName=c.merchantName,s.value.status=c.status,s.value.contactInfo=c.contactInfo,s.value.location=c.location,F.value=!0,u.setMerchantInfo(e),console.log("数据加载完成，表单已填充")}else console.error("未找到有效的商家数据"),console.log("完整API响应:",t),window.$message?.warning("获取到的商家信息格式不正确")}catch(t){console.error("获取商家信息失败:",t),window.$message?.error(r("page.profile.loadFailed"))}finally{b.value=!1}},S=async()=>{try{await w.value?.validate(),_.value=!0;const t={};a.merchantName!==s.value.merchantName&&(t.merchantName=a.merchantName),a.status!==s.value.status&&(t.status=a.status),a.contactInfo!==s.value.contactInfo&&(t.contactInfo=a.contactInfo),a.location!==s.value.location&&(t.location=a.location);const e=await ue(u.merchantId,t);e?.data&&(Object.assign(s.value,a),u.setMerchantInfo(e.data),window.$message?.success(r("page.profile.updateSuccess")))}catch(t){console.error("更新商家信息失败:",t),window.$message?.error(r("page.profile.updateFailed"))}finally{_.value=!1}},j=()=>{Object.assign(a,s.value)};return m({loadMerchantInfo:p}),E(async()=>{if(!u.merchantId){window.$message?.warning("商家ID未找到，请重新登录");return}await p()}),(t,e)=>{const v=J,c=Z,R=oe,C=L,z=Y,D=X;return d(),N("div",fe,[n(D,{show:b.value},{default:o(()=>[l("div",_e,[n(z,{ref_key:"formRef",ref:w,model:a,rules:$,"label-placement":"left","label-width":"120",class:"profile-form"},{default:o(()=>[n(c,{label:h(r)("page.profile.merchantName"),path:"merchantName"},{default:o(()=>[n(v,{value:a.merchantName,"onUpdate:value":e[0]||(e[0]=I=>a.merchantName=I),placeholder:h(r)("page.profile.merchantNamePlaceholder"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(c,{label:h(r)("page.profile.status"),path:"status"},{default:o(()=>[n(R,{value:a.status,"onUpdate:value":e[1]||(e[1]=I=>a.status=I),options:g,placeholder:h(r)("page.profile.status")},null,8,["value","placeholder"])]),_:1},8,["label"]),n(c,{label:h(r)("page.profile.contactInfo"),path:"contactInfo"},{default:o(()=>[n(v,{value:a.contactInfo,"onUpdate:value":e[2]||(e[2]=I=>a.contactInfo=I),placeholder:h(r)("page.profile.contactInfoPlaceholder"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(c,{label:h(r)("page.profile.location"),path:"location"},{default:o(()=>[n(v,{value:a.location,"onUpdate:value":e[3]||(e[3]=I=>a.location=I),placeholder:h(r)("page.profile.locationPlaceholder"),type:"textarea",rows:3,clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(c,{class:"form-actions"},{default:o(()=>[l("div",ge,[n(C,{type:"primary",loading:_.value,disabled:!M.value,onClick:S},{default:o(()=>[x(y(h(r)("page.profile.save")),1)]),_:1},8,["loading","disabled"]),n(C,{disabled:!M.value||_.value,onClick:j},{default:o(()=>[x(y(h(r)("page.profile.cancel")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model"])])]),_:1},8,["show"])])}}}),he=B(ve,[["__scopeId","data-v-ba7f30ab"]]),ye={class:"application-form-container"},be={class:"mb-24px"},Ie={class:"flex gap-12px"},Ne={class:"flex items-center justify-between mb-16px"},we={key:0,class:"space-y-20px"},xe={class:"flex items-start justify-between gap-16px"},ke={class:"flex-1 min-w-0"},Ae={class:"text-18px font-semibold text-gray-800 mb-4px"},$e={class:"text-12px text-gray-500"},Me={class:"application-content"},Se={class:"info-section"},Ce={class:"info-grid"},Pe={class:"info-item"},Fe={class:"info-value"},Re={key:0,class:"info-item"},je={class:"info-value"},ze={key:1,class:"info-item"},De={class:"info-value"},Te={key:0,class:"info-section"},Be={class:"content-box content-normal"},qe={key:1,class:"info-section"},Oe={class:"content-box content-error"},Ue=T({name:"ApplicationForm",__name:"application-form",setup(A,{expose:m}){const u=O(),w=f(null),b=f(!1),_=f(!1),a=U({companyName:"",applicationMaterials:""}),s=f([]),F={companyName:[{required:!0,message:"请输入公司名称",trigger:"blur"},{min:2,max:100,message:"公司名称长度应为2-100个字符",trigger:"blur"}],applicationMaterials:[{required:!0,message:"请输入申请理由",trigger:"blur"},{min:10,max:1e3,message:"申请理由长度应为10-1000个字符",trigger:"blur"}]},$={0:{label:"待审核",type:"info"},1:{label:"已通过",type:"success"},2:{label:"已拒绝",type:"error"}},g=V(()=>!s.value.some(t=>t.auditStatus==="0")),M=async()=>{try{if(await w.value?.validate(),!u.merchantId){window.$message?.error("商家ID未找到，请重新登录");return}if(!g.value){window.$message?.warning("您有待审核的申请，请等待审核结果后再提交新申请");return}b.value=!0,(await pe(u.merchantId,{companyName:a.companyName,applicationMaterials:a.applicationMaterials}))?.data&&(window.$message?.success("申请提交成功，请等待管理员审核"),a.companyName="",a.applicationMaterials="",console.log("申请提交成功 !"),await S())}catch(t){console.error("提交申请失败:",t),window.$message?.error("提交申请失败，请稍后再试")}finally{b.value=!1}},p=()=>{a.companyName="",a.applicationMaterials=""},S=async()=>{try{if(!u.merchantId){console.warn("merchantId 为空，无法加载申请列表");return}_.value=!0,console.log("开始获取申请列表, merchantId:",u.merchantId);const t=await me(u.merchantId,{size:20,page:1});console.log("API完整返回结果:",JSON.stringify(t,null,2));const e=t;e?.data&&Array.isArray(e.data)?s.value=e.data:(console.warn("API返回数据格式异常:",t),console.log("检查数据路径 result.data:",e?.data),console.log("数据类型:",typeof e?.data,"is Array:",Array.isArray(e?.data)),s.value=[])}catch(t){console.error("加载申请列表失败:",t),window.$message?.error("加载申请列表失败，请稍后重试"),s.value=[]}finally{_.value=!1}},j=t=>new Date(t).toLocaleString("zh-CN");return m({loadApplications:S}),E(async()=>{console.log("申请表单组件挂载，开始加载申请列表..."),await S()}),(t,e)=>{const v=le,c=J,R=Z,C=L,z=Y,D=de,I=Q,K=G,ee=se,ae=X;return d(),N("div",ye,[l("div",be,[e[7]||(e[7]=l("h3",{class:"text-18px font-semibold mb-16px"},"商家经营资格申请",-1)),n(I,{title:"提交新申请",bordered:!0,size:"small"},{"header-extra":o(()=>[g.value?k("",!0):(d(),P(v,{key:0,type:"warning",size:"small"},{default:o(()=>e[2]||(e[2]=[x(" 有待审核申请 ")])),_:1,__:[2]}))]),default:o(()=>[n(z,{ref_key:"formRef",ref:w,model:a,rules:F,"label-placement":"left","label-width":"120",class:"application-form"},{default:o(()=>[n(R,{label:"公司名称",path:"companyName"},{default:o(()=>[n(c,{value:a.companyName,"onUpdate:value":e[0]||(e[0]=i=>a.companyName=i),placeholder:"请输入公司名称",disabled:!g.value,clearable:""},null,8,["value","disabled"])]),_:1}),n(R,{label:"申请理由",path:"applicationMaterials"},{default:o(()=>[n(c,{value:a.applicationMaterials,"onUpdate:value":e[1]||(e[1]=i=>a.applicationMaterials=i),placeholder:"请详细说明您的申请理由，包括业务范围、运营计划等",type:"textarea",rows:4,disabled:!g.value,clearable:""},null,8,["value","disabled"])]),_:1}),n(R,null,{default:o(()=>[l("div",Ie,[n(C,{type:"primary",loading:b.value,disabled:!g.value,onClick:M},{default:o(()=>e[3]||(e[3]=[x(" 提交申请 ")])),_:1,__:[3]},8,["loading","disabled"]),n(C,{disabled:b.value||!g.value,onClick:p},{default:o(()=>e[4]||(e[4]=[x(" 重置表单 ")])),_:1,__:[4]},8,["disabled"])])]),_:1})]),_:1},8,["model"]),g.value?k("",!0):(d(),P(D,{key:0,type:"warning","show-icon":"",class:"mt-16px"},{header:o(()=>e[5]||(e[5]=[x("温馨提示")])),default:o(()=>[e[6]||(e[6]=x(" 您当前有待审核的申请，请等待管理员审核结果后再提交新申请。 "))]),_:1,__:[6]}))]),_:1})]),l("div",null,[l("div",Ne,[e[9]||(e[9]=l("h3",{class:"text-18px font-semibold"},"申请记录",-1)),n(C,{size:"small",type:"primary",loading:_.value,onClick:S},{icon:o(()=>[n(K,{icon:"mdi:refresh"})]),default:o(()=>[e[8]||(e[8]=x(" 刷新记录 "))]),_:1,__:[8]},8,["loading"])]),n(ae,{show:_.value},{default:o(()=>[s.value.length>0?(d(),N("div",we,[(d(!0),N(H,null,W(s.value,i=>(d(),P(I,{key:i.applyId,bordered:!0,size:"medium",class:"application-record"},{header:o(()=>[l("div",xe,[l("div",ke,[l("h4",Ae,y(i.companyName),1),l("p",$e,"申请ID: "+y(i.applyId),1)]),n(v,{type:$[i.auditStatus]?.type,size:"medium"},{default:o(()=>[x(y($[i.auditStatus]?.label),1)]),_:2},1032,["type"])])]),default:o(()=>[l("div",Me,[l("div",Se,[e[13]||(e[13]=l("h5",{class:"section-title"},"基本信息",-1)),l("div",Ce,[l("div",Pe,[e[10]||(e[10]=l("span",{class:"info-label"},"提交时间",-1)),l("span",Fe,y(j(i.submittedAt)),1)]),i.auditAt?(d(),N("div",Re,[e[11]||(e[11]=l("span",{class:"info-label"},"审核时间",-1)),l("span",je,y(j(i.auditAt)),1)])):k("",!0),i.adminId?(d(),N("div",ze,[e[12]||(e[12]=l("span",{class:"info-label"},"审核管理员",-1)),l("span",De,y(i.adminId),1)])):k("",!0)])]),i.applicationMaterials?(d(),N("div",Te,[e[14]||(e[14]=l("h5",{class:"section-title"},"申请理由",-1)),l("div",Be,y(i.applicationMaterials),1)])):k("",!0),i.rejectReason&&i.auditStatus==="2"?(d(),N("div",qe,[e[15]||(e[15]=l("h5",{class:"section-title text-red-600"},"拒绝原因",-1)),l("div",Oe,y(i.rejectReason),1)])):k("",!0)])]),_:2},1024))),128))])):(d(),P(ee,{key:1,description:"暂无申请记录",class:"py-40px"}))]),_:1},8,["show"])])])}}}),Ve=B(Ue,[["__scopeId","data-v-9256667c"]]),Ee={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Je={class:"flex items-center gap-8px"},Le=T({name:"profile",__name:"index",setup(A){const m=f("profile"),u=f(),w=f(),b=[{key:"profile",label:"我的信息",icon:"mdi:account-circle"},{key:"application",label:"入驻申请",icon:"mdi:file-document-edit"}],_=a=>{m.value=a,a==="profile"&&u.value?(console.log("🔄 切换到我的信息页面，刷新商家信息..."),u.value.loadMerchantInfo?.()):a==="application"&&w.value&&(console.log("🔄 切换到入驻申请页面，刷新申请列表..."),w.value.loadApplications?.())};return(a,s)=>{const F=G,$=re,g=ie,M=Q;return d(),N("div",Ee,[n(M,{title:h(r)("page.profile.title"),bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[n(g,{value:m.value,"onUpdate:value":[s[0]||(s[0]=p=>m.value=p),_],type:"line",animated:""},{default:o(()=>[(d(),N(H,null,W(b,p=>n($,{key:p.key,name:p.key,tab:p.label},{tab:o(()=>[l("div",Je,[n(F,{icon:p.icon,class:"text-16px"},null,8,["icon"]),l("span",null,y(p.label),1)])]),default:o(()=>[p.key==="profile"?(d(),P(he,{key:0,ref_for:!0,ref_key:"profileInfoRef",ref:u},null,512)):k("",!0),p.key==="application"?(d(),P(Ve,{key:1,ref_for:!0,ref_key:"applicationFormRef",ref:w},null,512)):k("",!0)]),_:2},1032,["name","tab"])),64))]),_:1},8,["value"])]),_:1},8,["title"])])}}}),Ye=B(Le,[["__scopeId","data-v-b46f504b"]]);export{Ye as default};
