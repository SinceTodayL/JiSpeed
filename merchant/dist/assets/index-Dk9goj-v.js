import{at as q,d as T,aw as O,m as te,r as f,n as U,$ as r,a as V,aj as E,b as N,o as d,f as n,w as o,e as l,h,q as J,N as oe,B as L,g as x,t as y,aO as ne,y as B,K as Q,c as P,s as k,aA as le,_ as G,F as H,A as W,aQ as se,bg as ie,bh as re}from"./index-D6ldqbnU.js";import{f as ce,u as ue}from"./merchant-Z65Hux2M.js";import{_ as X}from"./Spin-BLgfA2f8.js";import{a as Y,_ as Z}from"./FormItem-Y94Aopc1.js";import{_ as de}from"./Alert-DSGiC-EM.js";function pe(A,m){return q({url:`/api/merchants/${A}/applications`,method:"post",data:{CompanyName:m.companyName,ApplicationMaterials:m.applicationMaterials}})}function me(A,m){return q({url:`/api/merchants/${A}/applications`,method:"get",params:m})}const fe={class:"profile-info-container"},_e={class:"max-w-600px"},ge={class:"flex gap-12px"},ve=T({name:"ProfileInfo",__name:"profile-info",setup(A,{expose:m}){const u=O();te();const w=f(null),b=f(!1),_=f(!1),a=U({merchantName:"",status:1,contactInfo:"",location:""}),s=f({merchantName:"",status:1,contactInfo:"",location:""}),F=f(!1),$={merchantName:[{required:!0,message:r("page.profile.merchantNamePlaceholder"),trigger:"blur"}],location:[{required:!0,message:r("page.profile.locationPlaceholder"),trigger:"blur"}],contactInfo:[{required:!0,message:r("page.profile.contactInfoPlaceholder"),trigger:"blur"}]},g=[{label:r("page.profile.statusActive"),value:1},{label:r("page.profile.statusInactive"),value:0}],M=V(()=>a.merchantName!==s.value.merchantName||a.status!==s.value.status||a.contactInfo!==s.value.contactInfo||a.location!==s.value.location),p=async()=>{try{if(b.value=!0,console.log("å¼€å§‹èŽ·å–å•†å®¶ä¿¡æ¯"),console.log("merchantId:",u.merchantId),!u.merchantId){console.error("merchantId ä¸ºç©ºï¼Œæ— æ³•è°ƒç”¨API"),window.$message?.error("å•†å®¶IDæœªæ‰¾åˆ°ï¼Œè¯·é‡æ–°ç™»å½•");return}const t=await ce(u.merchantId);console.log("ðŸ”™ APIå®Œæ•´è¿”å›žç»“æžœ:",JSON.stringify(t,null,2));let e=null;const v=t;if(v?.data?.data?(e=v.data.data,console.log("ä½¿ç”¨åµŒå¥—æ•°æ®ç»“æž„ result.data.data:",e)):v?.data?(e=v.data,console.log("ä½¿ç”¨ç›´æŽ¥æ•°æ®ç»“æž„ result.data:",e)):t&&typeof t=="object"&&(e=t,console.log("ä½¿ç”¨åŽŸå§‹è¿”å›žæ•°æ®:",e)),e&&typeof e=="object"){console.log("æ‰¾åˆ°å•†å®¶æ•°æ®:",e);const c={merchantName:e.merchantName||"",status:e.status??1,contactInfo:e.contactInfo||"",location:e.location||""};console.log("ðŸ”§ å‡†å¤‡æ›´æ–°è¡¨å•æ•°æ®:",c),await ne(),a.merchantName=c.merchantName,a.status=c.status,a.contactInfo=c.contactInfo,a.location=c.location,console.log("ðŸ“ è¡¨å•æ•°æ®å·²æ›´æ–°:",{merchantName:a.merchantName,status:a.status,contactInfo:a.contactInfo,location:a.location}),s.value.merchantName=c.merchantName,s.value.status=c.status,s.value.contactInfo=c.contactInfo,s.value.location=c.location,F.value=!0,u.setMerchantInfo(e),console.log("æ•°æ®åŠ è½½å®Œæˆï¼Œè¡¨å•å·²å¡«å……")}else console.error("æœªæ‰¾åˆ°æœ‰æ•ˆçš„å•†å®¶æ•°æ®"),console.log("å®Œæ•´APIå“åº”:",t),window.$message?.warning("èŽ·å–åˆ°çš„å•†å®¶ä¿¡æ¯æ ¼å¼ä¸æ­£ç¡®")}catch(t){console.error("èŽ·å–å•†å®¶ä¿¡æ¯å¤±è´¥:",t),window.$message?.error(r("page.profile.loadFailed"))}finally{b.value=!1}},S=async()=>{try{await w.value?.validate(),_.value=!0;const t={};a.merchantName!==s.value.merchantName&&(t.merchantName=a.merchantName),a.status!==s.value.status&&(t.status=a.status),a.contactInfo!==s.value.contactInfo&&(t.contactInfo=a.contactInfo),a.location!==s.value.location&&(t.location=a.location);const e=await ue(u.merchantId,t);e?.data&&(Object.assign(s.value,a),u.setMerchantInfo(e.data),window.$message?.success(r("page.profile.updateSuccess")))}catch(t){console.error("æ›´æ–°å•†å®¶ä¿¡æ¯å¤±è´¥:",t),window.$message?.error(r("page.profile.updateFailed"))}finally{_.value=!1}},j=()=>{Object.assign(a,s.value)};return m({loadMerchantInfo:p}),E(async()=>{if(!u.merchantId){window.$message?.warning("å•†å®¶IDæœªæ‰¾åˆ°ï¼Œè¯·é‡æ–°ç™»å½•");return}await p()}),(t,e)=>{const v=J,c=Z,R=oe,C=L,z=Y,D=X;return d(),N("div",fe,[n(D,{show:b.value},{default:o(()=>[l("div",_e,[n(z,{ref_key:"formRef",ref:w,model:a,rules:$,"label-placement":"left","label-width":"120",class:"profile-form"},{default:o(()=>[n(c,{label:h(r)("page.profile.merchantName"),path:"merchantName"},{default:o(()=>[n(v,{value:a.merchantName,"onUpdate:value":e[0]||(e[0]=I=>a.merchantName=I),placeholder:h(r)("page.profile.merchantNamePlaceholder"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(c,{label:h(r)("page.profile.status"),path:"status"},{default:o(()=>[n(R,{value:a.status,"onUpdate:value":e[1]||(e[1]=I=>a.status=I),options:g,placeholder:h(r)("page.profile.status")},null,8,["value","placeholder"])]),_:1},8,["label"]),n(c,{label:h(r)("page.profile.contactInfo"),path:"contactInfo"},{default:o(()=>[n(v,{value:a.contactInfo,"onUpdate:value":e[2]||(e[2]=I=>a.contactInfo=I),placeholder:h(r)("page.profile.contactInfoPlaceholder"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(c,{label:h(r)("page.profile.location"),path:"location"},{default:o(()=>[n(v,{value:a.location,"onUpdate:value":e[3]||(e[3]=I=>a.location=I),placeholder:h(r)("page.profile.locationPlaceholder"),type:"textarea",rows:3,clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(c,{class:"form-actions"},{default:o(()=>[l("div",ge,[n(C,{type:"primary",loading:_.value,disabled:!M.value,onClick:S},{default:o(()=>[x(y(h(r)("page.profile.save")),1)]),_:1},8,["loading","disabled"]),n(C,{disabled:!M.value||_.value,onClick:j},{default:o(()=>[x(y(h(r)("page.profile.cancel")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model"])])]),_:1},8,["show"])])}}}),he=B(ve,[["__scopeId","data-v-ba7f30ab"]]),ye={class:"application-form-container"},be={class:"mb-24px"},Ie={class:"flex gap-12px"},Ne={class:"flex items-center justify-between mb-16px"},we={key:0,class:"space-y-20px"},xe={class:"flex items-start justify-between gap-16px"},ke={class:"flex-1 min-w-0"},Ae={class:"text-18px font-semibold text-gray-800 mb-4px"},$e={class:"text-12px text-gray-500"},Me={class:"application-content"},Se={class:"info-section"},Ce={class:"info-grid"},Pe={class:"info-item"},Fe={class:"info-value"},Re={key:0,class:"info-item"},je={class:"info-value"},ze={key:1,class:"info-item"},De={class:"info-value"},Te={key:0,class:"info-section"},Be={class:"content-box content-normal"},qe={key:1,class:"info-section"},Oe={class:"content-box content-error"},Ue=T({name:"ApplicationForm",__name:"application-form",setup(A,{expose:m}){const u=O(),w=f(null),b=f(!1),_=f(!1),a=U({companyName:"",applicationMaterials:""}),s=f([]),F={companyName:[{required:!0,message:"è¯·è¾“å…¥å…¬å¸åç§°",trigger:"blur"},{min:2,max:100,message:"å…¬å¸åç§°é•¿åº¦åº”ä¸º2-100ä¸ªå­—ç¬¦",trigger:"blur"}],applicationMaterials:[{required:!0,message:"è¯·è¾“å…¥ç”³è¯·ç†ç”±",trigger:"blur"},{min:10,max:1e3,message:"ç”³è¯·ç†ç”±é•¿åº¦åº”ä¸º10-1000ä¸ªå­—ç¬¦",trigger:"blur"}]},$={0:{label:"å¾…å®¡æ ¸",type:"info"},1:{label:"å·²é€šè¿‡",type:"success"},2:{label:"å·²æ‹’ç»",type:"error"}},g=V(()=>!s.value.some(t=>t.auditStatus==="0")),M=async()=>{try{if(await w.value?.validate(),!u.merchantId){window.$message?.error("å•†å®¶IDæœªæ‰¾åˆ°ï¼Œè¯·é‡æ–°ç™»å½•");return}if(!g.value){window.$message?.warning("æ‚¨æœ‰å¾…å®¡æ ¸çš„ç”³è¯·ï¼Œè¯·ç­‰å¾…å®¡æ ¸ç»“æžœåŽå†æäº¤æ–°ç”³è¯·");return}b.value=!0,(await pe(u.merchantId,{companyName:a.companyName,applicationMaterials:a.applicationMaterials}))?.data&&(window.$message?.success("ç”³è¯·æäº¤æˆåŠŸï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸"),a.companyName="",a.applicationMaterials="",console.log("ç”³è¯·æäº¤æˆåŠŸ !"),await S())}catch(t){console.error("æäº¤ç”³è¯·å¤±è´¥:",t),window.$message?.error("æäº¤ç”³è¯·å¤±è´¥ï¼Œè¯·ç¨åŽå†è¯•")}finally{b.value=!1}},p=()=>{a.companyName="",a.applicationMaterials=""},S=async()=>{try{if(!u.merchantId){console.warn("merchantId ä¸ºç©ºï¼Œæ— æ³•åŠ è½½ç”³è¯·åˆ—è¡¨");return}_.value=!0,console.log("å¼€å§‹èŽ·å–ç”³è¯·åˆ—è¡¨, merchantId:",u.merchantId);const t=await me(u.merchantId,{size:20,page:1});console.log("APIå®Œæ•´è¿”å›žç»“æžœ:",JSON.stringify(t,null,2));const e=t;e?.data&&Array.isArray(e.data)?s.value=e.data:(console.warn("APIè¿”å›žæ•°æ®æ ¼å¼å¼‚å¸¸:",t),console.log("æ£€æŸ¥æ•°æ®è·¯å¾„ result.data:",e?.data),console.log("æ•°æ®ç±»åž‹:",typeof e?.data,"is Array:",Array.isArray(e?.data)),s.value=[])}catch(t){console.error("åŠ è½½ç”³è¯·åˆ—è¡¨å¤±è´¥:",t),window.$message?.error("åŠ è½½ç”³è¯·åˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"),s.value=[]}finally{_.value=!1}},j=t=>new Date(t).toLocaleString("zh-CN");return m({loadApplications:S}),E(async()=>{console.log("ç”³è¯·è¡¨å•ç»„ä»¶æŒ‚è½½ï¼Œå¼€å§‹åŠ è½½ç”³è¯·åˆ—è¡¨..."),await S()}),(t,e)=>{const v=le,c=J,R=Z,C=L,z=Y,D=de,I=Q,K=G,ee=se,ae=X;return d(),N("div",ye,[l("div",be,[e[7]||(e[7]=l("h3",{class:"text-18px font-semibold mb-16px"},"å•†å®¶ç»è¥èµ„æ ¼ç”³è¯·",-1)),n(I,{title:"æäº¤æ–°ç”³è¯·",bordered:!0,size:"small"},{"header-extra":o(()=>[g.value?k("",!0):(d(),P(v,{key:0,type:"warning",size:"small"},{default:o(()=>e[2]||(e[2]=[x(" æœ‰å¾…å®¡æ ¸ç”³è¯· ")])),_:1,__:[2]}))]),default:o(()=>[n(z,{ref_key:"formRef",ref:w,model:a,rules:F,"label-placement":"left","label-width":"120",class:"application-form"},{default:o(()=>[n(R,{label:"å…¬å¸åç§°",path:"companyName"},{default:o(()=>[n(c,{value:a.companyName,"onUpdate:value":e[0]||(e[0]=i=>a.companyName=i),placeholder:"è¯·è¾“å…¥å…¬å¸åç§°",disabled:!g.value,clearable:""},null,8,["value","disabled"])]),_:1}),n(R,{label:"ç”³è¯·ç†ç”±",path:"applicationMaterials"},{default:o(()=>[n(c,{value:a.applicationMaterials,"onUpdate:value":e[1]||(e[1]=i=>a.applicationMaterials=i),placeholder:"è¯·è¯¦ç»†è¯´æ˜Žæ‚¨çš„ç”³è¯·ç†ç”±ï¼ŒåŒ…æ‹¬ä¸šåŠ¡èŒƒå›´ã€è¿è¥è®¡åˆ’ç­‰",type:"textarea",rows:4,disabled:!g.value,clearable:""},null,8,["value","disabled"])]),_:1}),n(R,null,{default:o(()=>[l("div",Ie,[n(C,{type:"primary",loading:b.value,disabled:!g.value,onClick:M},{default:o(()=>e[3]||(e[3]=[x(" æäº¤ç”³è¯· ")])),_:1,__:[3]},8,["loading","disabled"]),n(C,{disabled:b.value||!g.value,onClick:p},{default:o(()=>e[4]||(e[4]=[x(" é‡ç½®è¡¨å• ")])),_:1,__:[4]},8,["disabled"])])]),_:1})]),_:1},8,["model"]),g.value?k("",!0):(d(),P(D,{key:0,type:"warning","show-icon":"",class:"mt-16px"},{header:o(()=>e[5]||(e[5]=[x("æ¸©é¦¨æç¤º")])),default:o(()=>[e[6]||(e[6]=x(" æ‚¨å½“å‰æœ‰å¾…å®¡æ ¸çš„ç”³è¯·ï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ç»“æžœåŽå†æäº¤æ–°ç”³è¯·ã€‚ "))]),_:1,__:[6]}))]),_:1})]),l("div",null,[l("div",Ne,[e[9]||(e[9]=l("h3",{class:"text-18px font-semibold"},"ç”³è¯·è®°å½•",-1)),n(C,{size:"small",type:"primary",loading:_.value,onClick:S},{icon:o(()=>[n(K,{icon:"mdi:refresh"})]),default:o(()=>[e[8]||(e[8]=x(" åˆ·æ–°è®°å½• "))]),_:1,__:[8]},8,["loading"])]),n(ae,{show:_.value},{default:o(()=>[s.value.length>0?(d(),N("div",we,[(d(!0),N(H,null,W(s.value,i=>(d(),P(I,{key:i.applyId,bordered:!0,size:"medium",class:"application-record"},{header:o(()=>[l("div",xe,[l("div",ke,[l("h4",Ae,y(i.companyName),1),l("p",$e,"ç”³è¯·ID: "+y(i.applyId),1)]),n(v,{type:$[i.auditStatus]?.type,size:"medium"},{default:o(()=>[x(y($[i.auditStatus]?.label),1)]),_:2},1032,["type"])])]),default:o(()=>[l("div",Me,[l("div",Se,[e[13]||(e[13]=l("h5",{class:"section-title"},"åŸºæœ¬ä¿¡æ¯",-1)),l("div",Ce,[l("div",Pe,[e[10]||(e[10]=l("span",{class:"info-label"},"æäº¤æ—¶é—´",-1)),l("span",Fe,y(j(i.submittedAt)),1)]),i.auditAt?(d(),N("div",Re,[e[11]||(e[11]=l("span",{class:"info-label"},"å®¡æ ¸æ—¶é—´",-1)),l("span",je,y(j(i.auditAt)),1)])):k("",!0),i.adminId?(d(),N("div",ze,[e[12]||(e[12]=l("span",{class:"info-label"},"å®¡æ ¸ç®¡ç†å‘˜",-1)),l("span",De,y(i.adminId),1)])):k("",!0)])]),i.applicationMaterials?(d(),N("div",Te,[e[14]||(e[14]=l("h5",{class:"section-title"},"ç”³è¯·ç†ç”±",-1)),l("div",Be,y(i.applicationMaterials),1)])):k("",!0),i.rejectReason&&i.auditStatus==="2"?(d(),N("div",qe,[e[15]||(e[15]=l("h5",{class:"section-title text-red-600"},"æ‹’ç»åŽŸå› ",-1)),l("div",Oe,y(i.rejectReason),1)])):k("",!0)])]),_:2},1024))),128))])):(d(),P(ee,{key:1,description:"æš‚æ— ç”³è¯·è®°å½•",class:"py-40px"}))]),_:1},8,["show"])])])}}}),Ve=B(Ue,[["__scopeId","data-v-9256667c"]]),Ee={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Je={class:"flex items-center gap-8px"},Le=T({name:"profile",__name:"index",setup(A){const m=f("profile"),u=f(),w=f(),b=[{key:"profile",label:"æˆ‘çš„ä¿¡æ¯",icon:"mdi:account-circle"},{key:"application",label:"å…¥é©»ç”³è¯·",icon:"mdi:file-document-edit"}],_=a=>{m.value=a,a==="profile"&&u.value?(console.log("ðŸ”„ åˆ‡æ¢åˆ°æˆ‘çš„ä¿¡æ¯é¡µé¢ï¼Œåˆ·æ–°å•†å®¶ä¿¡æ¯..."),u.value.loadMerchantInfo?.()):a==="application"&&w.value&&(console.log("ðŸ”„ åˆ‡æ¢åˆ°å…¥é©»ç”³è¯·é¡µé¢ï¼Œåˆ·æ–°ç”³è¯·åˆ—è¡¨..."),w.value.loadApplications?.())};return(a,s)=>{const F=G,$=re,g=ie,M=Q;return d(),N("div",Ee,[n(M,{title:h(r)("page.profile.title"),bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[n(g,{value:m.value,"onUpdate:value":[s[0]||(s[0]=p=>m.value=p),_],type:"line",animated:""},{default:o(()=>[(d(),N(H,null,W(b,p=>n($,{key:p.key,name:p.key,tab:p.label},{tab:o(()=>[l("div",Je,[n(F,{icon:p.icon,class:"text-16px"},null,8,["icon"]),l("span",null,y(p.label),1)])]),default:o(()=>[p.key==="profile"?(d(),P(he,{key:0,ref_for:!0,ref_key:"profileInfoRef",ref:u},null,512)):k("",!0),p.key==="application"?(d(),P(Ve,{key:1,ref_for:!0,ref_key:"applicationFormRef",ref:w},null,512)):k("",!0)]),_:2},1032,["name","tab"])),64))]),_:1},8,["value"])]),_:1},8,["title"])])}}}),Ye=B(Le,[["__scopeId","data-v-b46f504b"]]);export{Ye as default};
