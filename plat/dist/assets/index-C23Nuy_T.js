import{L as q,d as A,b as C,o as w,e as s,O as ne,r as _,a as $,P as oe,f as e,g as d,w as a,h as t,Q as f,J as y,N as re,R as P,B as E,t as c,s as ie,V as b,c as ue,E as de,K as fe,U as ce,X as me}from"./index-BBiR_dDj.js";import{N as j,S as ve,R as F,a as pe,b as m,c as G}from"./SearchOutline-DrYL7Ftg.js";import{T as O}from"./TrophyOutline-CpPq2CIf.js";import{P as M}from"./PersonOutline-DWEpZIOM.js";import{C as H}from"./CallOutline-Cw-jr8t8.js";import{S as ge}from"./StatsChartOutline-Cx0jVxVj.js";import{E as xe}from"./EyeOutline-CeJyFBv0.js";import{N as x,a as U}from"./Grid-D08UgEKj.js";import{b as he,N,a as J}from"./FormItem-CNuh5yBs.js";import{N as ye}from"./Spin-DbHJBzoM.js";import{_ as be}from"./Badge-DBAgG8vS.js";function K(v){switch(v){case 1:return"男";case 2:return"女";case 3:return"未知";default:return"未知"}}function Q(v){return`LV${v}`}function X(v){return q(`/api/users/${v}`)}function _e(v={}){return q("/api/users",v)}const we={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},B=A({name:"MailOutline",render:function(h,p){return w(),C("svg",we,p[0]||(p[0]=[s("rect",{x:"48",y:"96",width:"416",height:"320",rx:"40",ry:"40",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),s("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M112 160l144 112l144-112"},null,-1)]))}}),ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},L=A({name:"PeopleOutline",render:function(h,p){return w(),C("svg",ke,p[0]||(p[0]=[s("path",{d:"M402 168c-2.93 40.67-33.1 72-66 72s-63.12-31.32-66-72c-3-42.31 26.37-72 66-72s69 30.46 66 72z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),s("path",{d:"M336 304c-65.17 0-127.84 32.37-143.54 95.41c-2.08 8.34 3.15 16.59 11.72 16.59h263.65c8.57 0 13.77-8.25 11.72-16.59C463.85 335.36 401.18 304 336 304z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),s("path",{d:"M200 185.94c-2.34 32.48-26.72 58.06-53 58.06s-50.7-25.57-53-58.06C91.61 152.15 115.34 128 147 128s55.39 24.77 53 57.94z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),s("path",{d:"M206 306c-18.05-8.27-37.93-11.45-59-11.45c-52 0-102.1 25.85-114.65 76.2c-1.65 6.66 2.53 13.25 9.37 13.25H154",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),ze={class:"p-6 min-h-full bg-gray-50"},Ne={class:"mb-6"},Ce={class:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2"},Te={class:"flex items-center gap-2"},Pe={class:"flex items-center gap-3"},Ee={class:"text-lg font-semibold text-gray-800"},je={class:"text-sm text-gray-500"},Oe={key:0,class:"space-y-6"},Ie={class:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg"},Se={class:"text-center"},De={class:"text-2xl font-bold text-blue-600"},Me={class:"text-center"},Ue={class:"text-2xl font-bold text-purple-600"},Be={class:"text-center"},Le={class:"text-2xl font-bold text-green-600"},Ae={class:"text-center"},Re={class:"text-2xl font-bold text-orange-600"},Ve={class:"space-y-4"},$e={class:"flex justify-between items-center py-2 border-b border-gray-100"},Fe={class:"flex justify-between items-center py-2 border-b border-gray-100"},Ge={class:"flex justify-between items-center py-2 border-b border-gray-100"},He={class:"flex justify-between items-center py-2 border-b border-gray-100"},Je={class:"flex justify-between items-center py-2"},Ke={class:"space-y-4"},Qe={class:"flex justify-between items-center py-2 border-b border-gray-100"},Xe={class:"text-gray-600 font-medium flex items-center gap-2"},qe={class:"flex justify-between items-center py-2 border-b border-gray-100"},We={class:"text-gray-600 font-medium flex items-center gap-2"},Ye={class:"flex justify-between items-center py-2 border-b border-gray-100"},Ze={class:"flex justify-between items-center py-2 border-b border-gray-100"},el={class:"flex justify-between items-center py-2"},ll={key:1,class:"flex justify-center items-center h-80"},tl=A({name:"user-manage",__name:"index",setup(v){const h=ne(),p=_(!1),g=_([]),k=_(!1),I=_(!1),o=_({}),i=_({nickname:"",gender:null,level:null,hasEmail:null,hasPhone:null}),T=$(()=>{const n=g.value.length,l=g.value.filter(r=>r.gender===1).length,u=g.value.filter(r=>r.gender===2).length,D=g.value.filter(r=>r.email).length,z=g.value.filter(r=>r.phoneNumber).length;return{total:n,maleCount:l,femaleCount:u,withEmail:D,withPhone:z,emailRate:n>0?Math.round(D/n*100):0,phoneRate:n>0?Math.round(z/n*100):0}}),W=[{label:"全部性别",value:null},{label:"男",value:1},{label:"女",value:2},{label:"未知",value:0}],Y=[{label:"全部等级",value:null},{label:"普通用户",value:1},{label:"VIP用户",value:2},{label:"黄金用户",value:3}],R=[{label:"全部",value:null},{label:"已绑定",value:!0},{label:"未绑定",value:!1}],S=$(()=>g.value.filter(n=>!(i.value.nickname&&!n.nickname?.toLowerCase().includes(i.value.nickname.toLowerCase())||i.value.gender!==null&&n.gender!==i.value.gender||i.value.level!==null&&n.level!==i.value.level||i.value.hasEmail!==null&&!!n.email!==i.value.hasEmail||i.value.hasPhone!==null&&!!n.phoneNumber!==i.value.hasPhone)));function Z(){h.success(`找到 ${S.value.length} 个用户`)}function ee(){i.value={nickname:"",gender:null,level:null,hasEmail:null,hasPhone:null},h.info("搜索条件已重置")}function le(){V()}async function V(){try{p.value=!0;const n=await _e();if(n&&Array.isArray(n.data)){const u=n.data.map(r=>r.userId).map(r=>X(r)),z=(await Promise.allSettled(u)).filter(r=>r.status==="fulfilled"&&r.value.data).map(r=>r.value.data);g.value=z.map((r,se)=>({...r,index:se+1,genderText:K(r.gender),levelText:Q(r.level),totalOrdersText:r.stats?.totalOrders||0,favoriteCountText:r.stats?.favoriteCount||0,hasEmail:r.email?"是":"否",hasPhone:r.phoneNumber?"是":"否"})),h.success(`成功加载 ${z.length} 个用户的详细数据`)}else h.error(n.message||"获取用户列表失败"),g.value=[]}catch(n){h.error("获取用户列表失败: "+n.message),g.value=[],console.error("Error fetching user list:",n)}finally{p.value=!1}}const te=[{key:"index",title:"序号",align:"center",width:70,render:(n,l)=>e(be,{value:l+1,type:"info"},null)},{key:"userInfo",title:"用户信息",width:200,render:n=>e("div",{class:"flex items-center gap-12px"},[e(G,{size:"medium",style:{backgroundColor:n.gender===1?"#409eff":n.gender===2?"#f56c6c":"#909399"}},{default:()=>[e(f,null,{default:()=>[e(M,null,null)]})]}),e("div",{class:"flex flex-col"},[e(m,{strong:!0},{default:()=>[n.nickname||"未设置昵称"]}),e(m,{depth:"3",style:"font-size: 12px;"},{default:()=>[d("ID: "),n.userId?.slice(-8)||"-"]})])])},{key:"genderText",title:"性别",align:"center",width:80,render:n=>{const l={1:{type:"info",color:"#409eff"},2:{type:"error",color:"#f56c6c"},0:{type:"default",color:"#909399"}},u=l[n.gender]||l[0];return e(b,{type:u.type,size:"small"},{default:()=>[n.genderText]})}},{key:"levelText",title:"用户等级",align:"center",width:120,render:n=>{const l={1:{type:"default",icon:null},2:{type:"warning",icon:O},3:{type:"success",icon:O}},u=l[n.level]||l[1];return e(b,{type:u.type,size:"small"},{default:()=>[u.icon&&e(f,{component:u.icon,style:"margin-right: 4px;"},null),n.levelText]})}},{key:"stats",title:"用户统计",align:"center",width:120,render:n=>e("div",{class:"flex flex-col gap-4px"},[e("div",{class:"flex items-center justify-center gap-4px"},[e(f,{color:"#409eff",size:"14"},{default:()=>[e(ge,null,null)]}),e(m,{style:"font-size: 12px;"},{default:()=>[d("订单: "),n.totalOrdersText]})]),e("div",{class:"flex items-center justify-center gap-4px"},[e(f,{color:"#f56c6c",size:"14"},{default:()=>[e(O,null,null)]}),e(m,{style:"font-size: 12px;"},{default:()=>[d("收藏: "),n.favoriteCountText]})])])},{key:"contact",title:"联系方式",align:"center",width:120,render:n=>e("div",{class:"flex flex-col gap-4px"},[e("div",{class:"flex items-center justify-center gap-4px"},[e(f,{color:n.email?"#67c23a":"#dcdfe6",size:"14"},{default:()=>[e(B,null,null)]}),e(b,{size:"small",type:n.email?"success":"default"},{default:()=>[n.hasEmail]})]),e("div",{class:"flex items-center justify-center gap-4px"},[e(f,{color:n.phoneNumber?"#67c23a":"#dcdfe6",size:"14"},{default:()=>[e(H,null,null)]}),e(b,{size:"small",type:n.phoneNumber?"success":"default"},{default:()=>[n.hasPhone]})])])},{key:"actions",title:"操作",align:"center",width:120,render:n=>e(E,{type:"primary",size:"small",onClick:()=>ae(n.userId),style:"border-radius: 6px;"},{default:()=>[e("div",{style:"display: flex; align-items: center; gap: 4px;"},[e(f,{size:"14"},{default:()=>[e(xe,null,null)]}),d("查看详情")])]})}];async function ae(n){try{I.value=!0,k.value=!0,o.value={},console.log(`获取用户详情，ID: ${n}`);const l=await X(n);l&&l.data?(o.value={...l.data,genderText:K(l.data.gender),levelText:Q(l.data.level),hasEmail:l.data.email?"是":"否",hasPhone:l.data.phoneNumber?"是":"否"},console.log("用户详情:",o.value)):(h.error(l?.message||"获取用户详情失败"),k.value=!1)}catch(l){console.error("获取用户详情失败:",l),h.error("获取用户详情失败: "+(l.message||"未知错误")),k.value=!1}finally{I.value=!1}}return oe(()=>{V()}),(n,l)=>(w(),C("div",ze,[s("div",Ne,[s("h1",Ce,[e(t(f),{size:"24",color:"#409eff"},{default:a(()=>[e(t(L))]),_:1}),l[6]||(l[6]=d(" 用户管理中心 "))]),l[7]||(l[7]=s("p",{class:"text-gray-600"},"管理和查看所有用户信息",-1))]),e(t(U),{cols:4,"x-gap":16,"y-gap":16,class:"mb-6"},{default:a(()=>[e(t(x),null,{default:a(()=>[e(t(y),{bordered:!1,class:"shadow-sm hover:shadow-lg transition-shadow duration-300"},{default:a(()=>[e(t(j),{label:"总用户数",value:T.value.total,"value-style":"color: #409eff; font-weight: bold;"},{prefix:a(()=>[e(t(f),{size:"20",color:"#409eff"},{default:a(()=>[e(t(L))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(t(x),null,{default:a(()=>[e(t(y),{bordered:!1,class:"shadow-sm hover:shadow-lg transition-shadow duration-300"},{default:a(()=>[e(t(j),{label:"男性用户",value:T.value.maleCount,"value-style":"color: #409eff; font-weight: bold;"},{suffix:a(()=>l[8]||(l[8]=[s("span",{class:"text-sm text-gray-500"},"人",-1)])),_:1},8,["value"])]),_:1})]),_:1}),e(t(x),null,{default:a(()=>[e(t(y),{bordered:!1,class:"shadow-sm hover:shadow-lg transition-shadow duration-300"},{default:a(()=>[e(t(j),{label:"女性用户",value:T.value.femaleCount,"value-style":"color: #f56c6c; font-weight: bold;"},{suffix:a(()=>l[9]||(l[9]=[s("span",{class:"text-sm text-gray-500"},"人",-1)])),_:1},8,["value"])]),_:1})]),_:1}),e(t(x),null,{default:a(()=>[e(t(y),{bordered:!1,class:"shadow-sm hover:shadow-lg transition-shadow duration-300"},{default:a(()=>[e(t(j),{label:"邮箱绑定率",value:T.value.emailRate,"value-style":"color: #67c23a; font-weight: bold;"},{suffix:a(()=>l[10]||(l[10]=[s("span",{class:"text-sm text-gray-500"},"%",-1)])),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(t(y),{title:"筛选条件",class:"mb-6 shadow-sm",bordered:!1},{"header-extra":a(()=>[e(t(J),null,{default:a(()=>[e(t(E),{size:"small",onClick:Z,type:"primary"},{icon:a(()=>[e(t(f),null,{default:a(()=>[e(t(ve))]),_:1})]),default:a(()=>[l[11]||(l[11]=d(" 搜索 "))]),_:1,__:[11]}),e(t(E),{size:"small",onClick:ee},{icon:a(()=>[e(t(f),null,{default:a(()=>[e(t(F))]),_:1})]),default:a(()=>[l[12]||(l[12]=d(" 重置 "))]),_:1,__:[12]})]),_:1})]),default:a(()=>[e(t(he),{model:i.value,inline:"","label-placement":"left","label-width":"80"},{default:a(()=>[e(t(N),{label:"用户昵称"},{default:a(()=>[e(t(re),{value:i.value.nickname,"onUpdate:value":l[0]||(l[0]=u=>i.value.nickname=u),placeholder:"请输入用户昵称",clearable:"",style:{width:"180px"}},null,8,["value"])]),_:1}),e(t(N),{label:"性别"},{default:a(()=>[e(t(P),{value:i.value.gender,"onUpdate:value":l[1]||(l[1]=u=>i.value.gender=u),options:W,placeholder:"选择性别",clearable:"",style:{width:"120px"}},null,8,["value"])]),_:1}),e(t(N),{label:"用户等级"},{default:a(()=>[e(t(P),{value:i.value.level,"onUpdate:value":l[2]||(l[2]=u=>i.value.level=u),options:Y,placeholder:"选择等级",clearable:"",style:{width:"140px"}},null,8,["value"])]),_:1}),e(t(N),{label:"邮箱绑定"},{default:a(()=>[e(t(P),{value:i.value.hasEmail,"onUpdate:value":l[3]||(l[3]=u=>i.value.hasEmail=u),options:R,placeholder:"邮箱状态",clearable:"",style:{width:"120px"}},null,8,["value"])]),_:1}),e(t(N),{label:"手机绑定"},{default:a(()=>[e(t(P),{value:i.value.hasPhone,"onUpdate:value":l[4]||(l[4]=u=>i.value.hasPhone=u),options:R,placeholder:"手机状态",clearable:"",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),e(t(y),{bordered:!1,class:"shadow-sm"},{header:a(()=>[s("div",Te,[e(t(f),{size:"18",color:"#409eff"},{default:a(()=>[e(t(L))]),_:1}),l[13]||(l[13]=s("span",{class:"font-medium"},"用户列表",-1))])]),"header-extra":a(()=>[e(t(J),{align:"center"},{default:a(()=>[e(t(m),{depth:"3"},{default:a(()=>[d(" 显示 "+c(S.value.length)+" / "+c(g.value.length)+" 条记录 ",1)]),_:1}),e(t(E),{size:"small",onClick:le,loading:p.value},{icon:a(()=>[e(t(f),null,{default:a(()=>[e(t(F))]),_:1})]),default:a(()=>[l[14]||(l[14]=d(" 刷新 "))]),_:1,__:[14]},8,["loading"])]),_:1})]),default:a(()=>[e(t(pe),{columns:te,data:S.value,loading:p.value,pagination:{pageSize:10,showSizePicker:!0,pageSizes:[10,20,50]},"flex-height":"",class:"min-h-400px","row-class-name":()=>"hover:bg-blue-50 transition-colors duration-200"},null,8,["data","loading"])]),_:1}),e(t(ce),{show:k.value,"onUpdate:show":l[5]||(l[5]=u=>k.value=u),preset:"card",style:{width:"900px","max-height":"80vh"},class:"rounded-2xl","mask-closable":!1},{header:a(()=>[s("div",Pe,[e(t(G),{size:40,style:fe({backgroundColor:o.value.gender===1?"#409eff":o.value.gender===2?"#f56c6c":"#909399"})},{default:a(()=>[e(t(f),{size:"20"},{default:a(()=>[e(t(M))]),_:1})]),_:1},8,["style"]),s("div",null,[s("h3",Ee,c(o.value.nickname||o.value.nickName||"用户详情"),1),s("p",je," ID: "+c(o.value.userId||"-"),1)])])]),default:a(()=>[I.value?(w(),C("div",ll,[e(t(ye),{size:"large"},{description:a(()=>l[29]||(l[29]=[s("div",{class:"text-center mt-4"},[s("p",{class:"text-gray-600"},"正在加载用户详情..."),s("p",{class:"text-sm text-gray-400 mt-1"},"请稍候片刻")],-1)])),_:1})])):(w(),C("div",Oe,[s("div",Ie,[e(t(U),{cols:4,"x-gap":20},{default:a(()=>[e(t(x),null,{default:a(()=>[s("div",Se,[s("div",De,c(o.value.stats?.totalOrders||0),1),l[15]||(l[15]=s("div",{class:"text-sm text-gray-600"},"总订单数",-1))])]),_:1}),e(t(x),null,{default:a(()=>[s("div",Me,[s("div",Ue,c(o.value.stats?.favoriteCount||0),1),l[16]||(l[16]=s("div",{class:"text-sm text-gray-600"},"收藏商品",-1))])]),_:1}),e(t(x),null,{default:a(()=>[s("div",Be,[s("div",Le,c(o.value.levelText||"-"),1),l[17]||(l[17]=s("div",{class:"text-sm text-gray-600"},"用户等级",-1))])]),_:1}),e(t(x),null,{default:a(()=>[s("div",Ae,[s("div",Re,c(o.value.createdAt?Math.floor((Date.now()-new Date(o.value.createdAt).getTime())/(1e3*60*60*24)):"-"),1),l[18]||(l[18]=s("div",{class:"text-sm text-gray-600"},"注册天数",-1))])]),_:1})]),_:1})]),e(t(ie)),e(t(U),{cols:2,"x-gap":24,"y-gap":20},{default:a(()=>[e(t(x),null,{default:a(()=>[e(t(y),{title:"基本信息",size:"small",class:"h-full"},{"header-extra":a(()=>[e(t(f),{color:"#409eff"},{default:a(()=>[e(t(M))]),_:1})]),default:a(()=>[s("div",Ve,[s("div",$e,[l[19]||(l[19]=s("span",{class:"text-gray-600 font-medium"},"用户ID",-1)),e(t(m),{code:"",style:{"word-break":"break-all","max-width":"200px"}},{default:a(()=>[d(c(o.value.userId||"-"),1)]),_:1})]),s("div",Fe,[l[20]||(l[20]=s("span",{class:"text-gray-600 font-medium"},"用户昵称",-1)),e(t(m),{strong:""},{default:a(()=>[d(c(o.value.nickName||o.value.nickname||"未设置"),1)]),_:1})]),s("div",Ge,[l[21]||(l[21]=s("span",{class:"text-gray-600 font-medium"},"性别",-1)),e(t(b),{type:o.value.gender===1?"info":o.value.gender===2?"error":"default",size:"small"},{default:a(()=>[d(c(o.value.genderText||"未知"),1)]),_:1},8,["type"])]),s("div",He,[l[22]||(l[22]=s("span",{class:"text-gray-600 font-medium"},"用户等级",-1)),e(t(b),{type:"warning",size:"small"},{icon:a(()=>[o.value.level>=2?(w(),ue(t(f),{key:0},{default:a(()=>[e(t(O))]),_:1})):de("",!0)]),default:a(()=>[d(" "+c(o.value.levelText||"普通用户"),1)]),_:1})]),s("div",Je,[l[23]||(l[23]=s("span",{class:"text-gray-600 font-medium"},"生日",-1)),e(t(m),null,{default:a(()=>[d(c(o.value.birthday||"未设置"),1)]),_:1})])])]),_:1})]),_:1}),e(t(x),null,{default:a(()=>[e(t(y),{title:"联系信息",size:"small",class:"h-full"},{"header-extra":a(()=>[e(t(f),{color:"#67c23a"},{default:a(()=>[e(t(B))]),_:1})]),default:a(()=>[s("div",Ke,[s("div",Qe,[s("span",Xe,[e(t(f),{size:"16",color:"#409eff"},{default:a(()=>[e(t(B))]),_:1}),l[24]||(l[24]=d(" 邮箱地址 "))]),e(t(m),null,{default:a(()=>[d(c(o.value.email||"未绑定"),1)]),_:1})]),s("div",qe,[s("span",We,[e(t(f),{size:"16",color:"#67c23a"},{default:a(()=>[e(t(H))]),_:1}),l[25]||(l[25]=d(" 手机号码 "))]),e(t(m),null,{default:a(()=>[d(c(o.value.phoneNumber||"未绑定"),1)]),_:1})]),s("div",Ye,[l[26]||(l[26]=s("span",{class:"text-gray-600 font-medium"},"邮箱验证",-1)),e(t(b),{type:o.value.email?"success":"default",size:"small"},{default:a(()=>[d(c(o.value.hasEmail),1)]),_:1},8,["type"])]),s("div",Ze,[l[27]||(l[27]=s("span",{class:"text-gray-600 font-medium"},"手机验证",-1)),e(t(b),{type:o.value.phoneNumber?"success":"default",size:"small"},{default:a(()=>[d(c(o.value.hasPhone),1)]),_:1},8,["type"])]),s("div",el,[l[28]||(l[28]=s("span",{class:"text-gray-600 font-medium"},"注册时间",-1)),e(t(m),{depth:"3"},{default:a(()=>[d(c(o.value.createdAt?new Date(o.value.createdAt).toLocaleString():"未知"),1)]),_:1})])])]),_:1})]),_:1})]),_:1})]))]),_:1},8,["show"])]))}}),vl=me(tl,[["__scopeId","data-v-5aeae02f"]]);export{vl as default};
//# sourceMappingURL=index-C23Nuy_T.js.map
