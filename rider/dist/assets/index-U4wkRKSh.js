import{O as W,P as I,Q as Z,R as E,d as q,S as d,U as G,T as J,V as ee,W as U,X as te,c as z,Y as se,Z as ae,a0 as ne,a1 as ie,r as b,a2 as oe,a3 as Y,m as le,a4 as re,a as C,o as O,b as s,e as p,w as m,t as r,g,B as V,f as P,a5 as H,M as S,h as ce,I as N,a6 as de,a7 as j,a8 as ue,a9 as ge,aa as ve,ab as pe,ac as me}from"./index-CWnxvy5X.js";import{N as he}from"./DataTable-DNIlafr3.js";const fe=W([W("@keyframes spin-rotate",`
 from {
 transform: rotate(0);
 }
 to {
 transform: rotate(360deg);
 }
 `),I("spin-container",`
 position: relative;
 `,[I("spin-body",`
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translateX(-50%) translateY(-50%);
 `,[Z()])]),I("spin-body",`
 display: inline-flex;
 align-items: center;
 justify-content: center;
 flex-direction: column;
 `),I("spin",`
 display: inline-flex;
 height: var(--n-size);
 width: var(--n-size);
 font-size: var(--n-size);
 color: var(--n-color);
 `,[E("rotate",`
 animation: spin-rotate 2s linear infinite;
 `)]),I("spin-description",`
 display: inline-block;
 font-size: var(--n-font-size);
 color: var(--n-text-color);
 transition: color .3s var(--n-bezier);
 margin-top: 8px;
 `),I("spin-content",`
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 pointer-events: all;
 `,[E("spinning",`
 user-select: none;
 -webkit-user-select: none;
 pointer-events: none;
 opacity: var(--n-opacity-spinning);
 `)])]),xe={small:20,medium:18,large:16},ye=Object.assign(Object.assign({},U.props),{contentClass:String,contentStyle:[Object,String],description:String,stroke:String,size:{type:[String,Number],default:"medium"},show:{type:Boolean,default:!0},strokeWidth:Number,rotate:{type:Boolean,default:!0},spinning:{type:Boolean,validator:()=>!0,default:void 0},delay:Number}),ke=q({name:"Spin",props:ye,slots:Object,setup(o){const{mergedClsPrefixRef:f,inlineThemeDisabled:i}=ee(o),n=U("Spin","-spin",fe,te,o,f),_=z(()=>{const{size:a}=o,{common:{cubicBezierEaseInOut:u},self:v}=n.value,{opacitySpinning:T,color:A,textColor:R}=v,$=typeof a=="number"?se(a):v[ae("size",a)];return{"--n-bezier":u,"--n-opacity-spinning":T,"--n-size":$,"--n-color":A,"--n-text-color":R}}),l=i?ne("spin",z(()=>{const{size:a}=o;return typeof a=="number"?String(a):a[0]}),_,o):void 0,c=ie(o,["spinning","show"]),k=b(!1);return oe(a=>{let u;if(c.value){const{delay:v}=o;if(v){u=window.setTimeout(()=>{k.value=!0},v),a(()=>{clearTimeout(u)});return}}k.value=c.value}),{mergedClsPrefix:f,active:k,mergedStrokeWidth:z(()=>{const{strokeWidth:a}=o;if(a!==void 0)return a;const{size:u}=o;return xe[typeof u=="number"?"medium":u]}),cssVars:i?void 0:_,themeClass:l?.themeClass,onRender:l?.onRender}},render(){var o,f;const{$slots:i,mergedClsPrefix:n,description:_}=this,l=i.icon&&this.rotate,c=(_||i.description)&&d("div",{class:`${n}-spin-description`},_||((o=i.description)===null||o===void 0?void 0:o.call(i))),k=i.icon?d("div",{class:[`${n}-spin-body`,this.themeClass]},d("div",{class:[`${n}-spin`,l&&`${n}-spin--rotate`],style:i.default?"":this.cssVars},i.icon()),c):d("div",{class:[`${n}-spin-body`,this.themeClass]},d(G,{clsPrefix:n,style:i.default?"":this.cssVars,stroke:this.stroke,"stroke-width":this.mergedStrokeWidth,class:`${n}-spin`}),c);return(f=this.onRender)===null||f===void 0||f.call(this),i.default?d("div",{class:[`${n}-spin-container`,this.themeClass],style:this.cssVars},d("div",{class:[`${n}-spin-content`,this.active&&`${n}-spin-content--spinning`,this.contentClass],style:this.contentStyle},i),d(J,{name:"fade-in-transition"},{default:()=>this.active?k:null})):k}});function be(o){return Y({url:`/api/attendance/rider/${o.riderId}/daterange`,method:"get",params:{startDate:o.startDate,endDate:o.endDate}})}function _e(o){return Y({url:`/api/attendance/today/${o}`,method:"get"})}const we={class:"h-full p-24px bg-gray-50 dark:bg-gray-900"},Ie={class:"flex items-center justify-between"},Se={class:"flex items-center space-x-32px"},Te={class:"text-center"},De={class:"text-4xl font-bold text-blue-600 dark:text-blue-400"},Oe={class:"text-sm text-gray-500 mt-4px"},ze={class:"text-center"},Ce={class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},Ne={class:"text-sm text-gray-500"},Ae={class:"text-center"},Re={class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},$e={class:"text-sm text-gray-500"},Be={class:"flex space-x-16px"},Le={class:"grid grid-cols-4 mb-24px gap-16px"},Me={class:"text-center"},Ve={class:"text-2xl text-blue-600 font-bold"},Pe={class:"text-center"},je={class:"text-2xl text-green-600 font-bold"},We={class:"text-center"},Ee={class:"text-2xl text-yellow-600 font-bold"},He={class:"text-center"},qe={class:"text-2xl text-red-600 font-bold"},Ue={class:"flex items-center justify-between"},Ye={class:"text-sm text-gray-500"},Ke={key:0,class:"space-y-16px"},Xe={class:"grid grid-cols-2 gap-16px"},Fe={class:"text-center p-16px bg-gray-50 dark:bg-gray-800 rounded-lg"},Qe={class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},Ze={class:"text-center p-16px bg-gray-50 dark:bg-gray-800 rounded-lg"},Ge={class:"grid grid-cols-2 gap-16px"},Je={class:"text-center p-16px bg-blue-50 dark:bg-blue-900/20 rounded-lg"},et={class:"text-lg font-semibold text-blue-800 dark:text-blue-200"},tt={class:"text-center p-16px bg-green-50 dark:bg-green-900/20 rounded-lg"},st={class:"text-lg font-semibold text-green-800 dark:text-green-200"},at={key:0,class:"text-center p-16px bg-purple-50 dark:bg-purple-900/20 rounded-lg"},nt={class:"text-lg font-semibold text-purple-800 dark:text-purple-200"},it={key:1,class:"p-16px bg-gray-50 dark:bg-gray-800 rounded-lg"},ot={class:"text-gray-800 dark:text-gray-200"},lt=q({name:"attendance",__name:"index",setup(o){const f=le(),i=z(()=>f.userInfo.userId),n=b([]),_=b(null),l=b(null),c=b(!1),k=b(!1),a=b(null),u=b(!1),v=b(!1),T=b(new Date),A=()=>{T.value=new Date};async function R(){try{const{data:e}=await ge({riderId:i.value});e&&(_.value=e)}catch(e){console.error("获取骑手信息失败",e)}}async function $(){c.value=!0;try{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),h={riderId:i.value,startDate:t.toISOString().split("T")[0],endDate:e.toISOString().split("T")[0]};console.log("开始日期:",h.startDate),console.log("结束日期:",h.endDate),console.log("骑手ID:",h.riderId),console.log("获取考勤记录参数:",h);const{data:x}=await be(h);if(console.log("获取考勤记录响应:",x),x&&x.data){const M=x.data||[];n.value=M.map(y=>({id:y.attendanceId||"",riderId:y.riderId||"",date:y.checkDate?new Date(y.checkDate).toISOString().split("T")[0]:"",checkInTime:y.checkInAt?new Date(y.checkInAt).toISOString():void 0,checkOutTime:y.checkoutAt?new Date(y.checkoutAt).toISOString():void 0,status:y.isLate>0?"late":"present",location:"",notes:"",workHours:0}));const w=new Date().toISOString().split("T")[0];l.value=n.value.find(y=>y.date===w)||null,l.value&&(u.value=!!l.value.checkInTime,v.value=!!l.value.checkOutTime)}}catch(e){console.error("获取考勤记录失败",e),e.response?(console.error("错误状态码:",e.response.status),console.error("错误数据:",e.response.data),console.error("错误头:",e.response.headers)):e.request?console.error("请求错误:",e.request):console.error("错误信息:",e.message),window.$message?.error("获取考勤记录失败"),n.value=[],l.value=null,u.value=!1,v.value=!1}finally{c.value=!1}}async function B(){try{const{data:e}=await _e(i.value);if(console.log("今日考勤状态:",e),e&&e.data){const t=e.data;l.value={id:t.attendanceId||"",riderId:i.value,date:t.checkDate?new Date(t.checkDate).toISOString().split("T")[0]:"",checkInTime:t.checkInAt?new Date(t.checkInAt).toISOString():void 0,checkOutTime:t.checkoutAt?new Date(t.checkoutAt).toISOString():void 0,status:t.isLate>0?"late":"present",location:"",notes:"",workHours:0},u.value=!!t.checkInAt,v.value=!!t.checkoutAt}else l.value=null,u.value=!1,v.value=!1}catch(e){console.error("获取今日考勤状态失败",e),l.value=null,u.value=!1,v.value=!1}}async function K(){try{c.value=!0,console.log("开始打卡，骑手ID:",i.value);const{data:e}=await ve(i.value,{checkDate:new Date().toISOString().split("T")[0],checkInAt:new Date().toISOString(),isLate:0,isAbsent:0});console.log("打卡响应:",e),e&&e.data&&(window.$message?.success("打卡成功！"),u.value=!0,await B())}catch(e){console.error("打卡失败",e),window.$message?.error("打卡失败，请稍后重试")}finally{c.value=!1}}async function X(){if(l.value)try{c.value=!0,console.log("开始签退，骑手ID:",i.value);const{data:e}=await pe(i.value,{checkDate:new Date().toISOString().split("T")[0],checkInAt:new Date().toISOString(),isLate:0,isAbsent:0});console.log("签退响应:",e),e&&e.data&&(window.$message?.success("签退成功！"),v.value=!0,await B())}catch(e){console.error("签退失败",e),window.$message?.error("签退失败，请稍后重试")}finally{c.value=!1}}function F(e){a.value=e,k.value=!0}const D=z(()=>{const e=n.value.length,t=n.value.filter(w=>w.status==="present").length,h=n.value.filter(w=>w.status==="late").length,x=n.value.filter(w=>w.status==="absent").length,M=n.value.filter(w=>w.status==="leave").length;return{total:e,present:t,late:h,absent:x,leave:M,attendanceRate:e>0?Math.round(t/e*100):0}}),L={present:{text:"正常",type:"success"},absent:{text:"缺勤",type:"error"},late:{text:"迟到",type:"warning"},leave:{text:"请假",type:"info"}},Q=[{title:"日期",key:"date",width:120,render:e=>{const t=new Date(e.date),h=new Date,x=t.toDateString()===h.toDateString();return d("div",{class:"flex items-center"},[d("span",{class:x?"text-blue-600 font-medium":""},t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})),x&&d(j,{type:"primary",size:"tiny"},{default:()=>"今日"})])}},{title:"上班时间",key:"checkInTime",width:100,render:e=>{if(!e.checkInTime)return d("span",{class:"text-gray-400"},"未打卡");const t=new Date(e.checkInTime).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return d("span",{class:"font-medium"},t)}},{title:"下班时间",key:"checkOutTime",width:100,render:e=>{if(!e.checkOutTime)return d("span",{class:"text-gray-400"},"未签退");const t=new Date(e.checkOutTime).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return d("span",{class:"font-medium"},t)}},{title:"工作时长",key:"workHours",width:100,render:e=>{if(!e.checkInTime||!e.checkOutTime)return"-";const t=new Date(e.checkInTime),h=new Date(e.checkOutTime),x=Math.round((h.getTime()-t.getTime())/(1e3*60*60)*10)/10;return d("span",{class:"text-green-600 font-medium"},`${x}h`)}},{title:"状态",key:"status",width:100,render:e=>{const t=L[e.status];return d(j,{type:t.type,size:"small"},{default:()=>t.text})}},{title:"操作",key:"actions",width:80,render:e=>d(V,{size:"small",type:"primary",ghost:!0,onClick:()=>F(e)},{default:()=>"详情"})}];return re(async()=>{!f.userInfo.userId&&f.token&&await f.initUserInfo(),await Promise.all([R(),B(),$()]),setInterval(A,1e3)}),(e,t)=>(O(),C("div",we,[t[12]||(t[12]=s("div",{class:"mb-24px"},[s("h1",{class:"text-3xl font-bold text-gray-800 dark:text-gray-200 mb-8px"}," 考勤管理 "),s("p",{class:"text-gray-600 dark:text-gray-400"}," 管理您的出勤记录，保持工作纪律 ")],-1)),p(g(S),{bordered:!1,class:"mb-24px shadow-sm"},{default:m(()=>[s("div",Ie,[s("div",Se,[s("div",Te,[s("div",De,r(T.value.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})),1),s("div",Oe,r(T.value.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})),1)]),s("div",ze,[s("div",Ce,r(_.value?.name||"骑手"),1),s("div",Ne,"车辆："+r(_.value?.vehicleNumber||"暂无"),1)]),s("div",Ae,[s("div",Re,r(l.value?.checkInTime?"已打卡":"未打卡"),1),s("div",$e,r(l.value?.checkOutTime?"已签退":"未签退"),1)])]),s("div",Be,[p(g(V),{type:"primary",size:"large",disabled:u.value||c.value,loading:c.value,onClick:K,class:"px-32px"},{icon:m(()=>[p(g(H),{icon:"mdi:clock-check",class:"mr-8px"})]),default:m(()=>[P(" "+r(u.value?"已打卡":"打卡"),1)]),_:1},8,["disabled","loading"]),p(g(V),{type:"info",size:"large",disabled:!u.value||v.value||c.value,loading:c.value,onClick:X,class:"px-32px"},{icon:m(()=>[p(g(H),{icon:"mdi:clock-out",class:"mr-8px"})]),default:m(()=>[P(" "+r(v.value?"已签退":"签退"),1)]),_:1},8,["disabled","loading"])])])]),_:1}),s("div",Le,[p(g(S),null,{default:m(()=>[s("div",Me,[s("div",Ve,r(D.value.total),1),t[1]||(t[1]=s("div",{class:"text-sm text-gray-500"},"总出勤天数",-1))])]),_:1}),p(g(S),null,{default:m(()=>[s("div",Pe,[s("div",je,r(D.value.present),1),t[2]||(t[2]=s("div",{class:"text-sm text-gray-500"},"正常出勤",-1))])]),_:1}),p(g(S),null,{default:m(()=>[s("div",We,[s("div",Ee,r(D.value.late),1),t[3]||(t[3]=s("div",{class:"text-sm text-gray-500"},"迟到次数",-1))])]),_:1}),p(g(S),null,{default:m(()=>[s("div",He,[s("div",qe,r(D.value.attendanceRate)+"%",1),t[4]||(t[4]=s("div",{class:"text-sm text-gray-500"},"出勤率",-1))])]),_:1})]),p(g(S),{bordered:!1,class:"shadow-sm"},{header:m(()=>[s("div",Ue,[t[5]||(t[5]=s("span",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"考勤记录",-1)),s("span",Ye,"本月共 "+r(D.value.total)+" 条记录",1)])]),default:m(()=>[p(g(ke),{show:c.value},{default:m(()=>[p(g(he),{columns:Q,data:n.value,pagination:{pageSize:15,showSizePicker:!0,pageSizes:[10,15,20,30]},bordered:!1,"single-line":!1,class:"mt-16px"},null,8,["data"]),!c.value&&n.value.length===0?(O(),ce(g(de),{key:0,description:"暂无考勤记录"})):N("",!0)]),_:1},8,["show"])]),_:1}),p(g(ue),{show:k.value,"onUpdate:show":t[0]||(t[0]=h=>k.value=h),preset:"card",title:"考勤详情",style:{width:"600px"}},{default:m(()=>[a.value?(O(),C("div",Ke,[s("div",Xe,[s("div",Fe,[t[6]||(t[6]=s("div",{class:"text-sm text-gray-500"},"日期",-1)),s("div",Qe,r(new Date(a.value.date).toLocaleDateString("zh-CN")),1)]),s("div",Ze,[t[7]||(t[7]=s("div",{class:"text-sm text-gray-500"},"状态",-1)),p(g(j),{type:L[a.value.status].type,size:"medium"},{default:m(()=>[P(r(L[a.value.status].text),1)]),_:1},8,["type"])])]),s("div",Ge,[s("div",Je,[t[8]||(t[8]=s("div",{class:"text-sm text-blue-600 dark:text-blue-400"},"上班时间",-1)),s("div",et,r(a.value.checkInTime?new Date(a.value.checkInTime).toLocaleTimeString("zh-CN"):"未打卡"),1)]),s("div",tt,[t[9]||(t[9]=s("div",{class:"text-sm text-green-600 dark:text-green-400"},"下班时间",-1)),s("div",st,r(a.value.checkOutTime?new Date(a.value.checkOutTime).toLocaleTimeString("zh-CN"):"未签退"),1)])]),a.value.checkInTime&&a.value.checkOutTime?(O(),C("div",at,[t[10]||(t[10]=s("div",{class:"text-sm text-purple-600 dark:text-purple-400"},"工作时长",-1)),s("div",nt,r(Math.round((new Date(a.value.checkOutTime).getTime()-new Date(a.value.checkInTime).getTime())/(1e3*60*60)*10)/10)+" 小时 ",1)])):N("",!0),a.value.notes?(O(),C("div",it,[t[11]||(t[11]=s("div",{class:"text-sm text-gray-500 mb-8px"},"备注",-1)),s("div",ot,r(a.value.notes),1)])):N("",!0)])):N("",!0)]),_:1},8,["show"])]))}}),dt=me(lt,[["__scopeId","data-v-534645d2"]]);export{dt as default};
