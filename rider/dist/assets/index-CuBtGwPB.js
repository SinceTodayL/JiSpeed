import{O as L,P as g,ad as fe,ae as me,af as be,R as Z,ag as ne,d as X,ah as he,S as _,ai as ye,aj as we,V as xe,W as de,ak as _e,c as Q,Z as ee,a0 as Se,a1 as Ie,a3 as ce,r as I,al as Ce,a4 as ue,am as Ae,a as K,o as H,b as w,e as a,g as e,B as T,w as o,f as x,t as S,an as ze,ac as pe,m as Me,M as F,p as q,q as te,ao as $e,ap as re,a7 as ae,aq as Re,I as ke,a8 as De,ar as Oe,as as Pe}from"./index-CUViFaVA.js";import{_ as Ee}from"./Form-BFmUOUSC.js";import{_ as oe}from"./Space-BJL6K6ui.js";import{N as Ne}from"./DataTable-rggsvbED.js";function se(i,b="default",u=[]){const{children:d}=i;if(d!==null&&typeof d=="object"&&!Array.isArray(d)){const v=d[b];if(typeof v=="function")return v()}return u}const Le=L([g("descriptions",{fontSize:"var(--n-font-size)"},[g("descriptions-separator",`
 display: inline-block;
 margin: 0 8px 0 2px;
 `),g("descriptions-table-wrapper",[g("descriptions-table",[g("descriptions-table-row",[g("descriptions-table-header",{padding:"var(--n-th-padding)"}),g("descriptions-table-content",{padding:"var(--n-td-padding)"})])])]),be("bordered",[g("descriptions-table-wrapper",[g("descriptions-table",[g("descriptions-table-row",[L("&:last-child",[g("descriptions-table-content",{paddingBottom:0})])])])])]),Z("left-label-placement",[g("descriptions-table-content",[L("> *",{verticalAlign:"top"})])]),Z("left-label-align",[L("th",{textAlign:"left"})]),Z("center-label-align",[L("th",{textAlign:"center"})]),Z("right-label-align",[L("th",{textAlign:"right"})]),Z("bordered",[g("descriptions-table-wrapper",`
 border-radius: var(--n-border-radius);
 overflow: hidden;
 background: var(--n-merged-td-color);
 border: 1px solid var(--n-merged-border-color);
 `,[g("descriptions-table",[g("descriptions-table-row",[L("&:not(:last-child)",[g("descriptions-table-content",{borderBottom:"1px solid var(--n-merged-border-color)"}),g("descriptions-table-header",{borderBottom:"1px solid var(--n-merged-border-color)"})]),g("descriptions-table-header",`
 font-weight: 400;
 background-clip: padding-box;
 background-color: var(--n-merged-th-color);
 `,[L("&:not(:last-child)",{borderRight:"1px solid var(--n-merged-border-color)"})]),g("descriptions-table-content",[L("&:not(:last-child)",{borderRight:"1px solid var(--n-merged-border-color)"})])])])])]),g("descriptions-header",`
 font-weight: var(--n-th-font-weight);
 font-size: 18px;
 transition: color .3s var(--n-bezier);
 line-height: var(--n-line-height);
 margin-bottom: 16px;
 color: var(--n-title-text-color);
 `),g("descriptions-table-wrapper",`
 transition:
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[g("descriptions-table",`
 width: 100%;
 border-collapse: separate;
 border-spacing: 0;
 box-sizing: border-box;
 `,[g("descriptions-table-row",`
 box-sizing: border-box;
 transition: border-color .3s var(--n-bezier);
 `,[g("descriptions-table-header",`
 font-weight: var(--n-th-font-weight);
 line-height: var(--n-line-height);
 display: table-cell;
 box-sizing: border-box;
 color: var(--n-th-text-color);
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `),g("descriptions-table-content",`
 vertical-align: top;
 line-height: var(--n-line-height);
 display: table-cell;
 box-sizing: border-box;
 color: var(--n-td-text-color);
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[ne("content",`
 transition: color .3s var(--n-bezier);
 display: inline-block;
 color: var(--n-td-text-color);
 `)]),ne("label",`
 font-weight: var(--n-th-font-weight);
 transition: color .3s var(--n-bezier);
 display: inline-block;
 margin-right: 14px;
 color: var(--n-th-text-color);
 `)])])])]),g("descriptions-table-wrapper",`
 --n-merged-th-color: var(--n-th-color);
 --n-merged-td-color: var(--n-td-color);
 --n-merged-border-color: var(--n-border-color);
 `),fe(g("descriptions-table-wrapper",`
 --n-merged-th-color: var(--n-th-color-modal);
 --n-merged-td-color: var(--n-td-color-modal);
 --n-merged-border-color: var(--n-border-color-modal);
 `)),me(g("descriptions-table-wrapper",`
 --n-merged-th-color: var(--n-th-color-popover);
 --n-merged-td-color: var(--n-td-color-popover);
 --n-merged-border-color: var(--n-border-color-popover);
 `))]),ge="DESCRIPTION_ITEM_FLAG";function Te(i){return typeof i=="object"&&i&&!Array.isArray(i)?i.type&&i.type[ge]:!1}const je=Object.assign(Object.assign({},de.props),{title:String,column:{type:Number,default:3},columns:Number,labelPlacement:{type:String,default:"top"},labelAlign:{type:String,default:"left"},separator:{type:String,default:":"},size:{type:String,default:"medium"},bordered:Boolean,labelClass:String,labelStyle:[Object,String],contentClass:String,contentStyle:[Object,String]}),ie=X({name:"Descriptions",props:je,slots:Object,setup(i){const{mergedClsPrefixRef:b,inlineThemeDisabled:u}=xe(i),d=de("Descriptions","-descriptions",Le,_e,i,b),v=Q(()=>{const{size:c,bordered:R}=i,{common:{cubicBezierEaseInOut:h},self:{titleTextColor:y,thColor:C,thColorModal:m,thColorPopover:z,thTextColor:$,thFontWeight:E,tdTextColor:O,tdColor:V,tdColorModal:P,tdColorPopover:p,borderColor:t,borderColorModal:f,borderColorPopover:A,borderRadius:D,lineHeight:N,[ee("fontSize",c)]:G,[ee(R?"thPaddingBordered":"thPadding",c)]:j,[ee(R?"tdPaddingBordered":"tdPadding",c)]:U}}=d.value;return{"--n-title-text-color":y,"--n-th-padding":j,"--n-td-padding":U,"--n-font-size":G,"--n-bezier":h,"--n-th-font-weight":E,"--n-line-height":N,"--n-th-text-color":$,"--n-td-text-color":O,"--n-th-color":C,"--n-th-color-modal":m,"--n-th-color-popover":z,"--n-td-color":V,"--n-td-color-modal":P,"--n-td-color-popover":p,"--n-border-radius":D,"--n-border-color":t,"--n-border-color-modal":f,"--n-border-color-popover":A}}),n=u?Se("descriptions",Q(()=>{let c="";const{size:R,bordered:h}=i;return h&&(c+="a"),c+=R[0],c}),v,i):void 0;return{mergedClsPrefix:b,cssVars:u?void 0:v,themeClass:n?.themeClass,onRender:n?.onRender,compitableColumn:Ie(i,["columns","column"]),inlineThemeDisabled:u}},render(){const i=this.$slots.default,b=i?he(i()):[];b.length;const{contentClass:u,labelClass:d,compitableColumn:v,labelPlacement:n,labelAlign:c,size:R,bordered:h,title:y,cssVars:C,mergedClsPrefix:m,separator:z,onRender:$}=this;$?.();const E=b.filter(p=>Te(p)),O={span:0,row:[],secondRow:[],rows:[]},P=E.reduce((p,t,f)=>{const A=t.props||{},D=E.length-1===f,N=["label"in A?A.label:se(t,"label")],G=[se(t)],j=A.span||1,U=p.span;p.span+=j;const W=A.labelStyle||A["label-style"]||this.labelStyle,Y=A.contentStyle||A["content-style"]||this.contentStyle;if(n==="left")h?p.row.push(_("th",{class:[`${m}-descriptions-table-header`,d],colspan:1,style:W},N),_("td",{class:[`${m}-descriptions-table-content`,u],colspan:D?(v-U)*2+1:j*2-1,style:Y},G)):p.row.push(_("td",{class:`${m}-descriptions-table-content`,colspan:D?(v-U)*2:j*2},_("span",{class:[`${m}-descriptions-table-content__label`,d],style:W},[...N,z&&_("span",{class:`${m}-descriptions-separator`},z)]),_("span",{class:[`${m}-descriptions-table-content__content`,u],style:Y},G)));else{const J=D?(v-U)*2:j*2;p.row.push(_("th",{class:[`${m}-descriptions-table-header`,d],colspan:J,style:W},N)),p.secondRow.push(_("td",{class:[`${m}-descriptions-table-content`,u],colspan:J,style:Y},G))}return(p.span>=v||D)&&(p.span=0,p.row.length&&(p.rows.push(p.row),p.row=[]),n!=="left"&&p.secondRow.length&&(p.rows.push(p.secondRow),p.secondRow=[])),p},O).rows.map(p=>_("tr",{class:`${m}-descriptions-table-row`},p));return _("div",{style:C,class:[`${m}-descriptions`,this.themeClass,`${m}-descriptions--${n}-label-placement`,`${m}-descriptions--${c}-label-align`,`${m}-descriptions--${R}-size`,h&&`${m}-descriptions--bordered`]},y||this.$slots.header?_("div",{class:`${m}-descriptions-header`},y||we(this,"header")):null,_("div",{class:`${m}-descriptions-table-wrapper`},_("table",{class:`${m}-descriptions-table`},_("tbody",null,n==="top"&&_("tr",{class:`${m}-descriptions-table-row`,style:{visibility:"collapse"}},ye(v*2,_("td",null))),P))))}}),Be={label:String,span:{type:Number,default:1},labelClass:String,labelStyle:[Object,String],contentClass:String,contentStyle:[Object,String]},M=X({name:"DescriptionsItem",[ge]:!0,props:Be,slots:Object,render(){return null}});function Ge(i){return ce({url:`/api/riderlocations/${i}/latest`,method:"get"})}function ve(i){return ce({url:"/api/riderlocations/online",method:"get",params:i})}function Ue(i,b="订单操作失败，请稍后重试"){let u=b,d="";if(i?.response?.data){const n=i.response.data;d=String(n.code||""),u=n.msg||u}const v={ORDER_001:"订单不存在",ORDER_002:"订单状态不允许此操作",ORDER_003:"订单已被其他骑手接单",ORDER_004:"订单已超时",ORDER_005:"订单金额异常",ORDER_006:"订单地址信息不完整"};return d&&v[d]&&(u=v[d]),window.$message?.error(u),{errorCode:d,message:u,originalError:i}}function Ye(i,b="操作"){let u=`${b}失败，请稍后重试`,d="";if(i?.response?.data){const v=i.response.data;d=String(v.code||""),u=v.msg||u}return i?.code==="NETWORK_ERROR"?u="网络连接失败，请检查网络设置":i?.code==="TIMEOUT"&&(u="请求超时，请稍后重试"),window.$message?.error(u),{errorCode:d,message:u,originalError:i}}const le={apiKey:"2bc67deced375a36fb9db0937fb48d56",version:"2.0",plugins:["AMap.Scale","AMap.ToolBar","AMap.Driving","AMap.Geolocation","AMap.Marker","AMap.InfoWindow"]};class Fe{static instance=null;static loading=!1;static callbacks=[];static async load(){return this.instance?this.instance:this.loading?new Promise(b=>{this.callbacks.push(b)}):(this.loading=!0,new Promise((b,u)=>{if(window.AMap){this.instance=window.AMap,this.loading=!1,b(this.instance);return}const d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=`https://webapi.amap.com/maps?v=${le.version}&key=${le.apiKey}&plugin=${le.plugins.join(",")}`,d.onload=()=>{this.instance=window.AMap,this.loading=!1,b(this.instance),this.callbacks.forEach(v=>v(this.instance)),this.callbacks=[]},d.onerror=()=>{this.loading=!1,u(new Error("Failed to load AMap"))},document.head.appendChild(d)}))}}const Ve={class:"amap-container"},We={class:"map-controls"},Ze=X({__name:"amap-map",props:{center:{default:()=>{const i=localStorage.getItem("lastKnownLocation");if(i)try{return JSON.parse(i)}catch{}return{longitude:104.195397,latitude:35.86166}}},zoom:{default:12},showRiders:{type:Boolean,default:!0}},emits:["map-ready","location-update","rider-click"],setup(i,{emit:b}){const u=i,d=b,v=I(),n=I(null),c=I(!1),R=I(!1),h=I("loading"),y=I(u.center),C=I([]),m=I([]),z=I(null),$=I(null);Ce(()=>u.center,t=>{n.value&&t&&(n.value.setCenter([t.longitude,t.latitude]),y.value=t)},{immediate:!0});const E=async()=>{if(!(!n.value||!z.value)){m.value.forEach(t=>t.remove()),m.value=[];try{const{data:t}=await ve({pageIndex:1,pageSize:100});if(t&&Array.isArray(t))C.value=t,console.log("获取到骑手数据:",t.length,"个");else{C.value=[],console.log("未获取到骑手数据");return}}catch(t){console.error("获取骑手位置失败:",t),C.value=[];return}C.value.forEach(t=>{const f=new window.AMap.Marker({position:[t.longitude,t.latitude],title:`骑手${t.riderId}`,icon:new window.AMap.Icon({size:new window.AMap.Size(32,32),image:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiI+PGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTQiIGZpbGw9IiM0Mjg1ZjQiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSI4IiBmaWxsPSJ3aGl0ZSIvPjwvc3ZnPg==",imageSize:new window.AMap.Size(32,32)})});f.on("click",()=>{z.value.setContent(`
        <div style="padding: 10px;">
          <h4 style="margin: 0 0 8px 0; color: #333;">骑手${t.riderId}</h4>
          <p style="margin: 4px 0; color: #666;">状态: ${t.status===1?"在线":"离线"}</p>
          <p style="margin: 4px 0; color: #666;">经度: ${t.longitude.toFixed(6)}</p>
          <p style="margin: 4px 0; color: #666;">纬度: ${t.latitude.toFixed(6)}</p>
          <p style="margin: 4px 0; color: #666;">更新时间: ${new Date(t.locationTime).toLocaleString()}</p>
        </div>
      `),z.value.open(n.value,f.getPosition()),d("rider-click",t)}),f.setMap(n.value),m.value.push(f)})}},O=async()=>{if(v.value)try{h.value="loading";const t=await Fe.load();n.value=new t.Map(v.value,{zoom:u.zoom,center:[y.value.longitude,y.value.latitude],mapStyle:"amap://styles/normal",features:["bg","road","building"],viewMode:"3D"}),n.value.addControl(new t.Scale),n.value.addControl(new t.ToolBar);const f=new t.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB",buttonOffset:new t.Pixel(10,20),zoomToAccuracy:!0});if(n.value.addControl(f),$.value=f,f.on("complete",A=>{const D={longitude:A.position.lng,latitude:A.position.lat};y.value=D;try{localStorage.setItem("lastKnownLocation",JSON.stringify(D))}catch(N){console.warn("保存位置信息失败:",N)}d("location-update",D),n.value.setCenter([A.position.lng,A.position.lat]),window.$message?.success("定位成功！"),console.log("地图定位成功，新位置:",D)}),f.on("error",A=>{console.error("定位失败:",A),window.$message?.error("定位失败，请检查定位权限")}),z.value=new t.InfoWindow({offset:new t.Pixel(0,-30)}),h.value="ready",d("map-ready",n.value),u.showRiders&&await E(),$.value)try{setTimeout(()=>{$.value.getCurrentPosition()},500)}catch(A){console.log("初始定位失败，使用传入的位置:",A)}}catch(t){console.error("地图初始化失败:",t),h.value="error"}},V=async()=>{c.value=!0;try{n.value&&n.value.destroy(),await ze(),await O()}finally{c.value=!1}},P=async()=>{if(!n.value||!$.value){window.$message?.warning("地图未初始化完成，请稍后再试");return}R.value=!0;try{$.value.getCurrentPosition()}catch(t){console.error("定位失败:",t),window.$message?.error("定位失败，请检查定位权限")}finally{R.value=!1}},p=async()=>{c.value=!0;try{if(await E(),C.value.length>0){if(window.$message?.success(`成功显示 ${C.value.length} 个骑手位置`),C.value.length>1){const t=new window.AMap.Bounds;C.value.forEach(f=>{t.extend([f.longitude,f.latitude])}),n.value.setBounds(t,{padding:[50,50,50,50]})}}else window.$message?.warning("当前区域暂无在线骑手")}catch(t){console.error("显示骑手失败:",t),window.$message?.error("显示骑手失败，请稍后重试")}finally{c.value=!1}};return ue(()=>{O()}),Ae(()=>{n.value&&n.value.destroy(),m.value.forEach(t=>t.remove())}),(t,f)=>(H(),K("div",Ve,[w("div",{ref_key:"mapContainer",ref:v,class:"map-container"},null,512),w("div",We,[a(e(T),{type:"primary",size:"small",onClick:V,loading:c.value},{icon:o(()=>f[0]||(f[0]=[w("span",{class:"text-lg"},"🔄",-1)])),default:o(()=>[f[1]||(f[1]=x(" 刷新地图 "))]),_:1,__:[1]},8,["loading"]),a(e(T),{type:"info",size:"small",onClick:P,loading:R.value},{icon:o(()=>f[2]||(f[2]=[w("span",{class:"text-lg"},"📍",-1)])),default:o(()=>[f[3]||(f[3]=x(" 定位我 "))]),_:1,__:[3]},8,["loading"]),a(e(T),{type:"success",size:"small",onClick:p,loading:c.value},{default:o(()=>[x(" 显示骑手 ("+S(C.value.length)+") ",1)]),_:1},8,["loading"])])]))}}),Ke=pe(Ze,[["__scopeId","data-v-84f8b192"]]),He={class:"h-full p-24px"},Je={class:"mt-16px grid grid-cols-3 gap-16px"},qe={class:"text-2xl font-bold text-blue-600"},Qe={class:"text-2xl font-bold text-green-600"},Xe={class:"text-2xl font-bold text-purple-600"},et={key:0},tt={key:1},at={key:2,class:"text-center py-32px"},ot=X({name:"delivery",__name:"index",setup(i){const b=Me(),u=Q(()=>b.userInfo.userId),d=I([]),v=I(!1),n=I({page:1,pageSize:10,itemCount:0}),c=I({orderId:"",status:null,startDate:null,endDate:null}),R=I(!1),h=I(null),y=I(null),C=I(!1),z=I((()=>{const s=localStorage.getItem("lastKnownLocation");if(s)try{return JSON.parse(s)}catch{}return{longitude:104.195397,latitude:35.86166}})()),$=I([]),E=I(null),O={0:{text:"未处理",type:"warning"},1:{text:"已接单",type:"primary"},2:{text:"已拒单",type:"error"},3:{text:"已完成",type:"success"}},V=[{label:"全部状态",value:void 0},{label:"未处理",value:0},{label:"已接单",value:1},{label:"已拒单",value:2},{label:"已完成",value:3}],P=async()=>{v.value=!0;try{const s={page:n.value.page,pageSize:n.value.pageSize,...c.value.status!==null&&{status:c.value.status},...c.value.startDate&&{startDate:c.value.startDate},...c.value.endDate&&{endDate:c.value.endDate}},{data:l}=await Oe(u.value,s);if(Array.isArray(l)){let r=l;c.value.orderId&&(r=r.filter(k=>k.order?.orderId?.includes(c.value.orderId))),d.value=r,n.value.itemCount=r.length}else d.value=[],n.value.itemCount=0}catch(s){Ye(s,"获取订单数据")}finally{v.value=!1}},p=async s=>{C.value=!0;try{h.value&&(y.value={...h.value,assignedAt:h.value.assignedAt||new Date().toISOString(),acceptedAt:h.value.acceptedAt||null,timeOut:30}),console.log("使用基本信息作为订单详情")}catch(l){console.error("获取订单详情失败:",l),window.$message?.warning("订单详情功能暂时不可用，显示基本信息")}finally{C.value=!1}},t=async()=>{try{const{data:s}=await Ge(u.value);if(s&&s.longitude&&s.latitude){const l={longitude:s.longitude,latitude:s.latitude};z.value=l;try{localStorage.setItem("lastKnownLocation",JSON.stringify(l))}catch(r){console.warn("保存位置信息失败:",r)}console.log("获取到骑手位置:",l)}else console.log("骑手位置数据不完整，使用默认位置")}catch(s){console.log("获取骑手位置失败，使用默认位置:",s)}},f=async()=>{try{const{data:s}=await ve({pageIndex:1,pageSize:100});if(s&&Array.isArray(s)){const r=s.filter(k=>Math.sqrt((k.longitude-z.value.longitude)**2+(k.latitude-z.value.latitude)**2)<=.1);$.value=r}else $.value=[]}catch(s){console.error("获取在线骑手失败:",s),$.value=[]}},A=()=>{n.value.page=1,P()},D=()=>{c.value={orderId:"",status:null,startDate:null,endDate:null},n.value.page=1,P()},N=s=>{E.value=s,console.log("地图加载完成"),t()},G=s=>{z.value=s},j=s=>{console.log("点击骑手:",s)};ue(async()=>{!b.userInfo.userId&&b.token&&await b.initUserInfo(),b.userInfo.userId||Object.assign(b.userInfo,{userId:`rider_${Date.now()}`,userName:"测试骑手",roles:["rider"],buttons:[]}),await P(),await t(),await f()});const U=s=>{n.value.page=s,P()};async function W(s){try{h.value=s,R.value=!0,y.value=null,s.assignId&&await p(s.assignId)}catch(l){console.error("打开订单详情失败:",l),window.$message?.error("打开订单详情失败，请稍后重试")}}async function Y(s,l){const r={1:"接单",2:"拒单",3:"完成订单"}[l]||"更新状态";try{window.$dialog?.warning({title:`确认${r}`,content:`确定要${r}订单 ${s.order?.orderId} 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const k=s.assignId||"";await Pe(u.value,k,{acceptedStatus:l}),window.$message?.success(`${r}成功！`),await P(),R.value&&s.assignId&&await p(s.assignId)}catch(k){Ue(k,`${r}失败，请稍后重试`)}}})}catch(k){console.error("操作失败",k)}}const J=Q(()=>!d.value||!Array.isArray(d.value)?[]:d.value);return(s,l)=>(H(),K("div",He,[a(e(F),{bordered:!1,class:"mb-24px"},{default:o(()=>l[5]||(l[5]=[w("div",{class:"flex items-center justify-between"},[w("div",{class:"flex-1"},[w("h1",{class:"text-2xl text-gray-800 font-bold dark:text-gray-200"},"配送订单管理"),w("p",{class:"mt-8px text-gray-600 dark:text-gray-400"},"查看和管理您的配送订单，及时处理订单状态。")])],-1)])),_:1,__:[5]}),a(e(F),{bordered:!1,class:"mb-24px"},{default:o(()=>[a(e(Ee),{model:c.value,inline:""},{default:o(()=>[a(e(q),{label:"订单号"},{default:o(()=>[a(e(te),{value:c.value.orderId,"onUpdate:value":l[0]||(l[0]=r=>c.value.orderId=r),placeholder:"请输入订单号",style:{width:"200px"}},null,8,["value"])]),_:1}),a(e(q),{label:"状态"},{default:o(()=>[a(e($e),{value:c.value.status,"onUpdate:value":l[1]||(l[1]=r=>c.value.status=r),options:V,placeholder:"请选择状态",style:{width:"150px"}},null,8,["value"])]),_:1}),a(e(q),{label:"创建时间"},{default:o(()=>[a(e(oe),null,{default:o(()=>[a(e(te),{value:c.value.startDate,"onUpdate:value":l[2]||(l[2]=r=>c.value.startDate=r),placeholder:"开始日期 (YYYY-MM-DD)",style:{width:"150px"}},null,8,["value"]),l[6]||(l[6]=w("span",null,"至",-1)),a(e(te),{value:c.value.endDate,"onUpdate:value":l[3]||(l[3]=r=>c.value.endDate=r),placeholder:"结束日期 (YYYY-MM-DD)",style:{width:"150px"}},null,8,["value"])]),_:1,__:[6]})]),_:1}),a(e(q),null,{default:o(()=>[a(e(oe),null,{default:o(()=>[a(e(T),{type:"primary",onClick:A},{default:o(()=>l[7]||(l[7]=[x("搜索")])),_:1,__:[7]}),a(e(T),{onClick:D},{default:o(()=>l[8]||(l[8]=[x("重置")])),_:1,__:[8]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(e(Re),{type:"line",animated:""},{default:o(()=>[a(e(re),{name:"orders",tab:"订单列表"},{default:o(()=>[a(e(F),{bordered:!1,class:"rounded-16px shadow-sm"},{default:o(()=>[a(e(Ne),{columns:[{title:"订单号",key:"orderId",render:r=>r.order?.orderId||"-"},{title:"配送地址",key:"address",render:r=>r.order?.address?.detailedAddress||"-"},{title:"商家名称",key:"merchant",render:r=>r.order?.address?.receiverName||"-"},{title:"状态",key:"status",render(r){const k=r.acceptedStatus||0,B=O[k]||{text:"未知",type:"default"};return _(e(ae),{type:B.type,size:"small"},{default:()=>B.text})}},{title:"金额",key:"amount",render:r=>`￥${r.order?.orderAmount||0}`},{title:"创建时间",key:"createAt",render:r=>r.order?.createAt||"-"},{title:"操作",key:"actions",render(r){const k=r.acceptedStatus||0,B=[];return B.push(_(e(T),{size:"small",type:"primary",onClick:()=>W(r)},{default:()=>"详情"})),k===0?B.push(_(e(T),{size:"small",type:"success",onClick:()=>Y(r,1)},{default:()=>"接单"}),_(e(T),{size:"small",type:"warning",onClick:()=>Y(r,2)},{default:()=>"拒单"})):k===1&&B.push(_(e(T),{size:"small",type:"success",onClick:()=>Y(r,3)},{default:()=>"完成"})),_(e(oe),null,{default:()=>B})}}],data:J.value,loading:v.value,pagination:n.value,"onUpdate:page":U},null,8,["columns","data","loading","pagination"])]),_:1})]),_:1}),a(e(re),{name:"map",tab:"配送地图"},{default:o(()=>[a(e(F),{bordered:!1,class:"rounded-16px shadow-sm"},{default:o(()=>[l[12]||(l[12]=w("div",{class:"mb-16px flex items-center justify-between"},[w("div",null,[w("h3",{class:"text-lg font-semibold mb-8px"},"实时配送地图"),w("p",{class:"text-gray-600 text-sm"},"查看骑手位置和配送路线")])],-1)),a(Ke,{center:z.value,zoom:12,"show-riders":!0,onMapReady:N,onLocationUpdate:G,onRiderClick:j},null,8,["center"]),w("div",Je,[a(e(F),{size:"small",class:"text-center"},{default:o(()=>[w("div",qe,S(z.value.longitude.toFixed(6)),1),l[9]||(l[9]=w("div",{class:"text-sm text-gray-500"},"经度",-1))]),_:1,__:[9]}),a(e(F),{size:"small",class:"text-center"},{default:o(()=>[w("div",Qe,S(z.value.latitude.toFixed(6)),1),l[10]||(l[10]=w("div",{class:"text-sm text-gray-500"},"纬度",-1))]),_:1,__:[10]}),a(e(F),{size:"small",class:"text-center"},{default:o(()=>[w("div",Xe,S($.value.length),1),l[11]||(l[11]=w("div",{class:"text-sm text-gray-500"},"区域内骑手",-1))]),_:1,__:[11]})])]),_:1,__:[12]})]),_:1})]),_:1}),a(e(De),{show:R.value,"onUpdate:show":l[4]||(l[4]=r=>R.value=r),preset:"card",title:"订单详情",class:"w-[600px]",loading:C.value},{default:o(()=>[!C.value&&y.value?(H(),K("div",et,[a(e(ie),{"label-placement":"left",bordered:"",column:1},{default:o(()=>[a(e(M),{label:"订单号"},{default:o(()=>[x(S(y.value.order?.orderId||"-"),1)]),_:1}),a(e(M),{label:"配送地址"},{default:o(()=>[x(S(y.value.order?.address?.detailedAddress||"-"),1)]),_:1}),a(e(M),{label:"收货人姓名"},{default:o(()=>[x(S(y.value.order?.address?.receiverName||"-"),1)]),_:1}),a(e(M),{label:"收货人电话"},{default:o(()=>[x(S(y.value.order?.address?.receiverPhone||"-"),1)]),_:1}),a(e(M),{label:"分配时间"},{default:o(()=>[x(S(y.value.assignedAt||"-"),1)]),_:1}),a(e(M),{label:"接单时间"},{default:o(()=>[x(S(y.value.acceptedAt||"-"),1)]),_:1}),a(e(M),{label:"订单金额"},{default:o(()=>[x("￥"+S(y.value.order?.orderAmount||0),1)]),_:1}),a(e(M),{label:"订单状态"},{default:o(()=>[a(e(ae),{type:O[y.value.acceptedStatus||0]?.type||"default",size:"small"},{default:o(()=>[x(S(O[y.value.acceptedStatus||0]?.text||"未知"),1)]),_:1},8,["type"])]),_:1}),a(e(M),{label:"创建时间"},{default:o(()=>[x(S(y.value.order?.createAt||"-"),1)]),_:1}),a(e(M),{label:"超时时间"},{default:o(()=>[x(S(y.value.timeOut||0)+" 分钟 ",1)]),_:1})]),_:1})])):!C.value&&h.value?(H(),K("div",tt,[a(e(ie),{"label-placement":"left",bordered:"",column:1},{default:o(()=>[a(e(M),{label:"订单号"},{default:o(()=>[x(S(h.value.order?.orderId||"-"),1)]),_:1}),a(e(M),{label:"配送地址"},{default:o(()=>[x(S(h.value.order?.address?.detailedAddress||"-"),1)]),_:1}),a(e(M),{label:"收货人姓名"},{default:o(()=>[x(S(h.value.order?.address?.receiverName||"-"),1)]),_:1}),a(e(M),{label:"收货人电话"},{default:o(()=>[x(S(h.value.order?.address?.receiverPhone||"-"),1)]),_:1}),a(e(M),{label:"订单金额"},{default:o(()=>[x("￥"+S(h.value.order?.orderAmount||0),1)]),_:1}),a(e(M),{label:"创建时间"},{default:o(()=>[x(S(h.value.order?.createAt||"-"),1)]),_:1}),a(e(M),{label:"订单状态"},{default:o(()=>[a(e(ae),{type:O[h.value.acceptedStatus||0]?.type||"default",size:"small"},{default:o(()=>[x(S(O[h.value.acceptedStatus||0]?.text||"未知"),1)]),_:1},8,["type"])]),_:1})]),_:1}),l[13]||(l[13]=w("div",{class:"mt-16px text-center text-gray-500"},[w("p",null,"详细分配信息加载中...")],-1))])):C.value?(H(),K("div",at,l[14]||(l[14]=[w("p",{class:"text-gray-500"},"正在加载订单详情...",-1)]))):ke("",!0)]),_:1},8,["show","loading"])]))}}),it=pe(ot,[["__scopeId","data-v-e099d4e1"]]);export{it as default};
