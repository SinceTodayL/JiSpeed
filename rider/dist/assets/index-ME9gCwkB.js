import{d as z,m as $,Z as D,a0 as M,r as b,n as V,c as x,a1 as A,a as F,o as C,e as t,b as s,w as n,g as l,a2 as i,t as N,M as O,p as E,q as T,h as P,I as Z,B as G,f as g,a5 as H,a7 as J,bE as K,a8 as L}from"./index-vpJRjF0Y.js";import{_ as Q}from"./Form-BKXCY0Yc.js";const W={class:"h-full p-24px bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800"},X={class:"flex items-center gap-3"},Y={class:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center"},ee={class:"text-2xl text-gray-800 font-bold dark:text-gray-200"},ae={class:"mt-2px text-gray-600 dark:text-gray-400"},re={class:"flex items-center justify-between"},te={class:"flex items-center gap-3"},se={class:"w-8 h-8 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center"},ne={class:"space-y-20px"},oe={class:"flex gap-24px"},le={class:"flex-1"},ie={class:"flex-1"},de={class:"flex gap-24px"},ue={class:"flex-1"},ce={class:"mt-24px flex justify-center border-t border-gray-200 pt-16px dark:border-gray-700"},me={class:"flex gap-3"},pe=z({name:"profile",__name:"index",setup(be){const v=$(),B=D(),{t:I}=M(),y=b(null);b(!1);const m=b(!1),r=V({applicationUserId:"",name:"",phoneNumber:"",riderId:"",vehicleNumber:""}),a=b({applicationUserId:"",name:"",phoneNumber:"",riderId:"",vehicleNumber:""}),w=x(()=>v.userInfo.userId||B.riderId||""),_=x(()=>{const{name:d,phoneNumber:e,vehicleNumber:c}=r;return!!(d&&e&&c)}),k=x(()=>r.name!==a.value.name||r.phoneNumber!==a.value.phoneNumber||r.vehicleNumber!==a.value.vehicleNumber),j={name:[{required:!0,message:"请输入姓名",trigger:"blur"},{max:50,message:"姓名长度不能超过50个字符",trigger:"blur"}],phoneNumber:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],vehicleNumber:[{required:!0,message:"请输入车辆编号",trigger:"blur"},{max:20,message:"车辆编号长度不能超过20个字符",trigger:"blur"}]};async function U(){try{const d=await J(w.value),{data:e}=d;e?(Object.assign(r,e),a.value.applicationUserId=e.applicationUserId||"",a.value.name=e.name||"",a.value.phoneNumber=e.phoneNumber||"",a.value.riderId=e.riderId||"",a.value.vehicleNumber=e.vehicleNumber||""):console.warn("⚠️ 获取到的数据为空")}catch(d){console.error("获取骑手信息失败",d),window.$message?.error("获取骑手信息失败，请检查网络连接");const e={applicationUserId:"mock_user_001",name:"测试骑手",phoneNumber:"13800138000",riderId:w.value,vehicleNumber:"宁A12345"};Object.assign(r,e),a.value.applicationUserId=e.applicationUserId,a.value.name=e.name,a.value.phoneNumber=e.phoneNumber,a.value.riderId=e.riderId,a.value.vehicleNumber=e.vehicleNumber}}A(()=>{U()});async function R(){y.value?.validate(async d=>{if(d)return;m.value=!0;const{name:e,phoneNumber:c,vehicleNumber:f}=r;try{const u=await K(r.riderId,{name:e,phoneNumber:c,vehicleNumber:f}),{data:o}=u;o?(window.$message?.success("个人信息保存成功！"),Object.assign(r,o),a.value.applicationUserId=o.applicationUserId||"",a.value.name=o.name||"",a.value.phoneNumber=o.phoneNumber||"",a.value.riderId=o.riderId||"",a.value.vehicleNumber=o.vehicleNumber||"",o.name&&o.name!==v.userInfo.userName&&v.updateUserInfo({userName:o.name})):(console.warn("⚠️ API返回数据为空"),window.$message?.warning("保存成功，但未返回更新后的数据"))}catch(u){console.error("保存骑手信息失败",u);const o=u?.response?.data?.message||"保存失败，请稍后重试";window.$message?.error(o)}finally{m.value=!1}})}const S=()=>{r.applicationUserId=a.value.applicationUserId,r.name=a.value.name,r.phoneNumber=a.value.phoneNumber,r.riderId=a.value.riderId,r.vehicleNumber=a.value.vehicleNumber};return(d,e)=>{const c=O,f=H,u=T,o=E,h=G,q=Q;return C(),F("div",W,[t(c,{bordered:!1,class:"mb-24px bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm"},{default:n(()=>[s("div",X,[s("div",Y,[t(l(i),{icon:"mdi:account-circle",class:"text-2xl text-white"})]),s("div",null,[s("h1",ee,N(l(I)("rider.profile.title")),1),s("p",ae,N(l(I)("rider.profile.subtitle")),1)])])]),_:1}),s("div",null,[t(c,{bordered:!1,class:"rounded-16px shadow-lg bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm"},{header:n(()=>[s("div",re,[s("div",te,[s("div",se,[t(l(i),{icon:"mdi:account-edit",class:"text-lg text-white"})]),e[3]||(e[3]=s("span",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"基本信息",-1))]),t(f,{type:_.value?"success":"warning",size:"small",round:""},{icon:n(()=>[t(l(i),{icon:_.value?"mdi:check-circle":"mdi:alert-circle"},null,8,["icon"])]),default:n(()=>[g(" "+N(_.value?"已完善":"待完善"),1)]),_:1},8,["type"])])]),default:n(()=>[t(q,{ref_key:"formRef",ref:y,model:r,rules:j,"label-placement":"top","label-width":"120px","require-mark-placement":"right-hanging",size:"large"},{default:n(()=>[s("div",ne,[s("div",oe,[s("div",le,[t(o,{label:"姓名",path:"name"},{default:n(()=>[t(u,{value:r.name,"onUpdate:value":e[0]||(e[0]=p=>r.name=p),placeholder:"请输入您的真实姓名",clearable:""},{prefix:n(()=>[t(l(i),{icon:"mdi:account",class:"text-gray-400"})]),_:1},8,["value"])]),_:1})]),s("div",ie,[t(o,{label:"手机号",path:"phoneNumber"},{default:n(()=>[t(u,{value:r.phoneNumber,"onUpdate:value":e[1]||(e[1]=p=>r.phoneNumber=p),placeholder:"请输入手机号码（必填）",clearable:""},{prefix:n(()=>[t(l(i),{icon:"mdi:phone",class:"text-gray-400"})]),_:1},8,["value"])]),_:1})])]),s("div",de,[s("div",ue,[t(o,{label:"车辆编号",path:"vehicleNumber"},{default:n(()=>[t(u,{value:r.vehicleNumber,"onUpdate:value":e[2]||(e[2]=p=>r.vehicleNumber=p),placeholder:"请输入车辆编号",clearable:""},{prefix:n(()=>[t(l(i),{icon:"mdi:car",class:"text-gray-400"})]),_:1},8,["value"])]),_:1})]),e[4]||(e[4]=s("div",{class:"flex-1"},null,-1))])]),s("div",ce,[s("div",me,[t(h,{type:"default",size:"large",onClick:U,disabled:m.value},{icon:n(()=>[t(l(i),{icon:"mdi:refresh"})]),default:n(()=>[e[5]||(e[5]=g(" 刷新 "))]),_:1,__:[5]},8,["disabled"]),k.value?(C(),P(h,{key:0,type:"default",size:"large",onClick:S,disabled:m.value},{icon:n(()=>[t(l(i),{icon:"mdi:close"})]),default:n(()=>[e[6]||(e[6]=g(" 取消 "))]),_:1,__:[6]},8,["disabled"])):Z("",!0),t(h,{type:"primary",size:"large",loading:m.value,disabled:!k.value,class:"bg-gradient-to-r from-blue-500 to-purple-600 border-0",onClick:R},{icon:n(()=>[t(l(i),{icon:"mdi:content-save"})]),default:n(()=>[e[7]||(e[7]=g(" 保存更改 "))]),_:1,__:[7]},8,["loading","disabled"])])])]),_:1},8,["model"])]),_:1})])])}}}),_e=L(pe,[["__scopeId","data-v-2401479e"]]);export{_e as default};
