import{d as z,m as F,r as g,n as O,c as I,a4 as S,a as q,o as $,e as a,b as o,w as t,g as d,a5 as u,M as A,p as M,q as V,h as T,I as L,B as P,f as b,a7 as E,t as G,a9 as H,an as J,bF as K,ac as Q}from"./index-CxAZ8T4x.js";import{u as W}from"./index-DW_EYtQ3.js";import{_ as X}from"./Form-DsuHFhxj.js";const Y={class:"h-full p-24px bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800"},Z={class:"flex items-center gap-3"},ee={class:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center"},re={class:"flex items-center justify-between"},ae={class:"flex items-center gap-3"},oe={class:"w-8 h-8 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center"},te={class:"space-y-20px"},se={class:"flex gap-24px"},ne={class:"flex-1"},le={class:"flex-1"},ie={class:"flex gap-24px"},de={class:"flex-1"},ue={class:"mt-24px flex justify-center border-t border-gray-200 pt-16px dark:border-gray-700"},ce={class:"flex gap-3"},me=z({name:"profile",__name:"index",setup(pe){const i=F(),f=W(),w=g(null),y=g(!1),m=g(!1),r=O({applicationUserId:"",name:"",phoneNumber:"",riderId:"",vehicleNumber:""}),l=g({applicationUserId:"",name:"",phoneNumber:"",riderId:"",vehicleNumber:""}),k=g(!1),c=I(()=>i.userInfo.userId||f.riderId||""),v=I(()=>{const{name:s,phoneNumber:e,vehicleNumber:n}=r;return!!(s&&e&&n)}),_=I(()=>r.name!==l.value.name||r.phoneNumber!==l.value.phoneNumber||r.vehicleNumber!==l.value.vehicleNumber),D={name:[{required:!0,message:"请输入姓名",trigger:"blur"},{max:50,message:"姓名长度不能超过50个字符",trigger:"blur"}],phoneNumber:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],vehicleNumber:[{max:20,message:"车辆编号长度不能超过20个字符",trigger:"blur"}]},U=async()=>{try{if(y.value=!0,!i.isLogin){console.error("用户未登录，请先登录"),window.$message?.error("请先登录后再查看个人信息");return}if(!c.value){console.error("未找到有效的骑手ID，请检查登录状态"),window.$message?.error("未找到有效的骑手ID，请重新登录");return}const s=await H(c.value),e=s?.data;if(console.log("获取骑手信息API响应:",s),e&&typeof e=="object"){console.log("找到骑手数据:",e);const n={applicationUserId:e.applicationUserId||"",name:e.name||"",phoneNumber:e.phoneNumber||"",riderId:e.riderId||c.value,vehicleNumber:e.vehicleNumber||""};console.log("🔧 准备更新表单数据:",n),await J(),r.applicationUserId=n.applicationUserId,r.name=n.name,r.phoneNumber=n.phoneNumber,r.riderId=n.riderId,r.vehicleNumber=n.vehicleNumber,console.log("📝 表单数据已更新:",{name:r.name,phoneNumber:r.phoneNumber,vehicleNumber:r.vehicleNumber}),l.value.applicationUserId=n.applicationUserId,l.value.name=n.name,l.value.phoneNumber=n.phoneNumber,l.value.riderId=n.riderId,l.value.vehicleNumber=n.vehicleNumber,k.value=!0,f.setRiderInfo(e),console.log("数据加载完成，表单已填充")}else console.error("未找到有效的骑手数据"),console.log("完整API响应:",s),window.$message?.warning("获取到的骑手信息格式不正确")}catch(s){console.error("获取骑手信息失败:",s),window.$message?.error("获取骑手信息失败，请检查网络连接");const e={applicationUserId:c.value||`rider_${Date.now()}`,name:"测试骑手",phoneNumber:"13800138000",riderId:c.value||`rider_${Date.now()}`,vehicleNumber:"宁A12345"};Object.assign(r,e),Object.assign(l.value,e),k.value=!0}finally{y.value=!1}};S(async()=>{!i.userInfo.userId&&i.token&&await i.initUserInfo(),i.userInfo.userId||Object.assign(i.userInfo,{userId:`rider_${Date.now()}`,userName:"测试骑手",roles:["rider"],buttons:[]}),U()});const j=async()=>{try{if(!i.isLogin){window.$message?.error("请先登录后再更新个人信息");return}if(!c.value){window.$message?.error("未找到有效的骑手ID，请重新登录");return}if(await w.value?.validate(),!_.value){window.$message?.info("没有检测到任何变更");return}m.value=!0;const s={name:r.name,phoneNumber:r.phoneNumber,vehicleNumber:r.vehicleNumber};console.log("准备更新骑手信息:",s);const e=await K(r.riderId,s);e?.data&&(Object.assign(l.value,r),f.setRiderInfo(e.data),window.$message?.success("个人信息更新成功！"),s.name&&i.userInfo.userName!==s.name&&(i.userInfo.userName=s.name))}catch(s){console.error("更新骑手信息失败:",s);const e=s?.response?.data?.message||"更新失败，请稍后重试";window.$message?.error(e)}finally{m.value=!1}},C=()=>{Object.assign(r,l.value)};return(s,e)=>{const n=A,R=E,h=V,x=M,N=P,B=X;return $(),q("div",Y,[a(n,{bordered:!1,class:"mb-24px bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm"},{default:t(()=>[o("div",Z,[o("div",ee,[a(d(u),{icon:"mdi:account-circle",class:"text-2xl text-white"})]),e[3]||(e[3]=o("div",null,[o("h1",{class:"text-2xl text-gray-800 font-bold dark:text-gray-200"},"个人信息管理"),o("p",{class:"mt-2px text-gray-600 dark:text-gray-400"},"管理您的个人基本信息和账户设置，确保信息准确无误")],-1))])]),_:1}),o("div",null,[a(n,{bordered:!1,class:"rounded-16px shadow-lg bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm"},{header:t(()=>[o("div",re,[o("div",ae,[o("div",oe,[a(d(u),{icon:"mdi:account-edit",class:"text-lg text-white"})]),e[4]||(e[4]=o("span",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"基本信息",-1))]),a(R,{type:v.value?"success":"warning",size:"small",round:""},{icon:t(()=>[a(d(u),{icon:v.value?"mdi:check-circle":"mdi:alert-circle"},null,8,["icon"])]),default:t(()=>[b(" "+G(v.value?"已完善":"待完善"),1)]),_:1},8,["type"])])]),default:t(()=>[a(B,{ref_key:"formRef",ref:w,model:r,rules:D,"label-placement":"top","label-width":"120px","require-mark-placement":"right-hanging",size:"large"},{default:t(()=>[o("div",te,[o("div",se,[o("div",ne,[a(x,{label:"姓名",path:"name"},{default:t(()=>[a(h,{value:r.name,"onUpdate:value":e[0]||(e[0]=p=>r.name=p),placeholder:"请输入您的真实姓名",clearable:""},{prefix:t(()=>[a(d(u),{icon:"mdi:account",class:"text-gray-400"})]),_:1},8,["value"])]),_:1})]),o("div",le,[a(x,{label:"手机号",path:"phoneNumber"},{default:t(()=>[a(h,{value:r.phoneNumber,"onUpdate:value":e[1]||(e[1]=p=>r.phoneNumber=p),placeholder:"请输入手机号码",clearable:""},{prefix:t(()=>[a(d(u),{icon:"mdi:phone",class:"text-gray-400"})]),_:1},8,["value"])]),_:1})])]),o("div",ie,[o("div",de,[a(x,{label:"车辆编号",path:"vehicleNumber"},{default:t(()=>[a(h,{value:r.vehicleNumber,"onUpdate:value":e[2]||(e[2]=p=>r.vehicleNumber=p),placeholder:"请输入车辆编号",clearable:""},{prefix:t(()=>[a(d(u),{icon:"mdi:car",class:"text-gray-400"})]),_:1},8,["value"])]),_:1})]),e[5]||(e[5]=o("div",{class:"flex-1"},null,-1))])]),o("div",ue,[o("div",ce,[a(N,{type:"default",size:"large",onClick:U,disabled:m.value},{icon:t(()=>[a(d(u),{icon:"mdi:refresh"})]),default:t(()=>[e[6]||(e[6]=b(" 刷新 "))]),_:1,__:[6]},8,["disabled"]),_.value?($(),T(N,{key:0,type:"default",size:"large",onClick:C,disabled:m.value},{icon:t(()=>[a(d(u),{icon:"mdi:close"})]),default:t(()=>[e[7]||(e[7]=b(" 取消 "))]),_:1,__:[7]},8,["disabled"])):L("",!0),a(N,{type:"primary",size:"large",loading:m.value,disabled:!_.value,class:"bg-gradient-to-r from-blue-500 to-purple-600 border-0",onClick:j},{icon:t(()=>[a(d(u),{icon:"mdi:content-save"})]),default:t(()=>[e[8]||(e[8]=b(" 保存更改 "))]),_:1,__:[8]},8,["loading","disabled"])])])]),_:1},8,["model"])]),_:1})])])}}}),ve=Q(me,[["__scopeId","data-v-231207a4"]]);export{ve as default};
