import{O as N,P as b,ad as me,ae as be,af as he,R as K,ag as re,d as X,ah as ye,S,ai as we,aj as xe,V as _e,W as de,ak as Se,c as Q,Z as ee,a0 as Ie,a1 as Ce,a3 as ce,r as C,al as Ae,a4 as ue,am as ze,a as H,o as J,b as x,e as a,g as e,B as L,w as o,f as _,t as I,an as Me,ac as pe,m as $e,M as F,p as q,q as te,ao as Re,ap as ne,a7 as ae,aq as ke,I as De,a8 as Oe,ar as Pe,as as Ee}from"./index-CJ7t4TGf.js";import{u as Ne}from"./index-QLprilYi.js";import{_ as Le}from"./Form-DOyQhNxS.js";import{_ as oe}from"./Space-B81wXqPE.js";import{N as Te}from"./DataTable-Tezb1HAK.js";function se(s,h="default",u=[]){const{children:d}=s;if(d!==null&&typeof d=="object"&&!Array.isArray(d)){const g=d[h];if(typeof g=="function")return g()}return u}const je=N([b("descriptions",{fontSize:"var(--n-font-size)"},[b("descriptions-separator",`
 display: inline-block;
 margin: 0 8px 0 2px;
 `),b("descriptions-table-wrapper",[b("descriptions-table",[b("descriptions-table-row",[b("descriptions-table-header",{padding:"var(--n-th-padding)"}),b("descriptions-table-content",{padding:"var(--n-td-padding)"})])])]),he("bordered",[b("descriptions-table-wrapper",[b("descriptions-table",[b("descriptions-table-row",[N("&:last-child",[b("descriptions-table-content",{paddingBottom:0})])])])])]),K("left-label-placement",[b("descriptions-table-content",[N("> *",{verticalAlign:"top"})])]),K("left-label-align",[N("th",{textAlign:"left"})]),K("center-label-align",[N("th",{textAlign:"center"})]),K("right-label-align",[N("th",{textAlign:"right"})]),K("bordered",[b("descriptions-table-wrapper",`
 border-radius: var(--n-border-radius);
 overflow: hidden;
 background: var(--n-merged-td-color);
 border: 1px solid var(--n-merged-border-color);
 `,[b("descriptions-table",[b("descriptions-table-row",[N("&:not(:last-child)",[b("descriptions-table-content",{borderBottom:"1px solid var(--n-merged-border-color)"}),b("descriptions-table-header",{borderBottom:"1px solid var(--n-merged-border-color)"})]),b("descriptions-table-header",`
 font-weight: 400;
 background-clip: padding-box;
 background-color: var(--n-merged-th-color);
 `,[N("&:not(:last-child)",{borderRight:"1px solid var(--n-merged-border-color)"})]),b("descriptions-table-content",[N("&:not(:last-child)",{borderRight:"1px solid var(--n-merged-border-color)"})])])])])]),b("descriptions-header",`
 font-weight: var(--n-th-font-weight);
 font-size: 18px;
 transition: color .3s var(--n-bezier);
 line-height: var(--n-line-height);
 margin-bottom: 16px;
 color: var(--n-title-text-color);
 `),b("descriptions-table-wrapper",`
 transition:
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[b("descriptions-table",`
 width: 100%;
 border-collapse: separate;
 border-spacing: 0;
 box-sizing: border-box;
 `,[b("descriptions-table-row",`
 box-sizing: border-box;
 transition: border-color .3s var(--n-bezier);
 `,[b("descriptions-table-header",`
 font-weight: var(--n-th-font-weight);
 line-height: var(--n-line-height);
 display: table-cell;
 box-sizing: border-box;
 color: var(--n-th-text-color);
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `),b("descriptions-table-content",`
 vertical-align: top;
 line-height: var(--n-line-height);
 display: table-cell;
 box-sizing: border-box;
 color: var(--n-td-text-color);
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[re("content",`
 transition: color .3s var(--n-bezier);
 display: inline-block;
 color: var(--n-td-text-color);
 `)]),re("label",`
 font-weight: var(--n-th-font-weight);
 transition: color .3s var(--n-bezier);
 display: inline-block;
 margin-right: 14px;
 color: var(--n-th-text-color);
 `)])])])]),b("descriptions-table-wrapper",`
 --n-merged-th-color: var(--n-th-color);
 --n-merged-td-color: var(--n-td-color);
 --n-merged-border-color: var(--n-border-color);
 `),me(b("descriptions-table-wrapper",`
 --n-merged-th-color: var(--n-th-color-modal);
 --n-merged-td-color: var(--n-td-color-modal);
 --n-merged-border-color: var(--n-border-color-modal);
 `)),be(b("descriptions-table-wrapper",`
 --n-merged-th-color: var(--n-th-color-popover);
 --n-merged-td-color: var(--n-td-color-popover);
 --n-merged-border-color: var(--n-border-color-popover);
 `))]),ge="DESCRIPTION_ITEM_FLAG";function Be(s){return typeof s=="object"&&s&&!Array.isArray(s)?s.type&&s.type[ge]:!1}const Ge=Object.assign(Object.assign({},de.props),{title:String,column:{type:Number,default:3},columns:Number,labelPlacement:{type:String,default:"top"},labelAlign:{type:String,default:"left"},separator:{type:String,default:":"},size:{type:String,default:"medium"},bordered:Boolean,labelClass:String,labelStyle:[Object,String],contentClass:String,contentStyle:[Object,String]}),ie=X({name:"Descriptions",props:Ge,slots:Object,setup(s){const{mergedClsPrefixRef:h,inlineThemeDisabled:u}=_e(s),d=de("Descriptions","-descriptions",je,Se,s,h),g=Q(()=>{const{size:y,bordered:v}=s,{common:{cubicBezierEaseInOut:$},self:{titleTextColor:w,thColor:f,thColorModal:c,thColorPopover:O,thTextColor:z,thFontWeight:D,tdTextColor:T,tdColor:P,tdColorModal:G,tdColorPopover:p,borderColor:t,borderColorModal:m,borderColorPopover:A,borderRadius:k,lineHeight:E,[ee("fontSize",y)]:U,[ee(v?"thPaddingBordered":"thPadding",y)]:j,[ee(v?"tdPaddingBordered":"tdPadding",y)]:Y}}=d.value;return{"--n-title-text-color":w,"--n-th-padding":j,"--n-td-padding":Y,"--n-font-size":U,"--n-bezier":$,"--n-th-font-weight":D,"--n-line-height":E,"--n-th-text-color":z,"--n-td-text-color":T,"--n-th-color":f,"--n-th-color-modal":c,"--n-th-color-popover":O,"--n-td-color":P,"--n-td-color-modal":G,"--n-td-color-popover":p,"--n-border-radius":k,"--n-border-color":t,"--n-border-color-modal":m,"--n-border-color-popover":A}}),i=u?Ie("descriptions",Q(()=>{let y="";const{size:v,bordered:$}=s;return $&&(y+="a"),y+=v[0],y}),g,s):void 0;return{mergedClsPrefix:h,cssVars:u?void 0:g,themeClass:i?.themeClass,onRender:i?.onRender,compitableColumn:Ce(s,["columns","column"]),inlineThemeDisabled:u}},render(){const s=this.$slots.default,h=s?ye(s()):[];h.length;const{contentClass:u,labelClass:d,compitableColumn:g,labelPlacement:i,labelAlign:y,size:v,bordered:$,title:w,cssVars:f,mergedClsPrefix:c,separator:O,onRender:z}=this;z?.();const D=h.filter(p=>Be(p)),T={span:0,row:[],secondRow:[],rows:[]},G=D.reduce((p,t,m)=>{const A=t.props||{},k=D.length-1===m,E=["label"in A?A.label:se(t,"label")],U=[se(t)],j=A.span||1,Y=p.span;p.span+=j;const W=A.labelStyle||A["label-style"]||this.labelStyle,Z=A.contentStyle||A["content-style"]||this.contentStyle;if(i==="left")$?p.row.push(S("th",{class:[`${c}-descriptions-table-header`,d],colspan:1,style:W},E),S("td",{class:[`${c}-descriptions-table-content`,u],colspan:k?(g-Y)*2+1:j*2-1,style:Z},U)):p.row.push(S("td",{class:`${c}-descriptions-table-content`,colspan:k?(g-Y)*2:j*2},S("span",{class:[`${c}-descriptions-table-content__label`,d],style:W},[...E,O&&S("span",{class:`${c}-descriptions-separator`},O)]),S("span",{class:[`${c}-descriptions-table-content__content`,u],style:Z},U)));else{const V=k?(g-Y)*2:j*2;p.row.push(S("th",{class:[`${c}-descriptions-table-header`,d],colspan:V,style:W},E)),p.secondRow.push(S("td",{class:[`${c}-descriptions-table-content`,u],colspan:V,style:Z},U))}return(p.span>=g||k)&&(p.span=0,p.row.length&&(p.rows.push(p.row),p.row=[]),i!=="left"&&p.secondRow.length&&(p.rows.push(p.secondRow),p.secondRow=[])),p},T).rows.map(p=>S("tr",{class:`${c}-descriptions-table-row`},p));return S("div",{style:f,class:[`${c}-descriptions`,this.themeClass,`${c}-descriptions--${i}-label-placement`,`${c}-descriptions--${y}-label-align`,`${c}-descriptions--${v}-size`,$&&`${c}-descriptions--bordered`]},w||this.$slots.header?S("div",{class:`${c}-descriptions-header`},w||xe(this,"header")):null,S("div",{class:`${c}-descriptions-table-wrapper`},S("table",{class:`${c}-descriptions-table`},S("tbody",null,i==="top"&&S("tr",{class:`${c}-descriptions-table-row`,style:{visibility:"collapse"}},we(g*2,S("td",null))),G))))}}),Ue={label:String,span:{type:Number,default:1},labelClass:String,labelStyle:[Object,String],contentClass:String,contentStyle:[Object,String]},M=X({name:"DescriptionsItem",[ge]:!0,props:Ue,slots:Object,render(){return null}});function Ye(s){return ce({url:`/api/riderlocations/${s}/latest`,method:"get"})}function ve(s){return ce({url:"/api/riderlocations/online",method:"get",params:s})}function Fe(s,h="è®¢å•æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"){let u=h,d="";if(s?.response?.data){const i=s.response.data;d=String(i.code||""),u=i.msg||u}const g={ORDER_001:"è®¢å•ä¸å­˜åœ¨",ORDER_002:"è®¢å•çŠ¶æ€ä¸å…è®¸æ­¤æ“ä½œ",ORDER_003:"è®¢å•å·²è¢«å…¶ä»–éª‘æ‰‹æ¥å•",ORDER_004:"è®¢å•å·²è¶…æ—¶",ORDER_005:"è®¢å•é‡‘é¢å¼‚å¸¸",ORDER_006:"è®¢å•åœ°å€ä¿¡æ¯ä¸å®Œæ•´"};return d&&g[d]&&(u=g[d]),window.$message?.error(u),{errorCode:d,message:u,originalError:s}}function Ve(s,h="æ“ä½œ"){let u=`${h}å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•`,d="";if(s?.response?.data){const g=s.response.data;d=String(g.code||""),u=g.msg||u}return s?.code==="NETWORK_ERROR"?u="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®":s?.code==="TIMEOUT"&&(u="è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•"),window.$message?.error(u),{errorCode:d,message:u,originalError:s}}const le={apiKey:"2bc67deced375a36fb9db0937fb48d56",version:"2.0",plugins:["AMap.Scale","AMap.ToolBar","AMap.Driving","AMap.Geolocation","AMap.Marker","AMap.InfoWindow"]};class We{static instance=null;static loading=!1;static callbacks=[];static async load(){return this.instance?this.instance:this.loading?new Promise(h=>{this.callbacks.push(h)}):(this.loading=!0,new Promise((h,u)=>{if(window.AMap){this.instance=window.AMap,this.loading=!1,h(this.instance);return}const d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=`https://webapi.amap.com/maps?v=${le.version}&key=${le.apiKey}&plugin=${le.plugins.join(",")}`,d.onload=()=>{this.instance=window.AMap,this.loading=!1,h(this.instance),this.callbacks.forEach(g=>g(this.instance)),this.callbacks=[]},d.onerror=()=>{this.loading=!1,u(new Error("Failed to load AMap"))},document.head.appendChild(d)}))}}const Ze={class:"amap-container"},Ke={class:"map-controls"},He=X({__name:"amap-map",props:{center:{default:()=>{const s=localStorage.getItem("lastKnownLocation");if(s)try{return JSON.parse(s)}catch{}return{longitude:104.195397,latitude:35.86166}}},zoom:{default:12},showRiders:{type:Boolean,default:!0}},emits:["map-ready","location-update","rider-click"],setup(s,{emit:h}){const u=s,d=h,g=C(),i=C(null),y=C(!1),v=C(!1),$=C("loading"),w=C(u.center),f=C([]),c=C([]),O=C(null),z=C(null);Ae(()=>u.center,t=>{i.value&&t&&(i.value.setCenter([t.longitude,t.latitude]),w.value=t)},{immediate:!0});const D=async()=>{if(!(!i.value||!O.value)){c.value.forEach(t=>t.remove()),c.value=[];try{const{data:t}=await ve({pageIndex:1,pageSize:100});if(t&&Array.isArray(t))f.value=t,console.log("è·å–åˆ°éª‘æ‰‹æ•°æ®:",t.length,"ä¸ª");else{f.value=[],console.log("æœªè·å–åˆ°éª‘æ‰‹æ•°æ®");return}}catch(t){console.error("è·å–éª‘æ‰‹ä½ç½®å¤±è´¥:",t),f.value=[];return}f.value.forEach(t=>{const m=new window.AMap.Marker({position:[t.longitude,t.latitude],title:`éª‘æ‰‹${t.riderId}`,icon:new window.AMap.Icon({size:new window.AMap.Size(32,32),image:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiI+PGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTQiIGZpbGw9IiM0Mjg1ZjQiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSI4IiBmaWxsPSJ3aGl0ZSIvPjwvc3ZnPg==",imageSize:new window.AMap.Size(32,32)})});m.on("click",()=>{O.value.setContent(`
        <div style="padding: 10px;">
          <h4 style="margin: 0 0 8px 0; color: #333;">éª‘æ‰‹${t.riderId}</h4>
          <p style="margin: 4px 0; color: #666;">çŠ¶æ€: ${t.status===1?"åœ¨çº¿":"ç¦»çº¿"}</p>
          <p style="margin: 4px 0; color: #666;">ç»åº¦: ${t.longitude.toFixed(6)}</p>
          <p style="margin: 4px 0; color: #666;">çº¬åº¦: ${t.latitude.toFixed(6)}</p>
          <p style="margin: 4px 0; color: #666;">æ›´æ–°æ—¶é—´: ${new Date(t.locationTime).toLocaleString()}</p>
        </div>
      `),O.value.open(i.value,m.getPosition()),d("rider-click",t)}),m.setMap(i.value),c.value.push(m)})}},T=async()=>{if(g.value)try{$.value="loading";const t=await We.load();i.value=new t.Map(g.value,{zoom:u.zoom,center:[w.value.longitude,w.value.latitude],mapStyle:"amap://styles/normal",features:["bg","road","building"],viewMode:"3D"}),i.value.addControl(new t.Scale),i.value.addControl(new t.ToolBar);const m=new t.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB",buttonOffset:new t.Pixel(10,20),zoomToAccuracy:!0});if(i.value.addControl(m),z.value=m,m.on("complete",A=>{const k={longitude:A.position.lng,latitude:A.position.lat};w.value=k;try{localStorage.setItem("lastKnownLocation",JSON.stringify(k))}catch(E){console.warn("ä¿å­˜ä½ç½®ä¿¡æ¯å¤±è´¥:",E)}d("location-update",k),i.value.setCenter([A.position.lng,A.position.lat]),window.$message?.success("å®šä½æˆåŠŸï¼"),console.log("åœ°å›¾å®šä½æˆåŠŸï¼Œæ–°ä½ç½®:",k)}),m.on("error",A=>{console.error("å®šä½å¤±è´¥:",A),window.$message?.error("å®šä½å¤±è´¥ï¼Œè¯·æ£€æŸ¥å®šä½æƒé™")}),O.value=new t.InfoWindow({offset:new t.Pixel(0,-30)}),$.value="ready",d("map-ready",i.value),u.showRiders&&await D(),z.value)try{setTimeout(()=>{z.value.getCurrentPosition()},500)}catch(A){console.log("åˆå§‹å®šä½å¤±è´¥ï¼Œä½¿ç”¨ä¼ å…¥çš„ä½ç½®:",A)}}catch(t){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",t),$.value="error"}},P=async()=>{y.value=!0;try{i.value&&i.value.destroy(),await Me(),await T()}finally{y.value=!1}},G=async()=>{if(!i.value||!z.value){window.$message?.warning("åœ°å›¾æœªåˆå§‹åŒ–å®Œæˆï¼Œè¯·ç¨åå†è¯•");return}v.value=!0;try{z.value.getCurrentPosition()}catch(t){console.error("å®šä½å¤±è´¥:",t),window.$message?.error("å®šä½å¤±è´¥ï¼Œè¯·æ£€æŸ¥å®šä½æƒé™")}finally{v.value=!1}},p=async()=>{y.value=!0;try{if(await D(),f.value.length>0){if(window.$message?.success(`æˆåŠŸæ˜¾ç¤º ${f.value.length} ä¸ªéª‘æ‰‹ä½ç½®`),f.value.length>1){const t=new window.AMap.Bounds;f.value.forEach(m=>{t.extend([m.longitude,m.latitude])}),i.value.setBounds(t,{padding:[50,50,50,50]})}}else window.$message?.warning("å½“å‰åŒºåŸŸæš‚æ— åœ¨çº¿éª‘æ‰‹")}catch(t){console.error("æ˜¾ç¤ºéª‘æ‰‹å¤±è´¥:",t),window.$message?.error("æ˜¾ç¤ºéª‘æ‰‹å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{y.value=!1}};return ue(()=>{T()}),ze(()=>{i.value&&i.value.destroy(),c.value.forEach(t=>t.remove())}),(t,m)=>(J(),H("div",Ze,[x("div",{ref_key:"mapContainer",ref:g,class:"map-container"},null,512),x("div",Ke,[a(e(L),{type:"primary",size:"small",onClick:P,loading:y.value},{icon:o(()=>m[0]||(m[0]=[x("span",{class:"text-lg"},"ğŸ”„",-1)])),default:o(()=>[m[1]||(m[1]=_(" åˆ·æ–°åœ°å›¾ "))]),_:1,__:[1]},8,["loading"]),a(e(L),{type:"info",size:"small",onClick:G,loading:v.value},{icon:o(()=>m[2]||(m[2]=[x("span",{class:"text-lg"},"ğŸ“",-1)])),default:o(()=>[m[3]||(m[3]=_(" å®šä½æˆ‘ "))]),_:1,__:[3]},8,["loading"]),a(e(L),{type:"success",size:"small",onClick:p,loading:y.value},{default:o(()=>[_(" æ˜¾ç¤ºéª‘æ‰‹ ("+I(f.value.length)+") ",1)]),_:1},8,["loading"])])]))}}),Je=pe(He,[["__scopeId","data-v-84f8b192"]]),qe={class:"h-full p-24px"},Qe={class:"mt-16px grid grid-cols-3 gap-16px"},Xe={class:"text-2xl font-bold text-blue-600"},et={class:"text-2xl font-bold text-green-600"},tt={class:"text-2xl font-bold text-purple-600"},at={key:0},ot={key:1},lt={key:2,class:"text-center py-32px"},rt=X({name:"delivery",__name:"index",setup(s){const h=$e(),u=Ne(),d=Q(()=>u.riderId||h.userInfo.userId),g=C([]),i=C(!1),y=C({page:1,pageSize:10,itemCount:0}),v=C({orderId:"",status:null,startDate:null,endDate:null}),$=C(!1),w=C(null),f=C(null),c=C(!1),z=C((()=>{const n=localStorage.getItem("lastKnownLocation");if(n)try{return JSON.parse(n)}catch{}return{longitude:104.195397,latitude:35.86166}})()),D=C([]),T=C(null),P={0:{text:"æœªå¤„ç†",type:"warning"},1:{text:"å·²æ¥å•",type:"primary"},2:{text:"å·²æ‹’å•",type:"error"},3:{text:"å·²å®Œæˆ",type:"success"}},G=[{label:"å…¨éƒ¨çŠ¶æ€",value:void 0},{label:"æœªå¤„ç†",value:0},{label:"å·²æ¥å•",value:1},{label:"å·²æ‹’å•",value:2},{label:"å·²å®Œæˆ",value:3}],p=async()=>{i.value=!0;try{const n={page:y.value.page,pageSize:y.value.pageSize,...v.value.status!==null&&{status:v.value.status},...v.value.startDate&&{startDate:v.value.startDate},...v.value.endDate&&{endDate:v.value.endDate}},{data:l}=await Pe(d.value,n);if(Array.isArray(l)){let r=l;v.value.orderId&&(r=r.filter(R=>R.order?.orderId?.includes(v.value.orderId))),g.value=r,y.value.itemCount=r.length}else g.value=[],y.value.itemCount=0}catch(n){Ve(n,"è·å–è®¢å•æ•°æ®")}finally{i.value=!1}},t=async n=>{c.value=!0;try{w.value&&(f.value={...w.value,assignedAt:w.value.assignedAt||new Date().toISOString(),acceptedAt:w.value.acceptedAt||null,timeOut:30}),console.log("ä½¿ç”¨åŸºæœ¬ä¿¡æ¯ä½œä¸ºè®¢å•è¯¦æƒ…")}catch(l){console.error("è·å–è®¢å•è¯¦æƒ…å¤±è´¥:",l),window.$message?.warning("è®¢å•è¯¦æƒ…åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œæ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯")}finally{c.value=!1}},m=async()=>{try{const{data:n}=await Ye(d.value);if(n&&n.longitude&&n.latitude){const l={longitude:n.longitude,latitude:n.latitude};z.value=l;try{localStorage.setItem("lastKnownLocation",JSON.stringify(l))}catch(r){console.warn("ä¿å­˜ä½ç½®ä¿¡æ¯å¤±è´¥:",r)}console.log("è·å–åˆ°éª‘æ‰‹ä½ç½®:",l)}else console.log("éª‘æ‰‹ä½ç½®æ•°æ®ä¸å®Œæ•´ï¼Œä½¿ç”¨é»˜è®¤ä½ç½®")}catch(n){console.log("è·å–éª‘æ‰‹ä½ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ä½ç½®:",n)}},A=async()=>{try{const{data:n}=await ve({pageIndex:1,pageSize:100});if(n&&Array.isArray(n)){const r=n.filter(R=>Math.sqrt((R.longitude-z.value.longitude)**2+(R.latitude-z.value.latitude)**2)<=.1);D.value=r}else D.value=[]}catch(n){console.error("è·å–åœ¨çº¿éª‘æ‰‹å¤±è´¥:",n),D.value=[]}},k=()=>{y.value.page=1,p()},E=()=>{v.value={orderId:"",status:null,startDate:null,endDate:null},y.value.page=1,p()},U=n=>{T.value=n,console.log("åœ°å›¾åŠ è½½å®Œæˆ"),m()},j=n=>{z.value=n},Y=n=>{console.log("ç‚¹å‡»éª‘æ‰‹:",n)};ue(async()=>{!h.userInfo.userId&&h.token&&await h.initUserInfo(),h.userInfo.userId||Object.assign(h.userInfo,{userId:`rider_${Date.now()}`,userName:"æµ‹è¯•éª‘æ‰‹",roles:["rider"],buttons:[]}),await p(),await m(),await A()});const W=n=>{y.value.page=n,p()};async function Z(n){try{w.value=n,$.value=!0,f.value=null,n.assignId&&await t(n.assignId)}catch(l){console.error("æ‰“å¼€è®¢å•è¯¦æƒ…å¤±è´¥:",l),window.$message?.error("æ‰“å¼€è®¢å•è¯¦æƒ…å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}}async function V(n,l){const r={1:"æ¥å•",2:"æ‹’å•",3:"å®Œæˆè®¢å•"}[l]||"æ›´æ–°çŠ¶æ€";try{window.$dialog?.warning({title:`ç¡®è®¤${r}`,content:`ç¡®å®šè¦${r}è®¢å• ${n.order?.orderId} å—ï¼Ÿ`,positiveText:"ç¡®å®š",negativeText:"å–æ¶ˆ",onPositiveClick:async()=>{try{const R=n.assignId||"";await Ee(d.value,R,{acceptedStatus:l}),window.$message?.success(`${r}æˆåŠŸï¼`),await p(),$.value&&n.assignId&&await t(n.assignId)}catch(R){Fe(R,`${r}å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•`)}}})}catch(R){console.error("æ“ä½œå¤±è´¥",R)}}const fe=Q(()=>!g.value||!Array.isArray(g.value)?[]:g.value);return(n,l)=>(J(),H("div",qe,[a(e(F),{bordered:!1,class:"mb-24px"},{default:o(()=>l[5]||(l[5]=[x("div",{class:"flex items-center justify-between"},[x("div",{class:"flex-1"},[x("h1",{class:"text-2xl text-gray-800 font-bold dark:text-gray-200"},"é…é€è®¢å•ç®¡ç†"),x("p",{class:"mt-8px text-gray-600 dark:text-gray-400"},"æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„é…é€è®¢å•ï¼ŒåŠæ—¶å¤„ç†è®¢å•çŠ¶æ€ã€‚")])],-1)])),_:1,__:[5]}),a(e(F),{bordered:!1,class:"mb-24px"},{default:o(()=>[a(e(Le),{model:v.value,inline:""},{default:o(()=>[a(e(q),{label:"è®¢å•å·"},{default:o(()=>[a(e(te),{value:v.value.orderId,"onUpdate:value":l[0]||(l[0]=r=>v.value.orderId=r),placeholder:"è¯·è¾“å…¥è®¢å•å·",style:{width:"200px"}},null,8,["value"])]),_:1}),a(e(q),{label:"çŠ¶æ€"},{default:o(()=>[a(e(Re),{value:v.value.status,"onUpdate:value":l[1]||(l[1]=r=>v.value.status=r),options:G,placeholder:"è¯·é€‰æ‹©çŠ¶æ€",style:{width:"150px"}},null,8,["value"])]),_:1}),a(e(q),{label:"åˆ›å»ºæ—¶é—´"},{default:o(()=>[a(e(oe),null,{default:o(()=>[a(e(te),{value:v.value.startDate,"onUpdate:value":l[2]||(l[2]=r=>v.value.startDate=r),placeholder:"å¼€å§‹æ—¥æœŸ (YYYY-MM-DD)",style:{width:"150px"}},null,8,["value"]),l[6]||(l[6]=x("span",null,"è‡³",-1)),a(e(te),{value:v.value.endDate,"onUpdate:value":l[3]||(l[3]=r=>v.value.endDate=r),placeholder:"ç»“æŸæ—¥æœŸ (YYYY-MM-DD)",style:{width:"150px"}},null,8,["value"])]),_:1,__:[6]})]),_:1}),a(e(q),null,{default:o(()=>[a(e(oe),null,{default:o(()=>[a(e(L),{type:"primary",onClick:k},{default:o(()=>l[7]||(l[7]=[_("æœç´¢")])),_:1,__:[7]}),a(e(L),{onClick:E},{default:o(()=>l[8]||(l[8]=[_("é‡ç½®")])),_:1,__:[8]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(e(ke),{type:"line",animated:""},{default:o(()=>[a(e(ne),{name:"orders",tab:"è®¢å•åˆ—è¡¨"},{default:o(()=>[a(e(F),{bordered:!1,class:"rounded-16px shadow-sm"},{default:o(()=>[a(e(Te),{columns:[{title:"è®¢å•å·",key:"orderId",render:r=>r.order?.orderId||"-"},{title:"é…é€åœ°å€",key:"address",render:r=>r.order?.address?.detailedAddress||"-"},{title:"å•†å®¶åç§°",key:"merchant",render:r=>r.order?.address?.receiverName||"-"},{title:"çŠ¶æ€",key:"status",render(r){const R=r.acceptedStatus||0,B=P[R]||{text:"æœªçŸ¥",type:"default"};return S(e(ae),{type:B.type,size:"small"},{default:()=>B.text})}},{title:"é‡‘é¢",key:"amount",render:r=>`ï¿¥${r.order?.orderAmount||0}`},{title:"åˆ›å»ºæ—¶é—´",key:"createAt",render:r=>r.order?.createAt||"-"},{title:"æ“ä½œ",key:"actions",render(r){const R=r.acceptedStatus||0,B=[];return B.push(S(e(L),{size:"small",type:"primary",onClick:()=>Z(r)},{default:()=>"è¯¦æƒ…"})),R===0?B.push(S(e(L),{size:"small",type:"success",onClick:()=>V(r,1)},{default:()=>"æ¥å•"}),S(e(L),{size:"small",type:"warning",onClick:()=>V(r,2)},{default:()=>"æ‹’å•"})):R===1&&B.push(S(e(L),{size:"small",type:"success",onClick:()=>V(r,3)},{default:()=>"å®Œæˆ"})),S(e(oe),null,{default:()=>B})}}],data:fe.value,loading:i.value,pagination:y.value,"onUpdate:page":W},null,8,["columns","data","loading","pagination"])]),_:1})]),_:1}),a(e(ne),{name:"map",tab:"é…é€åœ°å›¾"},{default:o(()=>[a(e(F),{bordered:!1,class:"rounded-16px shadow-sm"},{default:o(()=>[l[12]||(l[12]=x("div",{class:"mb-16px flex items-center justify-between"},[x("div",null,[x("h3",{class:"text-lg font-semibold mb-8px"},"å®æ—¶é…é€åœ°å›¾"),x("p",{class:"text-gray-600 text-sm"},"æŸ¥çœ‹éª‘æ‰‹ä½ç½®å’Œé…é€è·¯çº¿")])],-1)),a(Je,{center:z.value,zoom:12,"show-riders":!0,onMapReady:U,onLocationUpdate:j,onRiderClick:Y},null,8,["center"]),x("div",Qe,[a(e(F),{size:"small",class:"text-center"},{default:o(()=>[x("div",Xe,I(z.value.longitude.toFixed(6)),1),l[9]||(l[9]=x("div",{class:"text-sm text-gray-500"},"ç»åº¦",-1))]),_:1,__:[9]}),a(e(F),{size:"small",class:"text-center"},{default:o(()=>[x("div",et,I(z.value.latitude.toFixed(6)),1),l[10]||(l[10]=x("div",{class:"text-sm text-gray-500"},"çº¬åº¦",-1))]),_:1,__:[10]}),a(e(F),{size:"small",class:"text-center"},{default:o(()=>[x("div",tt,I(D.value.length),1),l[11]||(l[11]=x("div",{class:"text-sm text-gray-500"},"åŒºåŸŸå†…éª‘æ‰‹",-1))]),_:1,__:[11]})])]),_:1,__:[12]})]),_:1})]),_:1}),a(e(Oe),{show:$.value,"onUpdate:show":l[4]||(l[4]=r=>$.value=r),preset:"card",title:"è®¢å•è¯¦æƒ…",class:"w-[600px]",loading:c.value},{default:o(()=>[!c.value&&f.value?(J(),H("div",at,[a(e(ie),{"label-placement":"left",bordered:"",column:1},{default:o(()=>[a(e(M),{label:"è®¢å•å·"},{default:o(()=>[_(I(f.value.order?.orderId||"-"),1)]),_:1}),a(e(M),{label:"é…é€åœ°å€"},{default:o(()=>[_(I(f.value.order?.address?.detailedAddress||"-"),1)]),_:1}),a(e(M),{label:"æ”¶è´§äººå§“å"},{default:o(()=>[_(I(f.value.order?.address?.receiverName||"-"),1)]),_:1}),a(e(M),{label:"æ”¶è´§äººç”µè¯"},{default:o(()=>[_(I(f.value.order?.address?.receiverPhone||"-"),1)]),_:1}),a(e(M),{label:"åˆ†é…æ—¶é—´"},{default:o(()=>[_(I(f.value.assignedAt||"-"),1)]),_:1}),a(e(M),{label:"æ¥å•æ—¶é—´"},{default:o(()=>[_(I(f.value.acceptedAt||"-"),1)]),_:1}),a(e(M),{label:"è®¢å•é‡‘é¢"},{default:o(()=>[_("ï¿¥"+I(f.value.order?.orderAmount||0),1)]),_:1}),a(e(M),{label:"è®¢å•çŠ¶æ€"},{default:o(()=>[a(e(ae),{type:P[f.value.acceptedStatus||0]?.type||"default",size:"small"},{default:o(()=>[_(I(P[f.value.acceptedStatus||0]?.text||"æœªçŸ¥"),1)]),_:1},8,["type"])]),_:1}),a(e(M),{label:"åˆ›å»ºæ—¶é—´"},{default:o(()=>[_(I(f.value.order?.createAt||"-"),1)]),_:1}),a(e(M),{label:"è¶…æ—¶æ—¶é—´"},{default:o(()=>[_(I(f.value.timeOut||0)+" åˆ†é’Ÿ ",1)]),_:1})]),_:1})])):!c.value&&w.value?(J(),H("div",ot,[a(e(ie),{"label-placement":"left",bordered:"",column:1},{default:o(()=>[a(e(M),{label:"è®¢å•å·"},{default:o(()=>[_(I(w.value.order?.orderId||"-"),1)]),_:1}),a(e(M),{label:"é…é€åœ°å€"},{default:o(()=>[_(I(w.value.order?.address?.detailedAddress||"-"),1)]),_:1}),a(e(M),{label:"æ”¶è´§äººå§“å"},{default:o(()=>[_(I(w.value.order?.address?.receiverName||"-"),1)]),_:1}),a(e(M),{label:"æ”¶è´§äººç”µè¯"},{default:o(()=>[_(I(w.value.order?.address?.receiverPhone||"-"),1)]),_:1}),a(e(M),{label:"è®¢å•é‡‘é¢"},{default:o(()=>[_("ï¿¥"+I(w.value.order?.orderAmount||0),1)]),_:1}),a(e(M),{label:"åˆ›å»ºæ—¶é—´"},{default:o(()=>[_(I(w.value.order?.createAt||"-"),1)]),_:1}),a(e(M),{label:"è®¢å•çŠ¶æ€"},{default:o(()=>[a(e(ae),{type:P[w.value.acceptedStatus||0]?.type||"default",size:"small"},{default:o(()=>[_(I(P[w.value.acceptedStatus||0]?.text||"æœªçŸ¥"),1)]),_:1},8,["type"])]),_:1})]),_:1}),l[13]||(l[13]=x("div",{class:"mt-16px text-center text-gray-500"},[x("p",null,"è¯¦ç»†åˆ†é…ä¿¡æ¯åŠ è½½ä¸­...")],-1))])):c.value?(J(),H("div",lt,l[14]||(l[14]=[x("p",{class:"text-gray-500"},"æ­£åœ¨åŠ è½½è®¢å•è¯¦æƒ…...",-1)]))):De("",!0)]),_:1},8,["show","loading"])]))}}),ut=pe(rt,[["__scopeId","data-v-621f1f1a"]]);export{ut as default};
