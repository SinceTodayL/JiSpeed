import{g as B,u as O}from"./rider-DcLWKAtR.js";import{_ as D,N as M,a as d,h as T,c as V}from"./rider-error-handler-DqmGt7rc.js";import{d as E,r as y,O as P,a as U,b as R,o as A,f as a,w as s,e as g,h as t,M as C,R as f,P as S,B as v,c as j,I as L,g as u,t as c,Q,S as q}from"./index-DSqQRdfM.js";import{_ as F}from"./Space-DnyABEot.js";const G={class:"h-full p-24px"},I="1663b73718a54c65b32f5b6787972949",H=E({name:"delivery",__name:"index",setup(J){const m=y([]),x=y(!1),i=y({page:1,pageSize:10,itemCount:0}),h=y(!1),n=y(null),b={0:{text:"未处理",type:"warning"},1:{text:"配送中",type:"info"},2:{text:"已接单",type:"primary"},3:{text:"已完成",type:"success"},4:{text:"已拒单",type:"error"}},k=async()=>{x.value=!0;try{const r={page:i.value.page,pageSize:i.value.pageSize},{data:l}=await B(I,r);Array.isArray(l)?(m.value=l,i.value.itemCount=l.length):(m.value=[],i.value.itemCount=0)}catch(r){T(r,"获取订单数据")}finally{x.value=!1}};P(k);const N=r=>{i.value.page=r,k()};function z(r){n.value=r,h.value=!0}async function w(r,l){const p={1:"接单",2:"拒单",3:"完成订单"}[l]||"更新状态";try{window.$dialog?.warning({title:`确认${p}`,content:`确定要${p}订单 ${r.order?.orderId} 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const e=r.assignId||"";await O(I,e,{acceptedStatus:l}),window.$message?.success(`${p}成功！`),await k()}catch(e){V(e,`${p}失败，请稍后重试`)}}})}catch(e){console.error("操作失败",e)}}const $=U(()=>!m.value||!Array.isArray(m.value)?[]:m.value);return(r,l)=>{const p=D;return A(),R("div",G,[a(t(C),{bordered:!1,class:"mb-24px"},{default:s(()=>l[1]||(l[1]=[g("div",{class:"flex items-center justify-between"},[g("div",{class:"flex-1"},[g("h1",{class:"text-2xl text-gray-800 font-bold dark:text-gray-200"},"配送订单管理"),g("p",{class:"mt-8px text-gray-600 dark:text-gray-400"},"查看和管理您的配送订单，及时处理订单状态。")])],-1)])),_:1,__:[1]}),a(t(C),{bordered:!1,class:"rounded-16px shadow-sm"},{default:s(()=>[a(p,{columns:[{title:"订单号",key:"orderId",render:e=>e.order?.orderId||"-"},{title:"配送地址",key:"address",render:e=>e.order?.deliveryAddress||"-"},{title:"商家名称",key:"merchant",render:e=>e.order?.merchantName||"-"},{title:"状态",key:"status",render(e){const _=e.acceptedStatus||0,o=b[_]||{text:"未知",type:"default"};return f(t(S),{type:o.type,size:"small"},{default:()=>o.text})}},{title:"金额",key:"amount",render:e=>`￥${e.order?.orderAmount||0}`},{title:"创建时间",key:"createAt",render:e=>e.order?.createAt||"-"},{title:"操作",key:"actions",render(e){const _=e.acceptedStatus||0,o=[];return o.push(f(t(v),{size:"small",type:"primary",onClick:()=>z(e)},{default:()=>"详情"})),_===0?o.push(f(t(v),{size:"small",type:"success",onClick:()=>w(e,1)},{default:()=>"接单"}),f(t(v),{size:"small",type:"warning",onClick:()=>w(e,2)},{default:()=>"拒单"})):_===1&&o.push(f(t(v),{size:"small",type:"success",onClick:()=>w(e,3)},{default:()=>"完成"})),f(t(F),null,{default:()=>o})}}],data:$.value,loading:x.value,pagination:i.value,"onUpdate:page":N},null,8,["columns","data","loading","pagination"])]),_:1}),a(t(Q),{show:h.value,"onUpdate:show":l[0]||(l[0]=e=>h.value=e),preset:"card",title:"订单详情",class:"w-[600px]"},{default:s(()=>[n.value?(A(),j(t(M),{key:0,"label-placement":"left",bordered:"",column:1},{default:s(()=>[a(t(d),{label:"订单号"},{default:s(()=>[u(c(n.value.order?.orderId||"-"),1)]),_:1}),a(t(d),{label:"配送地址"},{default:s(()=>[u(c(n.value.order?.deliveryAddress||"-"),1)]),_:1}),a(t(d),{label:"商家名称"},{default:s(()=>[u(c(n.value.order?.merchantName||"-"),1)]),_:1}),a(t(d),{label:"分配时间"},{default:s(()=>[u(c(n.value.assignedAt||"-"),1)]),_:1}),a(t(d),{label:"订单金额"},{default:s(()=>[u("￥"+c(n.value.order?.orderAmount||0),1)]),_:1}),a(t(d),{label:"订单状态"},{default:s(()=>[a(t(S),{type:b[n.value.acceptedStatus||0]?.type||"default",size:"small"},{default:s(()=>[u(c(b[n.value.acceptedStatus||0]?.text||"未知"),1)]),_:1},8,["type"])]),_:1}),a(t(d),{label:"创建时间"},{default:s(()=>[u(c(n.value.order?.createAt||"-"),1)]),_:1})]),_:1})):L("",!0)]),_:1},8,["show"])])}}}),Z=q(H,[["__scopeId","data-v-2921457d"]]);export{Z as default};
