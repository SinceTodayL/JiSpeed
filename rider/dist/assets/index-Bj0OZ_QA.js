import{Y as H,d as Te,r as v,a9 as ne,a1 as Oe,aa as et,ab as De,a as L,o as k,b as e,I as z,N as tt,h as Q,w as g,e as s,g as a,a2 as n,B as C,t as d,f as _,a8 as $e,m as pe,Z as at,a0 as ot,ac as rt,c as Me,M as ae,Q as w,a5 as me,ad as st,ae as Ae,a6 as Se,F as lt,y as it,af as ze,ag as nt}from"./index-CMAb16hT.js";import{_ as dt}from"./Spin-DOHlLna8.js";import{_ as ut}from"./Progress-CdDY_PtY.js";import{N as ct,a as gt,b as re}from"./DescriptionsItem-Dzvc3U3y.js";import{_ as vt}from"./Space-BEGBHwHL.js";function Ne(x,M,A){return H({url:`/api/Riders/${x}/assignments/${M}`,method:"patch",data:A})}function pt(x,M){return H({url:`/api/Riders/${x}/assignments/${M}`,method:"patch",data:{AcceptedStatus:3}})}const Ce={getOrderNavigationRoute:(x,M)=>H({url:`/api/navigation/order/${x}/rider/${M}/route`,method:"get"}),getOrderNavigationUpdates:(x,M)=>H({url:`/api/navigation/order/${x}/rider/${M}/updates`,method:"get"}),getNavigationRoute:x=>H({url:"/api/navigation/route",method:"post",data:x}),getRealTimeNavigation:x=>H({url:"/api/navigation/realtime",method:"post",data:x}),getNearbyServices:(x,M,A="all",u=2e3)=>H({url:`/api/navigation/nearby?longitude=${x}&latitude=${M}&serviceType=${A}&radius=${u}`,method:"get"})};function fe(x,M="订单操作失败，请稍后重试"){let A=M,u="";if(x?.response?.data){const T=x.response.data;u=String(T.code||""),A=T.msg||A}const c={ORDER_001:"订单不存在",ORDER_002:"订单状态不允许此操作",ORDER_003:"订单已被其他骑手接单",ORDER_004:"订单已超时",ORDER_005:"订单金额异常",ORDER_006:"订单地址信息不完整"};return u&&c[u]&&(A=c[u]),window.$message?.error(A),{errorCode:u,message:A,originalError:x}}function mt(x,M="操作"){let A=`${M}失败，请稍后重试`,u="";if(x?.response?.data){const c=x.response.data;u=String(c.code||""),A=c.msg||A}return x?.code==="NETWORK_ERROR"?A="网络连接失败，请检查网络设置":x?.code==="TIMEOUT"&&(A="请求超时，请稍后重试"),window.$message?.error(A),{errorCode:u,message:A,originalError:x}}const N={key:"2bc67deced375a36fb9db0937fb48d56",version:"2.0",plugins:["AMap.Scale","AMap.ToolBar","AMap.Geolocation","AMap.Driving","AMap.Walking","AMap.Transfer","AMap.DistrictSearch","AMap.Geocoder","AMap.AutoComplete","AMap.PlaceSearch","AMap.Weather"],mapStyle:"amap://styles/normal",defaultCenter:{longitude:116.397428,latitude:39.90923},defaultZoom:13,mapOptions:{showRoad:!0,showBuilding:!0,showLabel:!0,showTraffic:!1,showHeatmap:!1,showSatellite:!1,showRealtimeTraffic:!1},geolocationOptions:{enableHighAccuracy:!0,timeout:1e4,maximumAge:0,convert:!0,showButton:!1,buttonPosition:"LB",showMarker:!1,showCircle:!1,panToLocation:!0,zoomToAccuracy:!0},routeOptions:{policy:"LEAST_TIME",avoidHighways:!1,avoidTolls:!1,avoidCongestion:!1},markerIcons:{rider:{size:[32,32],image:"data:image/svg+xml;base64,"+btoa(`
        <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
          <circle cx="16" cy="16" r="12" fill="#1890ff" stroke="#fff" stroke-width="2"/>
          <circle cx="16" cy="16" r="4" fill="#fff"/>
          <path d="M16 4 L20 16 L16 28 L12 16 Z" fill="#1890ff" opacity="0.6"/>
        </svg>
      `)},order:{size:[24,24],image:"data:image/svg+xml;base64,"+btoa(`
        <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" fill="#ff4d4f" stroke="#fff" stroke-width="2"/>
          <text x="12" y="16" text-anchor="middle" fill="#fff" font-size="12" font-weight="bold">O</text>
        </svg>
      `)},merchant:{size:[24,24],image:"data:image/svg+xml;base64,"+btoa(`
        <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" fill="#52c41a" stroke="#fff" stroke-width="2"/>
          <text x="12" y="16" text-anchor="middle" fill="#fff" font-size="12" font-weight="bold">M</text>
        </svg>
      `)},user:{size:[24,24],image:"data:image/svg+xml;base64,"+btoa(`
        <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" fill="#722ed1" stroke="#fff" stroke-width="2"/>
          <text x="12" y="16" text-anchor="middle" fill="#fff" font-size="12" font-weight="bold">U</text>
        </svg>
      `)}},polylineStyles:{default:{strokeColor:"#1890ff",strokeWeight:4,strokeOpacity:.8,lineJoin:"round",lineCap:"round"},completed:{strokeColor:"#52c41a",strokeWeight:4,strokeOpacity:.8,lineJoin:"round",lineCap:"round"},current:{strokeColor:"#fa8c16",strokeWeight:4,strokeOpacity:.8,lineJoin:"round",lineCap:"round"}},accuracyCircleStyles:{fillColor:"#1890ff",fillOpacity:.1,strokeColor:"#1890ff",strokeOpacity:.3,strokeWeight:1}},ft={class:"amap-container"},yt={key:0,class:"map-controls"},ht={class:"zoom-controls"},xt={key:1,class:"map-loading"},wt={key:2,class:"map-error"},_t={class:"error-text"},bt=Te({__name:"amap-map",props:{height:{default:400},longitude:{default:116.397428},latitude:{default:39.90923},zoom:{default:13},showControls:{type:Boolean,default:!0},enableLocation:{type:Boolean,default:!0},showRiderLocation:{type:Boolean,default:!0},showOrderLocations:{type:Boolean,default:!0},riderLocation:{},orderLocations:{},showRoute:{type:Boolean,default:!1},routeData:{},enableNavigation:{type:Boolean,default:!1},navigationStart:{},navigationEnd:{}},emits:["mapReady","mapClick","riderLocationUpdate","orderClick","navigationStart","routePlanned"],setup(x,{expose:M,emit:A}){const u=x,c=A,T=v(),R=v(!0),F=v(""),Y=v(!1),p=v(null),I=v(null),S=v([]),Z=v(null),j=v(null),f=v(null),B=v(null),E=v(null),se=async()=>{try{R.value=!0,F.value="",window.AMap||await $(),p.value=new window.AMap.Map(T.value,{zoom:u.zoom,center:[u.longitude,u.latitude],mapStyle:N.mapStyle,...N.mapOptions}),p.value.addControl(new window.AMap.Scale),p.value.addControl(new window.AMap.ToolBar),u.enableNavigation&&(j.value=new window.AMap.Driving({map:p.value,showTraffic:!0,hideMarkers:!1,autoFitView:!0})),p.value.on("click",o=>{c("mapClick",o.lnglat.lng,o.lnglat.lat)}),u.showRiderLocation&&u.riderLocation&&D(u.riderLocation),u.showOrderLocations&&u.orderLocations&&q(u.orderLocations),u.showRoute&&u.routeData&&G(u.routeData),R.value=!1,c("mapReady",p.value)}catch(o){F.value=o.message||"地图初始化失败",R.value=!1}},$=()=>new Promise((o,l)=>{if(window.AMap){o();return}const y=document.createElement("script");y.src=`https://webapi.amap.com/maps?v=${N.version}&key=${N.key}&plugin=${N.plugins.join(",")}`,y.onload=()=>o(),y.onerror=()=>l(new Error("高德地图API加载失败")),document.head.appendChild(y)}),D=o=>{if(!p.value)return;I.value&&p.value.remove(I.value);const l=new window.AMap.Marker({position:[o.longitude,o.latitude],icon:new window.AMap.Icon({size:new window.AMap.Size(N.markerIcons.rider.size[0],N.markerIcons.rider.size[1]),image:N.markerIcons.rider.image,imageSize:new window.AMap.Size(N.markerIcons.rider.size[0],N.markerIcons.rider.size[1])}),title:"骑手位置"});if(o.accuracy){const y=new window.AMap.Circle({center:[o.longitude,o.latitude],radius:o.accuracy,...N.accuracyCircleStyles});p.value.add(y)}p.value.add(l),I.value=l,p.value.setCenter([o.longitude,o.latitude])},q=o=>{p.value&&(S.value.forEach(l=>p.value.remove(l)),S.value=[],o.forEach(l=>{const y=new window.AMap.Marker({position:[l.longitude,l.latitude],icon:new window.AMap.Icon({size:new window.AMap.Size(N.markerIcons.order.size[0],N.markerIcons.order.size[1]),image:N.markerIcons.order.image,imageSize:new window.AMap.Size(N.markerIcons.order.size[0],N.markerIcons.order.size[1])}),title:l.title});y.on("click",()=>{c("orderClick",l.id)}),p.value.add(y),S.value.push(y)}))},G=o=>{if(!p.value||o.length<2)return;Z.value&&p.value.remove(Z.value);const l=new window.AMap.Polyline({path:o.map(y=>[y.longitude,y.latitude]),...N.polylineStyles.default});p.value.add(l),Z.value=l,p.value.setFitView([l])},ee=()=>{if(!p.value)return;Y.value=!0,new window.AMap.Geolocation(N.geolocationOptions).getCurrentPosition((l,y)=>{if(Y.value=!1,l==="complete"){const b={longitude:y.position.lng,latitude:y.position.lat,accuracy:y.accuracy};D(b),c("riderLocationUpdate",b)}else F.value="定位失败："+y.message})},ie=()=>{p.value&&p.value.zoomIn()},J=()=>{p.value&&p.value.zoomOut()};ne(()=>u.riderLocation,o=>{o&&u.showRiderLocation&&D(o)},{deep:!0}),ne(()=>u.orderLocations,o=>{o&&u.showOrderLocations&&q(o)},{deep:!0}),ne(()=>u.routeData,o=>{o&&u.showRoute&&G(o)},{deep:!0}),Oe(()=>{et(()=>{se()})}),De(()=>{p.value&&p.value.destroy()});const W=(o,l)=>{if(p.value){if(!o||!l||typeof o.longitude!="number"||typeof o.latitude!="number"||typeof l.longitude!="number"||typeof l.latitude!="number"){console.error("addNavigationMarkers: 无效的起点或终点参数",{start:o,end:l});return}B.value&&p.value.remove(B.value),E.value&&p.value.remove(E.value),B.value=new window.AMap.Marker({position:[o.longitude,o.latitude],icon:new window.AMap.Icon({size:new window.AMap.Size(32,32),image:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiMwMEE2RjUiLz4KPHBhdGggZD0iTTE2IDhMMjAgMTZMMTYgMjRMMTIgMTZMMTYgOFoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=",imageSize:new window.AMap.Size(32,32)}),title:"起点"}),E.value=new window.AMap.Marker({position:[l.longitude,l.latitude],icon:new window.AMap.Icon({size:new window.AMap.Size(32,32),image:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiNGRjQ0NDQiLz4KPHBhdGggZD0iTTE2IDhMMjAgMTZMMTYgMjRMMTIgMTZMMTYgOFoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=",imageSize:new window.AMap.Size(32,32)}),title:"终点"}),p.value.add(B.value),p.value.add(E.value),console.log("导航标记已添加:",{start:o,end:l})}},te=(o,l)=>{if(j.value){if(!o||!l||typeof o.longitude!="number"||typeof o.latitude!="number"||typeof l.longitude!="number"||typeof l.latitude!="number"){console.error("startNavigation: 无效的起点或终点参数",{start:o,end:l});return}W(o,l),j.value.search([o.longitude,o.latitude],[l.longitude,l.latitude],(y,b)=>{y==="complete"?(f.value=b,c("routePlanned",b),console.log("导航路径规划完成:",b)):console.error("导航路径规划失败:",b)})}},X=()=>{j.value&&(j.value.clear(),f.value=null),B.value&&p.value&&(p.value.remove(B.value),B.value=null),E.value&&p.value&&(p.value.remove(E.value),E.value=null)},de=(o,l)=>{if(!window.AMap)return 0;if(!o||!l||typeof o.longitude!="number"||typeof o.latitude!="number"||typeof l.longitude!="number"||typeof l.latitude!="number")return console.error("calculateDistance: 无效的起点或终点参数",{start:o,end:l}),0;const y=new window.AMap.LngLat(o.longitude,o.latitude),b=new window.AMap.LngLat(l.longitude,l.latitude);return y.distance(b)};ne(()=>[u.navigationStart,u.navigationEnd],([o,l])=>{o&&l&&u.enableNavigation&&te(o,l)},{deep:!0});const P=(o,l,y)=>{if(!(!p.value||!window.AMap)){if(!o||!l||typeof o.longitude!="number"||typeof o.latitude!="number"||typeof l.longitude!="number"||typeof l.latitude!="number"){console.error("drawNavigationRoute: 无效的起点或终点参数",{start:o,end:l});return}if(X(),W(o,l),y)try{const b=V(y);if(b&&b.length>0){const K=new window.AMap.Polyline({path:b,strokeColor:"#1890ff",strokeWeight:6,strokeOpacity:.8,strokeStyle:"solid",lineJoin:"round",lineCap:"round"});p.value.add(K),f.value=K,p.value.setFitView([K])}}catch(b){console.error("绘制导航路线失败:",b)}else{const b=new window.AMap.Polyline({path:[new window.AMap.LngLat(o.longitude,o.latitude),new window.AMap.LngLat(l.longitude,l.latitude)],strokeColor:"#1890ff",strokeWeight:4,strokeOpacity:.6,strokeStyle:"dashed"});p.value.add(b),f.value=b}}},V=o=>{if(!o)return null;try{if(o.startsWith("[")||o.startsWith("{")){const l=JSON.parse(o);if(Array.isArray(l))return l.map(y=>new window.AMap.LngLat(y.longitude||y.lng,y.latitude||y.lat))}return null}catch(l){return console.error("解析polyline失败:",l),null}};return M({map:p,locateUser:ee,addRiderMarker:D,addOrderMarkers:q,addRoutePolyline:G,addNavigationMarkers:W,startNavigation:te,clearNavigation:X,clearNavigationRoute:()=>{X()},drawNavigationRoute:P,calculateDistance:de}),(o,l)=>(k(),L("div",ft,[e("div",{ref_key:"mapContainer",ref:T,class:"map-container",style:tt({height:o.height+"px"})},null,4),o.showControls?(k(),L("div",yt,[o.enableLocation?(k(),Q(a(C),{key:0,type:"primary",size:"small",circle:"",onClick:ee,loading:Y.value,class:"control-btn"},{icon:g(()=>[s(a(n),{icon:"mdi:crosshairs-gps"})]),_:1},8,["loading"])):z("",!0),e("div",ht,[s(a(C),{size:"small",circle:"",onClick:ie,class:"control-btn"},{icon:g(()=>[s(a(n),{icon:"mdi:plus"})]),_:1}),s(a(C),{size:"small",circle:"",onClick:J,class:"control-btn"},{icon:g(()=>[s(a(n),{icon:"mdi:minus"})]),_:1})])])):z("",!0),R.value?(k(),L("div",xt,[s(a(dt),{size:"large"}),l[0]||(l[0]=e("div",{class:"loading-text"},"地图加载中...",-1))])):z("",!0),F.value?(k(),L("div",wt,[s(a(n),{icon:"mdi:alert-circle",class:"error-icon"}),e("div",_t,d(F.value),1),s(a(C),{size:"small",onClick:se},{default:g(()=>l[1]||(l[1]=[_("重试")])),_:1,__:[1]})])):z("",!0)]))}}),kt=$e(bt,[["__scopeId","data-v-c00dc161"]]);function Re(x){return H({url:"/api/RiderLocations",method:"post",data:x})}function It(x){return H({url:`/api/RiderLocations/${x}/latest`,method:"get"})}function Le(x){return H({url:"/api/RiderLocations/geocode",method:"post",data:x})}const Mt={class:"min-h-full p-24px bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 relative overflow-hidden"},At={class:"flex items-center gap-3"},St={class:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center"},zt={class:"flex-1"},Nt={class:"text-2xl text-gray-800 font-bold dark:text-gray-200"},Ct={class:"mt-2px text-gray-600 dark:text-gray-400"},Rt={class:"flex items-center space-x-16px"},Lt={class:"flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 rounded-full"},Tt={class:"text-xs font-medium text-green-700 dark:text-green-400"},Ot={class:"flex items-center gap-2 px-3 py-1 bg-blue-100 dark:bg-blue-900/30 rounded-full"},Dt={class:"text-xs font-medium text-blue-700 dark:text-blue-400"},$t={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},Pt={class:"flex items-center justify-between py-2"},jt={class:"text-blue-100 text-sm font-medium"},Et={class:"text-2xl font-bold mt-1"},Zt={class:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center"},Bt={class:"flex items-center justify-between py-2"},Gt={class:"text-orange-100 text-sm font-medium"},Wt={class:"text-2xl font-bold mt-1"},Ut={class:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center"},Ht={class:"flex items-center justify-between py-2"},Ft={class:"text-green-100 text-sm font-medium"},Yt={class:"text-2xl font-bold mt-1"},Jt={class:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center"},Vt={class:"flex items-center justify-between py-2"},Kt={class:"text-purple-100 text-sm font-medium"},Xt={class:"text-2xl font-bold mt-1"},Qt={class:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center"},qt={class:"flex items-center justify-end py-3"},ea={class:"flex items-center gap-3"},ta={class:"bg-gradient-to-r from-gray-50 to-blue-50 dark:from-gray-700 dark:to-gray-800 px-6 py-4 border-b border-gray-200/50 dark:border-gray-600/50"},aa={class:"flex items-center justify-between"},oa={class:"flex items-center gap-3"},ra={class:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center"},sa={class:"text-xl font-bold text-gray-800 dark:text-gray-200"},la={class:"text-gray-600 dark:text-gray-400 text-sm"},ia={class:"flex items-center gap-2 px-3 py-1 bg-white/80 dark:bg-gray-700/80 rounded-full"},na={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},da={class:"p-4"},ua={class:"flex items-center gap-3"},ca={class:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center"},ga={key:0},va={class:"space-y-6"},pa={class:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-700 dark:to-gray-800 rounded-2xl p-6"},ma={class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2"},fa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ya={class:"flex items-center gap-3"},ha={class:"font-semibold text-gray-800 dark:text-gray-200"},xa={class:"flex items-center gap-3"},wa={class:"font-bold text-green-600 dark:text-green-400 text-xl"},_a={class:"bg-gradient-to-r from-orange-50 to-red-50 dark:from-gray-700 dark:to-gray-800 rounded-2xl p-6"},ba={class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2"},ka={class:"space-y-3"},Ia={class:"flex items-start gap-3"},Ma={class:"font-medium text-gray-800 dark:text-gray-200"},Aa={class:"flex items-center gap-3"},Sa={class:"font-medium text-gray-800 dark:text-gray-200"},za={class:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-gray-700 dark:to-gray-800 rounded-2xl p-6"},Na={class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2"},Ca={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ra={class:"flex items-center gap-3"},La={class:"flex items-center gap-3"},Ta={class:"font-medium text-gray-800 dark:text-gray-200"},Oa={class:"bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-gray-700 dark:to-gray-800 rounded-2xl p-6"},Da={class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2"},$a={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Pa={class:"flex items-center gap-3"},ja={class:"font-medium text-gray-800 dark:text-gray-200"},Ea={class:"flex items-center gap-3"},Za={class:"font-medium text-gray-800 dark:text-gray-200"},Ba={class:"flex items-center gap-3"},Ga={class:"font-medium text-gray-800 dark:text-gray-200"},Wa={class:"space-y-4"},Ua={class:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"},Ha={class:"flex items-center gap-2"},Fa={class:"rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600"},Ya={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ja={class:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},Va={class:"font-semibold text-blue-800 dark:text-blue-200 mb-2 flex items-center gap-2"},Ka={class:"space-y-1 text-sm"},Xa={class:"text-gray-600 dark:text-gray-400"},Qa={class:"text-gray-600 dark:text-gray-400"},qa={class:"text-gray-600 dark:text-gray-400"},eo={key:0,class:"text-gray-600 dark:text-gray-400"},to={class:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg"},ao={class:"font-semibold text-green-800 dark:text-green-200 mb-2 flex items-center gap-2"},oo={class:"space-y-1 text-sm"},ro={class:"text-gray-600 dark:text-gray-400"},so={class:"text-gray-600 dark:text-gray-400"},lo={class:"text-gray-600 dark:text-gray-400"},io={key:1},no={key:2,class:"text-center py-32px"},uo={class:"navigation-overview-content"},co={class:"navigation-header"},go={class:"navigation-info"},vo={class:"progress-info"},po={class:"current-step"},mo={class:"navigation-actions"},fo={class:"progress-bar"},yo={key:0,class:"current-step-section"},ho={class:"current-step-header"},xo={class:"current-step-content"},wo={class:"step-instruction"},_o={class:"instruction-text"},bo={key:0,class:"step-road"},ko={key:1,class:"step-turn"},Io={class:"step-distance"},Mo={class:"steps-history"},Ao={class:"history-header"},So={class:"steps-list"},zo={class:"step-number"},No={class:"step-content"},Co={class:"step-instruction-text"},Ro={key:0,class:"step-road-name"},Lo={key:1,class:"step-turn-info"},To={class:"step-distance-info"},Oo={class:"step-status"},Do=Te({name:"delivery",__name:"index",setup(x){const M=pe(),A=at(),{t:u}=ot(),c=rt(),T=Me(()=>A.riderId||M.userInfo.userId),R=v([]),F=v(!1),Y=v({page:1,pageSize:10,itemCount:0});v({});const p=v(!1),I=v(null),S=v(null),Z=v(!1),j=v(!0),f=v(null),B=v([]),E=v(!1),se=v("");v(!1);const $=v(void 0),D=v(void 0),q=v(null),G=v(!1),ee=v(!1),ie=v(null),J=v(0),W=v([]),te=v(!1),X=v(null),de=v(!1),P=v(null),V=v([]),le=v(!1),o=v(null),l=v(null),y=v(!1),b=v(null),K={0:{text:"待接单",type:"warning"},1:{text:"已接单",type:"primary"},2:{text:"已拒绝",type:"error"},3:{text:"已配送",type:"success"}},oe=async()=>{F.value=!0;try{const{data:r}=await nt(T.value,{});Array.isArray(r)?(R.value=r,Y.value.itemCount=R.value.length):(R.value=[],Y.value.itemCount=0)}catch(r){mt(r,"获取订单数据")}finally{F.value=!1}},Pe=async r=>{if(!r.assignId){c.error("订单分配ID不存在");return}try{await Ne(T.value,r.assignId,{AcceptedStatus:1}),c.success("接单成功"),await oe(),await ue(r.assignId)}catch(t){fe(t,"接单失败")}},je=async r=>{if(!r.assignId){c.error("订单分配ID不存在");return}try{await Ne(T.value,r.assignId,{AcceptedStatus:2}),c.success("拒单成功"),await oe()}catch(t){fe(t,"拒单失败")}},Ee=async r=>{if(!r.assignId){c.error("订单分配ID不存在");return}try{await pt(T.value,r.assignId),c.success("订单完成"),await oe(),await ue(r.assignId)}catch(t){fe(t,"完成订单失败")}},ue=async r=>{Z.value=!0;try{I.value&&(S.value={...I.value,assignedAt:I.value.assignedAt||new Date().toISOString(),acceptedAt:I.value.acceptedAt||null,timeOut:30})}catch(t){console.error("获取订单详情失败:",t),window.$message?.warning("订单详情功能暂时不可用，显示基本信息")}finally{Z.value=!1}},Ze=async r=>{try{j.value=r,window.$message?.success(r?"已上线":"已下线")}catch(t){console.error("更新状态失败:",t),window.$message?.error("更新状态失败")}},Be=()=>{Y.value.page=1,oe()};Oe(async()=>{!M.userInfo.userId&&M.token&&await M.initUserInfo(),M.userInfo.userId||Object.assign(M.userInfo,{userId:`rider_${Date.now()}`,userName:"测试骑手",roles:["rider"],buttons:[]}),await oe(),await ce(),B.value=await qe(R.value),Qe()}),De(()=>{we()});const Ge=r=>{Y.value.page=r,oe()};async function ye(r){try{I.value=r,p.value=!0,S.value=null,r.assignId&&await ue(r.assignId)}catch(t){console.error("打开订单详情失败:",t),window.$message?.error("打开订单详情失败，请稍后重试")}}const We=Me(()=>!R.value||!Array.isArray(R.value)?[]:R.value),ce=async()=>{try{E.value=!0,se.value="";const{data:r}=await It(T.value);r&&r.data?(f.value=r.data,console.log("骑手位置获取成功:",r.data)):f.value={riderId:T.value,longitude:116.397428,latitude:39.90923,locationTime:new Date().toISOString(),status:1}}catch(r){se.value="获取骑手位置失败",console.error("获取骑手位置失败:",r),f.value={riderId:T.value,longitude:116.397428,latitude:39.90923,locationTime:new Date().toISOString(),status:1}}finally{E.value=!1}},he=async(r,t,m,i,h)=>{try{await Re({riderId:T.value,longitude:r,latitude:t,accuracy:m,speed:i,direction:h,locationType:"GPS"}),f.value={riderId:T.value,longitude:r,latitude:t,accuracy:m,speed:i,direction:h,locationTime:new Date().toISOString(),status:1,locationType:"GPS"},console.log("骑手位置更新成功:",f.value)}catch(O){console.error("更新骑手位置失败:",O),c.error("更新位置失败: "+(O.message||"未知错误"))}},Ue=(r,t)=>{console.log("地图点击位置:",{longitude:r,latitude:t})},He=async r=>{try{if(typeof r.longitude!="number"||typeof r.latitude!="number"){console.error("无效的位置数据:",r);return}f.value={...f.value,longitude:r.longitude,latitude:r.latitude,locationTime:new Date().toISOString(),status:1},await Re({riderId:T.value,longitude:r.longitude,latitude:r.latitude,locationType:"GPS"}),console.log("骑手位置已更新:",r)}catch(t){console.error("更新骑手位置失败:",t),c.error("位置更新失败")}},Fe=r=>{const t=R.value.find(m=>m.order?.orderId===r);t&&ye(t)},xe=async r=>{try{const t=await Le({address:r});let m=null;if(t.data&&t.data.data&&t.data.data.longitude&&t.data.data.latitude?m=t.data.data:t.data&&t.data.longitude&&t.data.latitude&&(m=t.data),m){const i={longitude:m.longitude,latitude:m.latitude};return console.log(`地理编码成功 - 地址: ${r}, 坐标:`,i),i}return console.warn("地理编码响应数据格式不正确:",t.data),null}catch(t){return console.error("地理编码失败:",t),null}},Ye=async r=>{if(!f.value||typeof f.value.longitude!="number"||typeof f.value.latitude!="number"){c.warning("无法获取骑手位置信息"),console.error("riderLocation 无效:",f.value);return}if(!r.order?.merchantName){c.warning("商家信息不完整");return}try{ee.value=!0,ie.value=null;const m=pe().userInfo.userId||"";c.loading("正在获取导航路线...",{duration:0});const i=await Ce.getOrderNavigationRoute(r.order.orderId,m);if(i&&i.data){const h=i.data,O=await xe(r.order.merchantName);if(!O){c.destroyAll(),c.error("无法解析商家地址，请检查商家名称");return}$.value={longitude:f.value.longitude,latitude:f.value.latitude},D.value=O,G.value=!0,o.value&&typeof o.value.drawNavigationRoute=="function"&&(console.log("调用地图组件绘制导航路线 - 商家",{start:$.value,end:D.value,polyline:h.polyline}),o.value.drawNavigationRoute($.value,D.value,h.polyline),console.log("已调用地图组件绘制导航路线 - 商家")),h.steps&&h.steps.length>0&&_e(h.steps),c.destroyAll(),c.success(`开始导航到商家: ${r.order.merchantName}`),console.log("商家导航设置完成:",{start:$.value,end:D.value,routeData:h})}else c.destroyAll(),c.error("获取导航路线失败: 未知错误")}catch(t){c.destroyAll(),c.error("导航启动失败: "+t.message),console.error("商家导航错误:",t)}finally{ee.value=!1}},Je=async r=>{if(!f.value||typeof f.value.longitude!="number"||typeof f.value.latitude!="number"){c.warning("无法获取骑手位置信息"),console.error("riderLocation 无效:",f.value);return}if(!r.order?.deliveryAddress){c.warning("配送地址信息不完整");return}try{ee.value=!0,ie.value=null;const m=pe().userInfo.userId||"";c.loading("正在获取导航路线...",{duration:0});const i=await Ce.getOrderNavigationRoute(r.order.orderId,m);if(i&&i.data){const h=i.data,O=await xe(r.order.deliveryAddress);if(!O){c.destroyAll(),c.error("无法解析配送地址，请检查地址信息");return}$.value={longitude:f.value.longitude,latitude:f.value.latitude},D.value=O,G.value=!0,o.value&&typeof o.value.drawNavigationRoute=="function"&&(console.log("调用地图组件绘制导航路线 - 配送地址",{start:$.value,end:D.value,polyline:h.polyline}),o.value.drawNavigationRoute($.value,D.value,h.polyline),console.log("已调用地图组件绘制导航路线 - 配送地址")),h.steps&&h.steps.length>0&&_e(h.steps),c.destroyAll(),c.success(`开始导航到配送地址: ${r.order.deliveryAddress}`),console.log("配送地址导航设置完成:",{start:$.value,end:D.value,routeData:h})}else c.destroyAll(),c.error("获取导航路线失败: 未知错误")}catch(t){c.destroyAll(),c.error("导航启动失败: "+t.message),console.error("配送地址导航错误:",t)}finally{ee.value=!1}},Ve=r=>{q.value=r,console.log("路径规划完成:",r)},Ke=()=>{$.value=void 0,D.value=void 0,q.value=null,G.value=!1},U={longitude:121.2139,latitude:31.282,accuracy:10,speed:0,direction:0},Xe=async()=>{if(!y.value){y.value=!0;{console.log("1"),await he(U.longitude,U.latitude,U.accuracy,U.speed,U.direction),b.value=setInterval(async()=>{const r=(Math.random()-.5)*1e-4,t=(Math.random()-.5)*1e-4;await he(U.longitude+r,U.latitude+t,U.accuracy,U.speed,U.direction)},5e3),c.success("开始实时定位");return}}},we=()=>{l.value!==null&&(navigator.geolocation.clearWatch(l.value),l.value=null),b.value&&(clearInterval(b.value),b.value=null),y.value=!1,c.info("停止实时定位")},Qe=()=>{b.value||(b.value=setInterval(async()=>{try{await ce(),console.log("定时更新骑手位置成功")}catch(r){console.error("定时更新位置失败:",r)}},3e4))},qe=async r=>{const t=[];for(const m of r)if(m.order?.deliveryAddress)try{const{data:i}=await Le({address:m.order.deliveryAddress});let h=null;i&&i.data&&i.data.longitude&&i.data.latitude?h=i.data:i&&i.longitude&&i.latitude&&(h=i),h?t.push({id:m.order.orderId||"",orderId:m.order.orderId||"",longitude:h.longitude,latitude:h.latitude,title:`订单 ${m.order.orderId}`,address:m.order.deliveryAddress,status:ge(m.acceptedStatus||0),amount:m.order.orderAmount||0,createTime:m.order.createAt||""}):t.push({id:m.order.orderId||"",orderId:m.order.orderId||"",longitude:116.397428,latitude:39.90923,title:`订单 ${m.order.orderId}`,address:m.order.deliveryAddress,status:ge(m.acceptedStatus||0),amount:m.order.orderAmount||0,createTime:m.order.createAt||""})}catch(i){console.error(`地理编码失败 ${m.order.orderId}:`,i),t.push({id:m.order.orderId||"",orderId:m.order.orderId||"",longitude:116.397428,latitude:39.90923,title:`订单 ${m.order.orderId}`,address:m.order.deliveryAddress,status:ge(m.acceptedStatus||0),amount:m.order.orderAmount||0,createTime:m.order.createAt||""})}return t},ge=r=>({0:"待接单",1:"已接单",2:"已拒绝",3:"已配送"})[r]||"未知",_e=r=>{!r||r.length===0||(W.value=r,J.value=0,V.value=[],te.value=!0,le.value=!0,be(),X.value=setInterval(()=>{be()},3e3))},be=()=>{if(J.value>=W.value.length){ve();return}const r=W.value[J.value];P.value=r,V.value.push(r),J.value++},ve=()=>{te.value=!1,X.value&&(clearInterval(X.value),X.value=null),de.value=!1,le.value=!1,G.value=!1,q.value=null,W.value=[],V.value=[],J.value=0,P.value=null,o.value&&o.value.clearNavigationRoute(),c.success("导航已停止")},ke=r=>({straight:"mdi:arrow-up",left:"mdi:arrow-left",right:"mdi:arrow-right",uturn:"mdi:arrow-u-turn-left",slight_left:"mdi:arrow-top-left",slight_right:"mdi:arrow-top-right",sharp_left:"mdi:arrow-left-bold",sharp_right:"mdi:arrow-right-bold",merge:"mdi:merge",fork_left:"mdi:fork-left",fork_right:"mdi:fork-right",roundabout:"mdi:rotate-right"})[r]||"mdi:arrow-up",Ie=r=>({straight:"直行",left:"左转",right:"右转",uturn:"掉头",slight_left:"微左转",slight_right:"微右转",sharp_left:"急左转",sharp_right:"急右转",merge:"并道",fork_left:"左分叉",fork_right:"右分叉",roundabout:"环岛"})[r]||"直行";return(r,t)=>{const m=ut;return k(),L("div",Mt,[t[38]||(t[38]=e("div",{class:"absolute inset-0 overflow-hidden pointer-events-none"},[e("div",{class:"absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-blue-400/20 to-purple-600/20 rounded-full blur-3xl"}),e("div",{class:"absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-tr from-indigo-400/20 to-pink-600/20 rounded-full blur-3xl"}),e("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-gradient-to-r from-cyan-400/10 to-blue-600/10 rounded-full blur-3xl"})],-1)),s(a(ae),{bordered:!1,class:"mb-24px bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm"},{default:g(()=>[e("div",At,[e("div",St,[s(a(n),{icon:"mdi:motorbike",class:"text-2xl text-white"})]),e("div",zt,[e("h1",Nt,d(a(u)("rider.delivery.title")),1),e("p",Ct,d(a(u)("rider.delivery.subtitle")),1)]),e("div",Rt,[e("div",Lt,[t[5]||(t[5]=e("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"},null,-1)),e("span",Tt,d(a(u)("rider.delivery.realTime")),1)]),e("div",Ot,[s(a(n),{icon:"mdi:shield-check",class:"text-blue-600 dark:text-blue-400 text-sm"}),e("span",Dt,d(a(u)("rider.delivery.secure")),1)])])])]),_:1}),e("div",$t,[s(a(ae),{bordered:!1,class:"bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-xl hover:shadow-2xl transition-all duration-300 hover:-translate-y-1"},{default:g(()=>[e("div",Pt,[e("div",null,[e("p",jt,d(a(u)("rider.delivery.totalOrders")),1),e("p",Et,d(R.value.length),1)]),e("div",Zt,[s(a(n),{icon:"mdi:package-variant",class:"text-xl"})])])]),_:1}),s(a(ae),{bordered:!1,class:"bg-gradient-to-br from-orange-500 to-orange-600 text-white shadow-xl hover:shadow-2xl transition-all duration-300 hover:-translate-y-1"},{default:g(()=>[e("div",Bt,[e("div",null,[e("p",Gt,d(a(u)("rider.delivery.pendingOrders")),1),e("p",Wt,d(R.value.filter(i=>(i.acceptedStatus||0)===0).length),1)]),e("div",Ut,[s(a(n),{icon:"mdi:clock-outline",class:"text-xl"})])])]),_:1}),s(a(ae),{bordered:!1,class:"bg-gradient-to-br from-green-500 to-green-600 text-white shadow-xl hover:shadow-2xl transition-all duration-300 hover:-translate-y-1"},{default:g(()=>[e("div",Ht,[e("div",null,[e("p",Ft,d(a(u)("rider.delivery.acceptedOrders")),1),e("p",Yt,d(R.value.filter(i=>(i.acceptedStatus||0)===1).length),1)]),e("div",Jt,[s(a(n),{icon:"mdi:check-circle",class:"text-xl"})])])]),_:1}),s(a(ae),{bordered:!1,class:"bg-gradient-to-br from-purple-500 to-purple-600 text-white shadow-xl hover:shadow-2xl transition-all duration-300 hover:-translate-y-1"},{default:g(()=>[e("div",Vt,[e("div",null,[e("p",Kt,d(a(u)("rider.delivery.deliveredOrders")),1),e("p",Xt,d(R.value.filter(i=>(i.acceptedStatus||0)===3).length),1)]),e("div",Qt,[s(a(n),{icon:"mdi:truck-delivery",class:"text-xl"})])])]),_:1})]),s(a(ae),{bordered:!1,class:"mb-6 bg-white/90 dark:bg-gray-800/90 backdrop-blur-md rounded-2xl shadow-lg border-0"},{default:g(()=>[e("div",qt,[e("div",ea,[s(a(C),{onClick:Be,type:"primary",ghost:"",class:"px-6 py-2 rounded-xl font-medium"},{default:g(()=>[s(a(n),{icon:"mdi:refresh",class:"mr-2"}),_(" "+d(a(u)("rider.delivery.refresh")),1)]),_:1}),s(a(C),{type:j.value?"success":"warning",onClick:t[0]||(t[0]=i=>Ze(!j.value)),class:"px-6 py-2 rounded-xl font-medium"},{default:g(()=>[s(a(n),{icon:j.value?"mdi:account-check":"mdi:account-off",class:"mr-2"},null,8,["icon"]),_(" "+d(j.value?a(u)("rider.delivery.goOffline"):a(u)("rider.delivery.goOnline")),1)]),_:1},8,["type"])])])]),_:1}),s(a(ae),{bordered:!1,class:"rounded-2xl shadow-xl bg-white/95 dark:bg-gray-800/95 backdrop-blur-md border-0 overflow-hidden"},{default:g(()=>[e("div",ta,[e("div",aa,[e("div",oa,[e("div",ra,[s(a(n),{icon:"mdi:format-list-bulleted",class:"text-white text-lg"})]),e("div",null,[e("h3",sa,d(a(u)("rider.delivery.orderList")),1),e("p",la,d(a(u)("rider.delivery.orderListDesc")),1)])]),e("div",ia,[t[6]||(t[6]=e("div",{class:"w-2 h-2 bg-green-500 rounded-full animate-pulse"},null,-1)),e("span",na,d(a(u)("rider.delivery.realTimeUpdate")),1)])])]),e("div",da,[s(a(ct),{columns:[{title:"订单信息",key:"orderInfo",width:200,render:i=>w("div",{class:"flex items-center gap-3"},[w("div",{class:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center"},[w(a(n),{icon:"mdi:package-variant",class:"text-white text-lg"})]),w("div",{class:"flex-1"},[w("div",{class:"font-semibold text-gray-800 dark:text-gray-200 text-sm"},i.order?.orderId||"-"),w("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"订单编号")])])},{title:"配送地址",key:"address",width:250,render:i=>w("div",{class:"flex items-center gap-2"},[w(a(n),{icon:"mdi:map-marker",class:"text-red-500 text-sm flex-shrink-0"}),w("div",{class:"text-sm text-gray-700 dark:text-gray-300 truncate"},i.order?.deliveryAddress||"-")])},{title:"商家信息",key:"merchant",width:150,render:i=>w("div",{class:"flex items-center gap-2"},[w(a(n),{icon:"mdi:store",class:"text-blue-500 text-sm flex-shrink-0"}),w("div",{class:"text-sm text-gray-700 dark:text-gray-300 truncate"},i.order?.merchantName||"-")])},{title:"订单状态",key:"status",width:120,render(i){const h=i.acceptedStatus||0,O=K[h]||{text:"未知",type:"default"};return w("div",{class:"flex items-center gap-2"},[w("div",{class:`w-2 h-2 rounded-full bg-gradient-to-r ${{0:"from-orange-400 to-orange-500",1:"from-green-400 to-green-500",2:"from-red-400 to-red-500",3:"from-purple-400 to-purple-500"}[h]||"from-gray-400 to-gray-500"}`}),w(a(me),{type:O.type,size:"small",class:"px-3 py-1 rounded-full font-medium"},{default:()=>O.text})])}},{title:"订单金额",key:"amount",width:120,render:i=>w("div",{class:"text-right"},[w("div",{class:"text-lg font-bold text-green-600 dark:text-green-400"},`￥${i.order?.orderAmount||0}`)])},{title:"创建时间",key:"createAt",width:150,render:i=>w("div",{class:"flex items-center gap-2"},[w(a(n),{icon:"mdi:clock-outline",class:"text-gray-400 text-sm flex-shrink-0"}),w("div",{class:"text-sm text-gray-600 dark:text-gray-400"},i.order?.createAt||"-")])},{title:"操作",key:"actions",width:200,render(i){const h=i.acceptedStatus||0,O=[];return O.push(w(a(C),{size:"small",type:"primary",ghost:!0,onClick:()=>ye(i),class:"px-4 py-1 rounded-lg font-medium"},{default:()=>[w(a(n),{icon:"mdi:eye",class:"mr-1 text-sm"}),"详情"]})),h===0?O.push(w(a(C),{size:"small",type:"success",onClick:()=>Pe(i),class:"px-4 py-1 rounded-lg font-medium"},{default:()=>[w(a(n),{icon:"mdi:check",class:"mr-1 text-sm"}),"接单"]}),w(a(C),{size:"small",type:"warning",onClick:()=>je(i),class:"px-4 py-1 rounded-lg font-medium"},{default:()=>[w(a(n),{icon:"mdi:close",class:"mr-1 text-sm"}),"拒绝"]})):h===1&&O.push(w(a(C),{size:"small",type:"success",onClick:()=>Ee(i),class:"px-4 py-1 rounded-lg font-medium"},{default:()=>[w(a(n),{icon:"mdi:truck-delivery",class:"mr-1 text-sm"}),"确认配送"]})),w(a(vt),{size:"small"},{default:()=>O})}}],data:We.value,loading:F.value,pagination:Y.value,"onUpdate:page":Ge,class:"modern-table"},null,8,["columns","data","loading","pagination"])])]),_:1}),s(a(Se),{show:p.value,"onUpdate:show":t[3]||(t[3]=i=>p.value=i),preset:"card",class:"w-[900px] max-w-[95vw]",loading:Z.value,"mask-closable":!1},{header:g(()=>[e("div",ua,[e("div",ca,[s(a(n),{icon:"mdi:package-variant",class:"text-white text-lg"})]),t[7]||(t[7]=e("div",null,[e("h3",{class:"text-xl font-bold text-gray-800 dark:text-gray-200"},"订单详情"),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"查看订单完整信息")],-1))])]),default:g(()=>[!Z.value&&S.value?(k(),L("div",ga,[s(a(st),{type:"line",animated:""},{default:g(()=>[s(a(Ae),{name:"details",tab:"订单详情"},{default:g(()=>[e("div",va,[e("div",pa,[e("h4",ma,[s(a(n),{icon:"mdi:information",class:"text-blue-500"}),t[8]||(t[8]=_(" 基本信息 "))]),e("div",fa,[e("div",ya,[s(a(n),{icon:"mdi:identifier",class:"text-gray-500 text-lg"}),e("div",null,[t[9]||(t[9]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"订单号",-1)),e("p",ha,d(S.value.order?.orderId||"-"),1)])]),e("div",xa,[s(a(n),{icon:"mdi:currency-usd",class:"text-green-500 text-lg"}),e("div",null,[t[10]||(t[10]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"订单金额",-1)),e("p",wa,"￥"+d(S.value.order?.orderAmount||0),1)])])])]),e("div",_a,[e("h4",ba,[s(a(n),{icon:"mdi:map-marker",class:"text-red-500"}),t[11]||(t[11]=_(" 配送信息 "))]),e("div",ka,[e("div",Ia,[s(a(n),{icon:"mdi:map-marker-outline",class:"text-red-500 text-lg mt-1"}),e("div",null,[t[12]||(t[12]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"配送地址",-1)),e("p",Ma,d(S.value.order?.deliveryAddress||"-"),1)])]),e("div",Aa,[s(a(n),{icon:"mdi:store",class:"text-blue-500 text-lg"}),e("div",null,[t[13]||(t[13]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"商家名称",-1)),e("p",Sa,d(S.value.order?.merchantName||"-"),1)])])])]),e("div",za,[e("h4",Na,[s(a(n),{icon:"mdi:timeline",class:"text-green-500"}),t[14]||(t[14]=_(" 状态信息 "))]),e("div",Ca,[e("div",Ra,[t[16]||(t[16]=e("div",{class:"w-3 h-3 bg-gradient-to-r from-green-400 to-green-500 rounded-full"},null,-1)),e("div",null,[t[15]||(t[15]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"当前状态",-1)),s(a(me),{type:K[S.value.acceptedStatus||0]?.type||"default",size:"medium",class:"px-3 py-1 rounded-full font-medium"},{default:g(()=>[_(d(K[S.value.acceptedStatus||0]?.text||"未知"),1)]),_:1},8,["type"])])]),e("div",La,[s(a(n),{icon:"mdi:clock-outline",class:"text-gray-500 text-lg"}),e("div",null,[t[17]||(t[17]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"超时时间",-1)),e("p",Ta,d(S.value.timeOut||0)+" 分钟",1)])])])]),e("div",Oa,[e("h4",Da,[s(a(n),{icon:"mdi:clock",class:"text-purple-500"}),t[18]||(t[18]=_(" 时间信息 "))]),e("div",$a,[e("div",Pa,[s(a(n),{icon:"mdi:calendar-plus",class:"text-gray-500 text-lg"}),e("div",null,[t[19]||(t[19]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"创建时间",-1)),e("p",ja,d(S.value.order?.createAt||"-"),1)])]),e("div",Ea,[s(a(n),{icon:"mdi:calendar-check",class:"text-blue-500 text-lg"}),e("div",null,[t[20]||(t[20]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"分配时间",-1)),e("p",Za,d(S.value.assignedAt||"-"),1)])]),e("div",Ba,[s(a(n),{icon:"mdi:calendar-heart",class:"text-green-500 text-lg"}),e("div",null,[t[21]||(t[21]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"接单时间",-1)),e("p",Ga,d(S.value.acceptedAt||"-"),1)])])])])])]),_:1}),s(a(Ae),{name:"map",tab:"地图视图"},{default:g(()=>[e("div",Wa,[e("div",Ua,[t[29]||(t[29]=e("div",{class:"flex items-center gap-4"},[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-3 h-3 bg-blue-500 rounded-full"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"骑手位置")]),e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-3 h-3 bg-red-500 rounded-full"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"配送地址")]),e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-3 h-3 bg-green-500 rounded-full"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"商家地址")])],-1)),e("div",Ha,[s(a(C),{size:"small",type:"primary",onClick:ce,loading:E.value},{icon:g(()=>[s(a(n),{icon:"mdi:refresh"})]),default:g(()=>[t[22]||(t[22]=_(" 刷新位置 "))]),_:1,__:[22]},8,["loading"]),I.value&&f.value&&I.value.order?.merchantName?(k(),Q(a(C),{key:0,size:"small",type:"success",onClick:t[1]||(t[1]=i=>Ye(I.value))},{icon:g(()=>[s(a(n),{icon:"mdi:store"})]),default:g(()=>[t[23]||(t[23]=_(" 导航到商家 "))]),_:1,__:[23]})):z("",!0),I.value&&f.value&&I.value.order?.deliveryAddress?(k(),Q(a(C),{key:1,size:"small",type:"error",onClick:t[2]||(t[2]=i=>Je(I.value))},{icon:g(()=>[s(a(n),{icon:"mdi:home"})]),default:g(()=>[t[24]||(t[24]=_(" 导航到配送地址 "))]),_:1,__:[24]})):z("",!0),G.value?(k(),Q(a(C),{key:2,size:"small",type:"warning",onClick:Ke},{icon:g(()=>[s(a(n),{icon:"mdi:close"})]),default:g(()=>[t[25]||(t[25]=_(" 清除导航 "))]),_:1,__:[25]})):z("",!0),y.value?z("",!0):(k(),Q(a(C),{key:3,size:"small",type:"info",onClick:Xe},{icon:g(()=>[s(a(n),{icon:"mdi:crosshairs-gps"})]),default:g(()=>[t[26]||(t[26]=_(" 开始定位 "))]),_:1,__:[26]})),y.value?(k(),Q(a(C),{key:4,size:"small",type:"error",onClick:we},{icon:g(()=>[s(a(n),{icon:"mdi:stop"})]),default:g(()=>[t[27]||(t[27]=_(" 停止定位 "))]),_:1,__:[27]})):z("",!0),te.value?(k(),Q(a(C),{key:5,size:"small",type:"error",onClick:ve},{icon:g(()=>[s(a(n),{icon:"mdi:navigation-off"})]),default:g(()=>[t[28]||(t[28]=_(" 停止导航 "))]),_:1,__:[28]})):z("",!0)])]),e("div",Fa,[s(kt,{ref_key:"amapMapRef",ref:o,height:400,"show-controls":!0,"enable-location":!0,"show-rider-location":!0,"show-order-locations":!0,"enable-navigation":G.value,"navigation-start":$.value,"navigation-end":D.value,"rider-location":f.value?{longitude:f.value.longitude,latitude:f.value.latitude,accuracy:f.value.accuracy,direction:f.value.direction}:void 0,"order-locations":B.value,onMapClick:Ue,onRiderLocationUpdate:He,onOrderClick:Fe,onRoutePlanned:Ve},null,8,["enable-navigation","navigation-start","navigation-end","rider-location","order-locations"])]),f.value?(k(),L("div",Ya,[e("div",Ja,[e("h4",Va,[s(a(n),{icon:"mdi:crosshairs-gps"}),t[30]||(t[30]=_(" 骑手位置 "))]),e("div",Ka,[e("p",Xa," 经度: "+d(f.value.longitude.toFixed(6)),1),e("p",Qa," 纬度: "+d(f.value.latitude.toFixed(6)),1),e("p",qa," 更新时间: "+d(new Date(f.value.locationTime).toLocaleString()),1),f.value.accuracy?(k(),L("p",eo," 精度: "+d(f.value.accuracy)+"米 ",1)):z("",!0)])]),e("div",to,[e("h4",ao,[s(a(n),{icon:"mdi:map-marker"}),t[31]||(t[31]=_(" 订单位置 "))]),e("div",oo,[e("p",ro," 地址: "+d(S.value.order?.deliveryAddress||"-"),1),e("p",so," 商家: "+d(S.value.order?.merchantName||"-"),1),e("p",lo," 订单号: "+d(S.value.order?.orderId||"-"),1)])])])):z("",!0)])]),_:1})]),_:1})])):!Z.value&&I.value?(k(),L("div",io,[s(a(gt),{"label-placement":"left",bordered:"",column:1},{default:g(()=>[s(a(re),{label:"订单号"},{default:g(()=>[_(d(I.value.order?.orderId||"-"),1)]),_:1}),s(a(re),{label:"配送地址"},{default:g(()=>[_(d(I.value.order?.deliveryAddress||"-"),1)]),_:1}),s(a(re),{label:"商家名称"},{default:g(()=>[_(d(I.value.order?.merchantName||"-"),1)]),_:1}),s(a(re),{label:"订单金额"},{default:g(()=>[_("￥"+d(I.value.order?.orderAmount||0),1)]),_:1}),s(a(re),{label:"创建时间"},{default:g(()=>[_(d(I.value.order?.createAt||"-"),1)]),_:1}),s(a(re),{label:"订单状态"},{default:g(()=>[s(a(me),{type:K[I.value.acceptedStatus||0]?.type||"default",size:"small"},{default:g(()=>[_(d(K[I.value.acceptedStatus||0]?.text||"未知"),1)]),_:1},8,["type"])]),_:1})]),_:1}),t[32]||(t[32]=e("div",{class:"mt-16px text-center text-gray-500"},[e("p",null,"详细分配信息加载中...")],-1))])):Z.value?(k(),L("div",no,t[33]||(t[33]=[e("p",{class:"text-gray-500"},"正在加载订单详情...",-1)]))):z("",!0)]),_:1},8,["show","loading"]),s(a(Se),{show:le.value,"onUpdate:show":t[4]||(t[4]=i=>le.value=i),"mask-closable":!1,"close-on-esc":!1,preset:"card",title:"导航指引",size:"large",class:"navigation-overview-modal"},{default:g(()=>[e("div",uo,[e("div",co,[e("div",go,[e("div",vo,[e("span",po,d(J.value)+"/"+d(W.value.length),1),t[34]||(t[34]=e("span",{class:"progress-text"},"导航进度",-1))]),e("div",mo,[te.value?(k(),Q(a(C),{key:0,type:"error",size:"small",onClick:ve},{icon:g(()=>[s(a(n),{icon:"mdi:navigation-off"})]),default:g(()=>[t[35]||(t[35]=_(" 停止导航 "))]),_:1,__:[35]})):z("",!0)])]),e("div",fo,[s(m,{percentage:Math.round(J.value/W.value.length*100),"show-indicator":!0,status:"success"},null,8,["percentage"])])]),P.value?(k(),L("div",yo,[e("div",ho,[s(a(n),{icon:"mdi:map-marker-path",class:"current-step-icon"}),t[36]||(t[36]=e("span",{class:"current-step-title"},"当前步骤",-1))]),e("div",xo,[e("div",wo,[e("span",_o,d(P.value.instruction),1)]),P.value.roadName?(k(),L("div",bo,[s(a(n),{icon:"mdi:road",class:"road-icon"}),e("span",null,d(P.value.roadName),1)])):z("",!0),P.value.turnType?(k(),L("div",ko,[s(a(n),{icon:ke(P.value.turnType),class:"turn-icon"},null,8,["icon"]),e("span",null,d(Ie(P.value.turnType)),1)])):z("",!0),e("div",Io,[s(a(n),{icon:"mdi:ruler",class:"distance-icon"}),e("span",null,d(Math.round(P.value.distance))+"米",1)])])])):z("",!0),e("div",Mo,[e("div",Ao,[s(a(n),{icon:"mdi:history",class:"history-icon"}),t[37]||(t[37]=e("span",{class:"history-title"},"导航步骤历史",-1))]),e("div",So,[(k(!0),L(lt,null,it(V.value,(i,h)=>(k(),L("div",{key:h,class:ze(["step-item",{current:h===V.value.length-1}])},[e("div",zo,d(h+1),1),e("div",No,[e("div",Co,d(i.instruction),1),i.roadName?(k(),L("div",Ro,[s(a(n),{icon:"mdi:road",class:"road-icon-small"}),_(" "+d(i.roadName),1)])):z("",!0),i.turnType?(k(),L("div",Lo,[s(a(n),{icon:ke(i.turnType),class:"turn-icon-small"},null,8,["icon"]),_(" "+d(Ie(i.turnType)),1)])):z("",!0),e("div",To,[s(a(n),{icon:"mdi:ruler",class:"distance-icon-small"}),_(" "+d(Math.round(i.distance))+"米 ",1)])]),e("div",Oo,[s(a(n),{icon:h===V.value.length-1?"mdi:play":"mdi:check",class:ze(["status-icon",{current:h===V.value.length-1}])},null,8,["icon","class"])])],2))),128))])])])]),_:1},8,["show"])])}}}),Go=$e(Do,[["__scopeId","data-v-7c43597b"]]);export{Go as default};
