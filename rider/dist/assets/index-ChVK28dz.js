import{Y as se,d as be,r as u,a9 as re,a0 as ze,aa as ot,ab as Le,a as M,o as $,b as n,I as O,e as l,g as a,B as I,w as r,f,t as v,a8 as ke,q as ge,a1 as U,F as Oe,y as Pe,ac as Ee,a4 as nt,m as rt,Z as it,c as Ae,M as J,p as le,a3 as Ie,ad as Me,Q as te,a5 as ce,h as he,ae as ut,a6 as ie,af as dt,ag as ct}from"./index-C9iIelhG.js";import{_ as vt}from"./Spin-BUlUfB7E.js";import{_ as Re}from"./Form-C6cUAX00.js";import{_ as ve}from"./Space-DQwm9Psp.js";import{N as Ce,a as Ne,b as L}from"./DescriptionsItem-Bi55qOPT.js";function gt(g){return se({url:"/api/Navigation/route",method:"post",data:g})}function pt(g){return se({url:"/api/Navigation/nearby",method:"get",params:g})}function mt(g){return se({url:`/api/RiderLocations/${g}/latest`,method:"get"})}function ft(g){return se({url:"/api/RiderLocations/area",method:"get",params:g})}function Te(g){return se({url:"/api/RiderLocations/online",method:"get",params:g})}function yt(g){return se({url:`/api/RiderLocations/${g}/address`,method:"get"})}function wt(g,N){return se({url:`/api/RiderLocations/${g}/status`,method:"patch",data:N})}function xt(g,N="è®¢å•æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"){let _=N,p="";if(g?.response?.data){const b=g.response.data;p=String(b.code||""),_=b.msg||_}const R={ORDER_001:"è®¢å•ä¸å­˜åœ¨",ORDER_002:"è®¢å•çŠ¶æ€ä¸å…è®¸æ­¤æ“ä½œ",ORDER_003:"è®¢å•å·²è¢«å…¶ä»–éª‘æ‰‹æ¥å•",ORDER_004:"è®¢å•å·²è¶…æ—¶",ORDER_005:"è®¢å•é‡‘é¢å¼‚å¸¸",ORDER_006:"è®¢å•åœ°å€ä¿¡æ¯ä¸å®Œæ•´"};return p&&R[p]&&(_=R[p]),window.$message?.error(_),{errorCode:p,message:_,originalError:g}}function ht(g,N="æ“ä½œ"){let _=`${N}å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•`,p="";if(g?.response?.data){const R=g.response.data;p=String(R.code||""),_=R.msg||_}return g?.code==="NETWORK_ERROR"?_="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®":g?.code==="TIMEOUT"&&(_="è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•"),window.$message?.error(_),{errorCode:p,message:_,originalError:g}}const _e={apiKey:"2bc67deced375a36fb9db0937fb48d56",version:"2.0",plugins:["AMap.Scale","AMap.ToolBar","AMap.Driving","AMap.Geolocation","AMap.Marker","AMap.InfoWindow","AMap.AutoComplete"]},_t={instance:null,loading:!1,callbacks:[],async load(){return this.instance?this.instance:this.loading?new Promise(g=>{this.callbacks.push(g)}):(this.loading=!0,new Promise((g,N)=>{if(window.AMap){this.instance=window.AMap,this.loading=!1,g(this.instance);return}const _=document.createElement("script");_.type="text/javascript",_.async=!0,_.src=`https://webapi.amap.com/maps?v=${_e.version}&key=${_e.apiKey}&plugin=${_e.plugins.join(",")}`,_.onload=()=>{this.instance=window.AMap,this.loading=!1,g(this.instance),this.callbacks.forEach(p=>p(this.instance)),this.callbacks=[]},_.onerror=p=>{this.loading=!1,console.error("é«˜å¾·åœ°å›¾åŠ è½½å¤±è´¥:",p),N(new Error("Failed to load AMap: ç½‘ç»œè¿æ¥å¤±è´¥æˆ–APIå¯†é’¥æ— æ•ˆ"))},document.head.appendChild(_)}))}},bt={class:"amap-container"},kt={key:0,class:"map-loading"},St={class:"map-controls"},$t=be({__name:"amap-map",props:{center:{default:()=>{const g=localStorage.getItem("lastKnownLocation");if(g)try{return JSON.parse(g)}catch{}return{longitude:104.195397,latitude:35.86166}}},zoom:{default:12},showRiders:{type:Boolean,default:!0},navigationRoute:{default:null},isNavigating:{type:Boolean,default:!1},currentOrder:{default:null}},emits:["map-ready","location-update","rider-click","navigation-start","navigation-end","navigation-update"],setup(g,{expose:N,emit:_}){const p=g,R=_,b=u(),i=u(null),d=u(!1),A=u(!1),w=u("loading"),c=u(!1),z=u(p.center),B=u([]),x=u([]),E=u(null),K=u(null),k=u(null),D=u(null),C=u(null),F=u([]),G=u(0),V=u(null),oe=u(!1),m=u(!1);re(()=>p.center,o=>{i.value&&o&&(i.value.setCenter([o.longitude,o.latitude]),z.value=o)},{immediate:!0});const W=()=>{const o=new window.AMap.Size(24,24),y=document.createElement("canvas");y.width=24,y.height=24;const h=y.getContext("2d",{willReadFrequently:!0});return h&&(h.beginPath(),h.arc(12,12,10,0,2*Math.PI),h.fillStyle="#4285f4",h.fill(),h.beginPath(),h.arc(12,12,6,0,2*Math.PI),h.fillStyle="#ffffff",h.fill(),h.beginPath(),h.arc(12,12,2,0,2*Math.PI),h.fillStyle="#4285f4",h.fill()),new window.AMap.Icon({size:o,image:y.toDataURL(),imageSize:o})},q=async()=>{if(!(!i.value||!E.value||c.value)){m.value&&(x.value.forEach(o=>o.remove()),x.value=[],m.value=!1);try{const{data:o}=await Te({pageIndex:1,pageSize:100});if(c.value)return;if(o&&Array.isArray(o))B.value=o,console.log("è·å–åˆ°éª‘æ‰‹æ•°æ®:",o.length,"ä¸ª");else{B.value=[],console.log("æœªè·å–åˆ°éª‘æ‰‹æ•°æ®");return}}catch(o){console.error("è·å–éª‘æ‰‹ä½ç½®å¤±è´¥:",o),c.value||(B.value=[]);return}B.value.forEach(o=>{if(c.value)return;const y=W(),h=new window.AMap.Marker({position:[o.longitude,o.latitude],title:`éª‘æ‰‹${o.riderId}`,icon:y,anchor:"center"});h.on("click",()=>{c.value||(E.value.setContent(`
        <div style="padding: 10px;">
          <h4 style="margin: 0 0 8px 0; color: #333;">éª‘æ‰‹${o.riderId}</h4>
          <p style="margin: 4px 0; color: #666;">çŠ¶æ€: ${o.status===1?"åœ¨çº¿":"ç¦»çº¿"}</p>
          <p style="margin: 4px 0; color: #666;">ç»åº¦: ${o.longitude.toFixed(6)}</p>
          <p style="margin: 4px 0; color: #666;">çº¬åº¦: ${o.latitude.toFixed(6)}</p>
          <p style="margin: 4px 0; color: #666;">æ›´æ–°æ—¶é—´: ${new Date(o.locationTime).toLocaleString()}</p>
        </div>
      `),E.value.open(i.value,h.getPosition()),R("rider-click",o))}),h.setMap(i.value),x.value.push(h)}),m.value=!0}},j=async()=>{if(!b.value||c.value){console.warn("åœ°å›¾å®¹å™¨æœªå‡†å¤‡å¥½æˆ–ç»„ä»¶å·²é”€æ¯");return}try{c.value||(w.value="loading"),console.log("å¼€å§‹åŠ è½½é«˜å¾·åœ°å›¾...",{container:b.value,containerSize:{width:b.value.offsetWidth,height:b.value.offsetHeight}});const o=await _t.load();if(c.value)return;if(console.log("é«˜å¾·åœ°å›¾åŠ è½½æˆåŠŸ"),b.value.offsetWidth===0||b.value.offsetHeight===0){console.warn("åœ°å›¾å®¹å™¨å°ºå¯¸ä¸º0ï¼Œç­‰å¾…å®¹å™¨æ¸²æŸ“..."),setTimeout(()=>j(),200);return}i.value=new o.Map(b.value,{zoom:p.zoom,center:[z.value.longitude,z.value.latitude],mapStyle:"amap://styles/normal",features:["bg","road","building"],viewMode:"2D"}),i.value.addControl(new o.Scale),i.value.addControl(new o.ToolBar);const y=new o.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB",buttonOffset:new o.Pixel(10,20),zoomToAccuracy:!0,showMarker:!1,showButton:!0,markerOptions:{icon:new o.Icon({size:new o.Size(0,0),image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="})}});if(i.value.addControl(y),K.value=y,y.on("complete",h=>{if(c.value)return;const ee={longitude:h.position.lng,latitude:h.position.lat};z.value=ee;try{localStorage.setItem("lastKnownLocation",JSON.stringify(ee))}catch(ne){console.warn("ä¿å­˜ä½ç½®ä¿¡æ¯å¤±è´¥:",ne)}R("location-update",ee),i.value&&!c.value&&i.value.setCenter([h.position.lng,h.position.lat]),window.$message?.success("å®šä½æˆåŠŸï¼"),console.log("åœ°å›¾å®šä½æˆåŠŸï¼Œæ–°ä½ç½®:",ee)}),y.on("error",h=>{c.value||(console.error("å®šä½å¤±è´¥:",h),window.$message?.error("å®šä½å¤±è´¥ï¼Œè¯·æ£€æŸ¥å®šä½æƒé™"))}),E.value=new o.InfoWindow({offset:new o.Pixel(0,-30)}),c.value||(w.value="ready",R("map-ready",i.value)),p.showRiders&&await q(),K.value)try{setTimeout(()=>{K.value.getCurrentPosition()},500)}catch(h){console.log("åˆå§‹å®šä½å¤±è´¥ï¼Œä½¿ç”¨ä¼ å…¥çš„ä½ç½®:",h)}}catch(o){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",o),c.value||(w.value="error"),b.value&&(b.value.innerHTML=`
        <div style="
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100%;
          background: #f5f5f5;
          border-radius: 12px;
          color: #666;
          text-align: center;
          padding: 20px;
        ">
          <div style="font-size: 48px; margin-bottom: 16px;">ğŸ—ºï¸</div>
          <h3 style="margin: 0 0 8px 0; color: #333;">åœ°å›¾åŠ è½½å¤±è´¥</h3>
          <p style="margin: 0 0 16px 0; font-size: 14px;">ç½‘ç»œè¿æ¥é—®é¢˜æˆ–APIå¯†é’¥æ— æ•ˆ</p>
          <button onclick="window.location.reload()" style="
            background: #4285f4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
          ">é‡æ–°åŠ è½½</button>
        </div>
      `)}},ae=o=>{if(!(!i.value||!o.polyline)){H();try{console.log("å¼€å§‹ç»˜åˆ¶å¯¼èˆªè·¯çº¿...");const y=o.polyline.split(";").map(h=>{const[ee,ne]=h.split(",").map(Number);return[ee,ne]});k.value=new AMap.Polyline({path:y,borderWeight:3,strokeColor:"#3366FF",strokeOpacity:.8,strokeWeight:6,strokeStyle:"solid",lineJoin:"round",lineCap:"round",zIndex:5}),i.value.add(k.value),y.length>0&&(D.value=new AMap.Marker({position:y[0],icon:new AMap.Icon({size:new AMap.Size(32,32),image:"data:image/svg+xml;base64,"+btoa(`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#4CAF50">
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
          `),imageSize:new AMap.Size(32,32)}),title:"èµ·ç‚¹"}),C.value=new AMap.Marker({position:y[y.length-1],icon:new AMap.Icon({size:new AMap.Size(32,32),image:"data:image/svg+xml;base64,"+btoa(`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#F44336">
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
          `),imageSize:new AMap.Size(32,32)}),title:"ç»ˆç‚¹"}),i.value.add(D.value),i.value.add(C.value)),i.value.setFitView([k.value],!1,[50,50,50,50]),console.log("å¯¼èˆªè·¯çº¿ç»˜åˆ¶æˆåŠŸ")}catch(y){console.error("å¯¼èˆªè·¯çº¿ç»˜åˆ¶å¤±è´¥:",y)}}},H=()=>{k.value&&(i.value?.remove(k.value),k.value=null),D.value&&(i.value?.remove(D.value),D.value=null),C.value&&(i.value?.remove(C.value),C.value=null),F.value.forEach(o=>o.remove()),F.value=[]},T=()=>{!p.navigationRoute||!i.value||(oe.value=!0,G.value=0,ae(p.navigationRoute),Q(),R("navigation-start"),console.log("å¯¼èˆªå·²å¼€å§‹"))},P=()=>{oe.value=!1,G.value=0,H(),V.value&&(clearInterval(V.value),V.value=null),R("navigation-end"),console.log("å¯¼èˆªå·²ç»“æŸ")},Q=()=>{V.value&&clearInterval(V.value),V.value=setInterval(()=>{oe.value&&p.currentOrder&&Z()},5e3)},Z=async()=>{if(!(!p.currentOrder||!oe.value))try{const o={routeId:p.navigationRoute?.routeId||"",currentLongitude:z.value.longitude,currentLatitude:z.value.latitude,currentSpeed:30,remainingTime:1200,remainingDistance:5e3,nextInstruction:"å‰æ–¹200ç±³å³è½¬",timestamp:new Date().toISOString()};R("navigation-update",o)}catch(o){console.error("æ›´æ–°å¯¼èˆªçŠ¶æ€å¤±è´¥:",o)}},pe=async()=>{if(!c.value){d.value=!0;try{console.log("å¼€å§‹åˆ·æ–°åœ°å›¾..."),x.value.forEach(o=>o.remove()),x.value=[],H(),i.value&&(i.value.destroy(),i.value=null),w.value="loading",setTimeout(async()=>{await j(),window.$message?.success("åœ°å›¾åˆ·æ–°æˆåŠŸ")},100)}catch(o){console.error("åˆ·æ–°åœ°å›¾å¤±è´¥:",o),window.$message?.error("åœ°å›¾åˆ·æ–°å¤±è´¥")}finally{d.value=!1}}},X=async()=>{if(!i.value||!K.value){window.$message?.warning("åœ°å›¾æœªåˆå§‹åŒ–å®Œæˆï¼Œè¯·ç¨åå†è¯•");return}A.value=!0;try{K.value.getCurrentPosition()}catch(o){console.error("å®šä½å¤±è´¥:",o),window.$message?.error("å®šä½å¤±è´¥ï¼Œè¯·æ£€æŸ¥å®šä½æƒé™")}finally{A.value=!1}},ue=async()=>{d.value=!0;try{if(m.value?await q():await q(),B.value.length>0){if(window.$message?.success(`æˆåŠŸæ˜¾ç¤º ${B.value.length} ä¸ªéª‘æ‰‹ä½ç½®`),B.value.length>1){const o=new window.AMap.Bounds;B.value.forEach(y=>{o.extend([y.longitude,y.latitude])}),i.value.setBounds(o,{padding:[50,50,50,50]})}}else window.$message?.warning("å½“å‰åŒºåŸŸæš‚æ— åœ¨çº¿éª‘æ‰‹")}catch(o){console.error("æ˜¾ç¤ºéª‘æ‰‹å¤±è´¥:",o),window.$message?.error("æ˜¾ç¤ºéª‘æ‰‹å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{d.value=!1}},me=()=>{x.value.length>0?(x.value.forEach(o=>o.remove()),x.value=[],m.value=!1,B.value=[],window.$message?.success("å·²æ¸…é™¤éª‘æ‰‹æ ‡è®°")):window.$message?.info("å½“å‰æ²¡æœ‰æ˜¾ç¤ºéª‘æ‰‹æ ‡è®°")};return re(()=>p.center,o=>{o&&i.value&&!c.value&&(console.log("ä¸­å¿ƒç‚¹å˜åŒ–ï¼Œæ›´æ–°åœ°å›¾:",o),i.value.setCenter([o.longitude,o.latitude]),z.value=o)},{deep:!0}),re(()=>p.navigationRoute,o=>{o&&i.value&&!c.value?(console.log("å¯¼èˆªè·¯çº¿å˜åŒ–ï¼Œç»˜åˆ¶è·¯çº¿:",o),ae(o)):!o&&i.value&&(console.log("æ¸…é™¤å¯¼èˆªè·¯çº¿"),H())},{deep:!0}),re(()=>p.isNavigating,o=>{o&&i.value&&p.navigationRoute?(console.log("è¿›å…¥å¯¼èˆªæ¨¡å¼"),T()):o||(console.log("é€€å‡ºå¯¼èˆªæ¨¡å¼"),P())}),ze(async()=>{await ot(),setTimeout(()=>{j()},100)}),Le(()=>{c.value=!0,P(),i.value&&i.value.destroy(),x.value.forEach(o=>o.remove())}),N({clearRiderMarkers:me,addRiderMarkers:q,refreshLocation:X}),(o,y)=>($(),M("div",bt,[n("div",{ref_key:"mapContainer",ref:b,class:"map-container"},[w.value==="loading"?($(),M("div",kt,y[0]||(y[0]=[n("div",{class:"loading-spinner"},null,-1),n("p",null,"åœ°å›¾åŠ è½½ä¸­...",-1)]))):O("",!0)],512),n("div",St,[l(a(I),{type:"primary",size:"small",onClick:pe,loading:d.value},{icon:r(()=>y[1]||(y[1]=[n("span",{class:"text-lg"},"ğŸ”„",-1)])),default:r(()=>[y[2]||(y[2]=f(" åˆ·æ–°åœ°å›¾ "))]),_:1,__:[2]},8,["loading"]),l(a(I),{type:"info",size:"small",onClick:X,loading:A.value},{icon:r(()=>y[3]||(y[3]=[n("span",{class:"text-lg"},"ğŸ“",-1)])),default:r(()=>[y[4]||(y[4]=f(" å®šä½æˆ‘ "))]),_:1,__:[4]},8,["loading"]),l(a(I),{type:"success",size:"small",onClick:ue,loading:d.value},{default:r(()=>[f(" æ˜¾ç¤ºéª‘æ‰‹ ("+v(B.value.length)+") ",1)]),_:1},8,["loading"])])]))}}),At=ke($t,[["__scopeId","data-v-0bcb8f54"]]);async function It(g){return new Promise((N,_)=>{const p="https://restapi.amap.com/v3/assistant/inputtips",R=new URLSearchParams({key:"2bc67deced375a36fb9db0937fb48d56",keywords:g.keywords,city:g.city||"",citylimit:g.citylimit?"true":"false",datatype:"all",output:"json"}),b=`${p}?${R.toString()}`,i=`amap_callback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=document.createElement("script");d.src=`${b}&callback=${i}`,d.async=!0,window[i]=A=>{try{if(A&&A.status==="1"&&A.tips){const w=A.tips.map(c=>({id:c.id||`${c.name}_${c.district}`,name:c.name||"",district:c.district||"",adcode:c.adcode||"",location:c.location||"",address:c.address||"",typecode:c.typecode||""}));N({data:{tips:w}})}else N({data:{tips:[]}})}catch(w){_(w)}finally{document.head.removeChild(d),window[i]=void 0}},d.onerror=()=>{document.head.removeChild(d),window[i]=void 0,_(new Error("ç½‘ç»œè¯·æ±‚å¤±è´¥"))},document.head.appendChild(d),setTimeout(()=>{document.head.contains(d)&&(document.head.removeChild(d),window[i]=void 0,N({data:{tips:[]}}))},5e3)})}const Mt={class:"address-search"},Rt={class:"search-input-container"},Ct={key:0,class:"suggestions-dropdown"},Nt=["onClick","onMouseenter"],Dt={class:"suggestion-main"},zt={class:"suggestion-name"},Lt={class:"suggestion-address"},Ot={class:"suggestion-district"},Pt={key:1,class:"no-results"},Et={key:2,class:"loading-container"},Tt=be({__name:"AddressSearch",props:{placeholder:{default:"è¯·è¾“å…¥åœ°å€"},city:{default:""},location:{default:""},modelValue:{default:""}},emits:["update:modelValue","select"],setup(g,{expose:N,emit:_}){const p=g,R=_,b=u(p.modelValue),i=u([]),d=u(!1),A=u(-1),w=u(!1),c=u(null),z=async()=>{const k=b.value.trim();if(!k){i.value=[],d.value=!1;return}try{w.value=!0;const{data:D}=await It({keywords:k,city:p.city,location:p.location,citylimit:!!p.city});D&&D.tips?(i.value=D.tips,d.value=!0,A.value=-1):(i.value=[],d.value=!0)}catch{i.value=[],d.value=!0}finally{w.value=!1}};re(b,k=>{R("update:modelValue",k),c.value&&clearTimeout(c.value),k.trim()?c.value=setTimeout(()=>{z()},300):(i.value=[],d.value=!1)}),re(()=>p.modelValue,k=>{b.value=k});const B=()=>{i.value.length>0&&(d.value=!0)},x=()=>{setTimeout(()=>{d.value=!1},200)},E=k=>{b.value=k.name,i.value=[],d.value=!1,A.value=-1,R("select",k)},K=k=>{if(!(!d.value||i.value.length===0))switch(k.key){case"ArrowDown":k.preventDefault(),A.value=Math.min(A.value+1,i.value.length-1);break;case"ArrowUp":k.preventDefault(),A.value=Math.max(A.value-1,-1);break;case"Enter":k.preventDefault(),A.value>=0&&A.value<i.value.length&&E(i.value[A.value]);break;case"Escape":d.value=!1,A.value=-1;break}};return N({focus:()=>{},clear:()=>{b.value="",i.value=[],d.value=!1}}),(k,D)=>($(),M("div",Mt,[n("div",Rt,[l(a(ge),{value:b.value,"onUpdate:value":D[0]||(D[0]=C=>b.value=C),placeholder:k.placeholder,size:"large",clearable:"",onInput:z,onFocus:B,onBlur:x,onKeydown:K},{prefix:r(()=>[l(a(U),{icon:"ion:search"})]),_:1},8,["value","placeholder"]),d.value&&i.value.length>0?($(),M("div",Ct,[($(!0),M(Oe,null,Pe(i.value,(C,F)=>($(),M("div",{key:C.id,class:Ee(["suggestion-item",{"is-active":A.value===F}]),onClick:G=>E(C),onMouseenter:G=>A.value=F},[n("div",Dt,[n("div",zt,v(C.name),1),n("div",Lt,v(C.address),1)]),n("div",Ot,v(C.district),1)],42,Nt))),128))])):O("",!0),d.value&&i.value.length===0&&b.value&&!w.value?($(),M("div",Pt,[l(a(nt),{description:"æœªæ‰¾åˆ°ç›¸å…³åœ°å€"})])):O("",!0),w.value?($(),M("div",Et,[l(a(vt),{size:"small"}),D[1]||(D[1]=n("span",{class:"ml-8px"},"æœç´¢ä¸­...",-1))])):O("",!0)])]))}}),De=ke(Tt,[["__scopeId","data-v-320dfc5a"]]),Ut={class:"min-h-full p-24px bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800"},Bt={class:"flex items-center gap-3"},Ft={class:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center"},Vt={class:"mb-16px flex items-center justify-between"},Kt={class:"mt-16px grid grid-cols-4 gap-16px"},Gt={class:"text-2xl font-bold text-blue-600"},Yt={class:"text-2xl font-bold text-green-600"},jt={class:"text-2xl font-bold text-purple-600"},Jt={key:0,class:"text-xs text-gray-400 mt-1"},Wt={class:"text-sm text-gray-500"},qt={class:"mt-16px"},Ht={class:"flex items-center gap-2"},Qt={class:"text-sm font-medium"},Zt={key:0},Xt={key:1},ea={key:2,class:"text-center py-32px"},ta={class:"space-y-16px"},aa={key:0,class:"bg-gray-50 p-12px rounded-lg"},la={key:0,class:"text-sm text-gray-600 mb-4px"},sa={class:"text-xs text-gray-500 ml-8px"},oa={key:1,class:"text-sm text-gray-600"},na={class:"text-xs text-gray-500 ml-8px"},ra={class:"flex justify-end space-x-8px"},ia={key:0},ua={key:1,class:"text-center py-32px text-gray-500"},da={key:0,class:"space-y-16px"},ca={class:"bg-blue-50 p-16px rounded-lg"},va={class:"grid grid-cols-2 gap-16px"},ga={class:"text-center"},pa={class:"text-2xl font-bold text-blue-600"},ma={class:"text-center"},fa={class:"text-2xl font-bold text-green-600"},ya={key:0},wa={class:"max-h-200px overflow-y-auto space-y-8px"},xa={class:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold mr-12px"},ha={class:"flex-1"},_a={class:"text-sm font-medium"},ba={class:"text-xs text-gray-500"},ka={key:0,class:"text-center text-gray-500 text-sm"},Sa={class:"flex justify-end space-x-8px"},$a={key:0,class:"space-y-16px"},Aa={class:"bg-blue-50 p-16px rounded-lg text-center"},Ia={class:"text-xl font-bold"},Ma={class:"grid grid-cols-2 gap-16px"},Ra={class:"text-center"},Ca={class:"text-2xl font-bold text-red-600"},Na={class:"text-center"},Da={class:"text-2xl font-bold text-orange-600"},za={class:"text-center"},La={class:"text-lg font-semibold"},Oa={class:"flex justify-center space-x-8px"},Pa=be({name:"delivery",__name:"index",setup(g){const N=rt(),_=it(),p=Ae(()=>_.riderId||N.userInfo.userId),R=u([]),b=u(!1),i=u({page:1,pageSize:10,itemCount:0}),d=u({orderId:"",status:void 0,startDate:null,endDate:null}),A=u(!1),w=u(null),c=u(null),z=u(!1),x=u((()=>{const s=localStorage.getItem("lastKnownLocation");if(s)try{return JSON.parse(s)}catch{}return{longitude:104.195397,latitude:35.86166}})()),E=u([]),K=u(null),k=u(null),D=u(""),C=u(!0),F=u(null),G=u(!1),V={0:{text:"æœªå¤„ç†",type:"warning"},1:{text:"å·²æ¥å•",type:"primary"},2:{text:"å·²æ‹’å•",type:"error"},3:{text:"å·²å®Œæˆ",type:"success"}},oe=[{label:"å…¨éƒ¨çŠ¶æ€",value:void 0},{label:"æœªå¤„ç†",value:0},{label:"å·²æ¥å•",value:1},{label:"å·²æ‹’å•",value:2},{label:"å·²å®Œæˆ",value:3}],m=u({nearbyServicePoints:[],currentRoute:null,isNavigating:!1,navigationUpdate:null,currentStepIndex:0,navigationSteps:[]}),W=u(!1),q=u(!1),j=u(!1),ae=u(!1),H=u({startAddress:"",endAddress:"",routeType:"driving"}),T=u(null),P=u(null),Q=u(""),Z=u(""),pe=[{label:"é©¾è½¦",value:"driving"},{label:"æ­¥è¡Œ",value:"walking"},{label:"éª‘è¡Œ",value:"cycling"},{label:"å…¬å…±äº¤é€š",value:"transit"}],X=async()=>{b.value=!0;try{const s={page:i.value.page,pageSize:i.value.pageSize,...d.value.status!==void 0&&{status:d.value.status},...d.value.startDate&&{startDate:d.value.startDate},...d.value.endDate&&{endDate:d.value.endDate}},{data:e}=await dt(p.value,s);if(console.log("data",e),Array.isArray(e)){let t=e;d.value.orderId&&(t=t.filter(S=>S.order?.orderId?.includes(d.value.orderId))),R.value=t,i.value.itemCount=t.length}else R.value=[],i.value.itemCount=0}catch(s){ht(s,"è·å–è®¢å•æ•°æ®")}finally{b.value=!1}},ue=async s=>{z.value=!0;try{w.value&&(c.value={...w.value,assignedAt:w.value.assignedAt||new Date().toISOString(),acceptedAt:w.value.acceptedAt||null,timeOut:30}),console.log("ä½¿ç”¨åŸºæœ¬ä¿¡æ¯ä½œä¸ºè®¢å•è¯¦æƒ…")}catch(e){console.error("è·å–è®¢å•è¯¦æƒ…å¤±è´¥:",e),window.$message?.warning("è®¢å•è¯¦æƒ…åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œæ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯")}finally{z.value=!1}},me=()=>new Promise((s,e)=>{if(!navigator.geolocation){e(new Error("æµè§ˆå™¨ä¸æ”¯æŒGPSå®šä½"));return}navigator.geolocation.getCurrentPosition(t=>{const S={longitude:t.coords.longitude,latitude:t.coords.latitude};console.log("GPSå®šä½æˆåŠŸ:",S),s(S)},t=>{console.error("GPSå®šä½å¤±è´¥:",t),e(t)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4})}),o=async()=>{try{try{const e=await me();x.value=e;try{localStorage.setItem("lastKnownLocation",JSON.stringify(e))}catch(t){console.warn("ä¿å­˜ä½ç½®ä¿¡æ¯å¤±è´¥:",t)}console.log("GPSä½ç½®è·å–æˆåŠŸ:",e);return}catch(e){console.warn("GPSå®šä½å¤±è´¥ï¼Œå°è¯•ä»æœåŠ¡å™¨è·å–ä½ç½®:",e)}const{data:s}=await mt(p.value);if(console.log("æœåŠ¡å™¨ä½ç½®æ•°æ®:",s),s&&s.longitude&&s.latitude){const e={longitude:s.longitude,latitude:s.latitude};x.value=e;try{localStorage.setItem("lastKnownLocation",JSON.stringify(e))}catch(t){console.warn("ä¿å­˜ä½ç½®ä¿¡æ¯å¤±è´¥:",t)}console.log("ä½¿ç”¨æœåŠ¡å™¨ä½ç½®:",e)}else console.log("æœåŠ¡å™¨ä½ç½®æ•°æ®ä¸å®Œæ•´ï¼Œä½¿ç”¨é»˜è®¤ä½ç½®")}catch(s){console.error("è·å–éª‘æ‰‹ä½ç½®å¤±è´¥:",s),window.$message?.warning("ä½ç½®è·å–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ä½ç½®")}},y=async()=>{try{window.$message?.loading("æ­£åœ¨è·å–é™„è¿‘éª‘æ‰‹...");const{data:s}=await ft({minLongitude:x.value.longitude-.1,maxLongitude:x.value.longitude+.1,minLatitude:x.value.latitude-.1,maxLatitude:x.value.latitude+.1,pageIndex:1,pageSize:100});if(s&&Array.isArray(s))E.value=s,window.$message?.success(`æ‰¾åˆ° ${s.length} ä¸ªé™„è¿‘éª‘æ‰‹`);else{const{data:e}=await Te({pageIndex:1,pageSize:100});if(e&&Array.isArray(e)){const S=e.filter(Y=>Math.sqrt((Y.longitude-x.value.longitude)**2+(Y.latitude-x.value.latitude)**2)<=.1);E.value=S,window.$message?.success(`æ‰¾åˆ° ${S.length} ä¸ªé™„è¿‘éª‘æ‰‹`)}else E.value=[],window.$message?.warning("æœªæ‰¾åˆ°é™„è¿‘éª‘æ‰‹")}}catch(s){console.error("è·å–åŒºåŸŸå†…éª‘æ‰‹å¤±è´¥:",s),E.value=[],window.$message?.error("è·å–é™„è¿‘éª‘æ‰‹å¤±è´¥")}},h=()=>{k.value?k.value.clearRiderMarkers():window.$message?.warning("åœ°å›¾ç»„ä»¶æœªå‡†å¤‡å¥½")},ee=async()=>{try{const{data:s}=await yt(p.value);D.value=s?.address||"åœ°å€è·å–å¤±è´¥"}catch(s){console.error("è·å–åœ°å€å¤±è´¥:",s),D.value="åœ°å€è·å–å¤±è´¥"}},ne=()=>{F.value&&clearInterval(F.value),F.value=setInterval(async()=>{if(C.value&&!G.value){G.value=!0;try{await o(),console.log("å®šæ—¶ä½ç½®æ›´æ–°å®Œæˆ")}catch(s){console.error("å®šæ—¶ä½ç½®æ›´æ–°å¤±è´¥:",s)}finally{G.value=!1}}},12e4),console.log("ä½ç½®æ›´æ–°å®šæ—¶å™¨å·²å¯åŠ¨ï¼ˆ2åˆ†é’Ÿé—´éš”ï¼‰")},Se=()=>{F.value&&(clearInterval(F.value),F.value=null,console.log("ä½ç½®æ›´æ–°å®šæ—¶å™¨å·²åœæ­¢"))},Ue=async s=>{try{await wt(p.value,{status:s?1:0,timestamp:new Date().toISOString()}),C.value=s,s?(ne(),window.$message?.success("å·²ä¸Šçº¿ï¼Œå¼€å§‹ä½ç½®æ›´æ–°")):(Se(),window.$message?.success("å·²ä¸‹çº¿ï¼Œåœæ­¢ä½ç½®æ›´æ–°"))}catch(e){console.error("æ›´æ–°çŠ¶æ€å¤±è´¥:",e),window.$message?.error("æ›´æ–°çŠ¶æ€å¤±è´¥")}},Be=()=>{i.value.page=1,X()},Fe=()=>{d.value={orderId:"",status:void 0,startDate:null,endDate:null},i.value.page=1,X()},Ve=s=>{K.value=s,console.log("åœ°å›¾åŠ è½½å®Œæˆ"),o()},Ke=s=>{x.value=s},Ge=s=>{console.log("ç‚¹å‡»éª‘æ‰‹:",s)},fe=async(s,e)=>{try{console.log("startloc",s),console.log("endloc",e);const t={startLongitude:s.longitude,startLatitude:s.latitude,endLongitude:e.longitude,endLatitude:e.latitude,mode:H.value.routeType};console.log("è¯·æ±‚æ•°æ®:",t);const S=await gt(t);console.log("å®Œæ•´å“åº”:",S),console.log("å“åº”æ•°æ®:",S.data),S.data?.data?(m.value.currentRoute=S.data.data,m.value.navigationSteps=S.data.data.steps||[],m.value.currentStepIndex=0,W.value=!1,j.value=!0,window.$message?.success("è·¯çº¿è§„åˆ’æˆåŠŸ")):(console.warn("å“åº”æ•°æ®ä¸ºç©º"),window.$message?.warning("è·¯çº¿è§„åˆ’è¿”å›ç©ºæ•°æ®"))}catch(t){console.error("è·¯çº¿è§„åˆ’å¤±è´¥:",t),console.error("é”™è¯¯è¯¦æƒ…:",{message:t.message,code:t.code,response:t.response?.data,status:t.response?.status,statusText:t.response?.statusText}),window.$message?.error(`è·¯çº¿è§„åˆ’å¤±è´¥: ${t.message||"æœªçŸ¥é”™è¯¯"}`)}},Ye=async()=>{try{const{data:s}=await pt({longitude:x.value.longitude,latitude:x.value.latitude,serviceType:"all",radius:2e3});s&&(m.value.nearbyServicePoints=s.data,q.value=!0,window.$message?.success(`æ‰¾åˆ° ${s.data.length} ä¸ªé™„è¿‘æœåŠ¡ç‚¹`))}catch(s){console.error("è·å–é™„è¿‘æœåŠ¡ç‚¹å¤±è´¥:",s),window.$message?.error(`è·å–é™„è¿‘æœåŠ¡ç‚¹å¤±è´¥: ${s.message||"æœªçŸ¥é”™è¯¯"}`)}},de=s=>s<1e3?`${s}ç±³`:`${(s/1e3).toFixed(1)}å…¬é‡Œ`,ye=s=>{const e=Math.floor(s/3600),t=Math.floor(s%3600/60);return e>0?`${e}å°æ—¶${t}åˆ†é’Ÿ`:`${t}åˆ†é’Ÿ`},je=async s=>{try{const[e,t]=s.location.split(",").map(Number);T.value={longitude:e,latitude:t},Q.value=s.name,window.$message?.success(`å·²é€‰æ‹©èµ·ç‚¹: ${s.name}`)}catch(e){console.error("å¤„ç†èµ·ç‚¹åœ°å€å¤±è´¥:",e),window.$message?.error("å¤„ç†èµ·ç‚¹åœ°å€å¤±è´¥")}},Je=async s=>{try{const[e,t]=s.location.split(",").map(Number);P.value={longitude:e,latitude:t},Z.value=s.name,window.$message?.success(`å·²é€‰æ‹©ç»ˆç‚¹: ${s.name}`)}catch(e){console.error("å¤„ç†ç»ˆç‚¹åœ°å€å¤±è´¥:",e),window.$message?.error("å¤„ç†ç»ˆç‚¹åœ°å€å¤±è´¥")}},We=async()=>{if(!T.value||!P.value){window.$message?.warning("è¯·é€‰æ‹©èµ·ç‚¹å’Œç»ˆç‚¹åœ°å€");return}try{await fe(T.value,P.value)}catch(s){console.error("è·¯çº¿è§„åˆ’å¤±è´¥:",s),window.$message?.error(`è·¯çº¿è§„åˆ’å¤±è´¥: ${s.message||"æœªçŸ¥é”™è¯¯"}`)}},qe=()=>{T.value=null,P.value=null,Q.value="",Z.value=""},$e=()=>{if(!m.value.currentRoute){window.$message?.warning("è¯·å…ˆè§„åˆ’è·¯çº¿");return}m.value.isNavigating=!0,j.value=!1,ae.value=!0,window.$message?.success("å¯¼èˆªå·²å¼€å§‹"),console.log("å¼€å§‹å¯¼èˆª:",m.value.currentRoute)},we=()=>{m.value.isNavigating=!1,m.value.currentRoute=null,m.value.navigationUpdate=null,m.value.currentStepIndex=0,m.value.navigationSteps=[],ae.value=!1,window.$message?.success("å¯¼èˆªå·²ç»“æŸ"),console.log("ç»“æŸå¯¼èˆª")},He=()=>{if(!T.value||!P.value){window.$message?.warning("è¯·é‡æ–°é€‰æ‹©èµ·ç‚¹å’Œç»ˆç‚¹"),W.value=!0;return}fe(T.value,P.value)},Qe=s=>{m.value.navigationUpdate=s,console.log("å¯¼èˆªæ›´æ–°:",s)},Ze=()=>{console.log("åœ°å›¾å¯¼èˆªå·²å¼€å§‹")},Xe=()=>{console.log("åœ°å›¾å¯¼èˆªå·²ç»“æŸ"),we()},et=async s=>{if(!s.order?.address){window.$message?.warning("è®¢å•åœ°å€ä¿¡æ¯ä¸å®Œæ•´");return}try{const e=x.value,t={longitude:116.397428+Math.random()*.01,latitude:39.90923+Math.random()*.01};T.value=e,P.value=t,Q.value="å½“å‰ä½ç½®",Z.value=s.order.address.detailedAddress,await fe(e,t),w.value=s,window.$message?.success("å·²ä¸ºè®¢å•è§„åˆ’å¯¼èˆªè·¯çº¿")}catch(e){console.error("è®¢å•å¯¼èˆªè§„åˆ’å¤±è´¥:",e),window.$message?.error("è®¢å•å¯¼èˆªè§„åˆ’å¤±è´¥")}},tt=s=>({gas_station:"åŠ æ²¹ç«™",restaurant:"é¤å…",hospital:"åŒ»é™¢",police:"è­¦å¯Ÿå±€",other:"å…¶ä»–"})[s]||"æœªçŸ¥";ze(async()=>{!N.userInfo.userId&&N.token&&await N.initUserInfo(),N.userInfo.userId||Object.assign(N.userInfo,{userId:`rider_${Date.now()}`,userName:"æµ‹è¯•éª‘æ‰‹",roles:["rider"],buttons:[]}),await X(),await o(),await ee(),C.value&&ne()});const at=s=>{i.value.page=s,X()};Le(()=>{Se(),K.value&&(K.value=null)});async function lt(s){try{w.value=s,A.value=!0,c.value=null,s.assignId&&await ue(s.assignId)}catch(e){console.error("æ‰“å¼€è®¢å•è¯¦æƒ…å¤±è´¥:",e),window.$message?.error("æ‰“å¼€è®¢å•è¯¦æƒ…å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}}async function xe(s,e){const t={1:"æ¥å•",2:"æ‹’å•",3:"å®Œæˆè®¢å•"}[e]||"æ›´æ–°çŠ¶æ€";try{window.$dialog?.warning({title:`ç¡®è®¤${t}`,content:`ç¡®å®šè¦${t}è®¢å• ${s.order?.orderId} å—ï¼Ÿ`,positiveText:"ç¡®å®š",negativeText:"å–æ¶ˆ",onPositiveClick:async()=>{try{const S=s.assignId||"";await ct(p.value,S,{acceptedStatus:e}),window.$message?.success(`${t}æˆåŠŸï¼`),await X(),A.value&&s.assignId&&await ue(s.assignId)}catch(S){xt(S,`${t}å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•`)}}})}catch(S){console.error("æ“ä½œå¤±è´¥",S)}}const st=Ae(()=>!R.value||!Array.isArray(R.value)?[]:R.value);return(s,e)=>($(),M("div",Ut,[l(a(J),{bordered:!1,class:"mb-24px bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm"},{default:r(()=>[n("div",Bt,[n("div",Ft,[l(a(U),{icon:"mdi:motorbike",class:"text-2xl text-white"})]),e[18]||(e[18]=n("div",null,[n("h1",{class:"text-2xl text-gray-800 font-bold dark:text-gray-200"},"é…é€è®¢å•ç®¡ç†"),n("p",{class:"mt-2px text-gray-600 dark:text-gray-400"},"æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„é…é€è®¢å•ï¼ŒåŠæ—¶å¤„ç†è®¢å•çŠ¶æ€")],-1))])]),_:1}),l(a(J),{bordered:!1,class:"mb-24px bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-16px shadow-lg"},{default:r(()=>[l(a(Re),{model:d.value,inline:""},{default:r(()=>[l(a(le),{label:"è®¢å•å·"},{default:r(()=>[l(a(ge),{value:d.value.orderId,"onUpdate:value":e[0]||(e[0]=t=>d.value.orderId=t),placeholder:"è¯·è¾“å…¥è®¢å•å·",style:{width:"200px"}},null,8,["value"])]),_:1}),l(a(le),{label:"çŠ¶æ€"},{default:r(()=>[l(a(Ie),{value:d.value.status,"onUpdate:value":e[1]||(e[1]=t=>d.value.status=t),options:oe,placeholder:"è¯·é€‰æ‹©çŠ¶æ€",style:{width:"150px"}},null,8,["value"])]),_:1}),l(a(le),{label:"åˆ›å»ºæ—¶é—´"},{default:r(()=>[l(a(ve),null,{default:r(()=>[l(a(ge),{value:d.value.startDate,"onUpdate:value":e[2]||(e[2]=t=>d.value.startDate=t),placeholder:"å¼€å§‹æ—¥æœŸ (YYYY-MM-DD)",style:{width:"150px"}},null,8,["value"]),e[19]||(e[19]=n("span",null,"è‡³",-1)),l(a(ge),{value:d.value.endDate,"onUpdate:value":e[3]||(e[3]=t=>d.value.endDate=t),placeholder:"ç»“æŸæ—¥æœŸ (YYYY-MM-DD)",style:{width:"150px"}},null,8,["value"])]),_:1,__:[19]})]),_:1}),l(a(le),null,{default:r(()=>[l(a(ve),null,{default:r(()=>[l(a(I),{type:"primary",onClick:Be},{default:r(()=>e[20]||(e[20]=[f("æœç´¢")])),_:1,__:[20]}),l(a(I),{onClick:Fe},{default:r(()=>e[21]||(e[21]=[f("é‡ç½®")])),_:1,__:[21]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(a(ut),{type:"line",animated:""},{default:r(()=>[l(a(Me),{name:"orders",tab:"è®¢å•åˆ—è¡¨"},{default:r(()=>[l(a(J),{bordered:!1,class:"rounded-16px shadow-lg bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm"},{default:r(()=>[l(a(Ce),{columns:[{title:"è®¢å•å·",key:"orderId",render:t=>t.order?.orderId||"-"},{title:"é…é€åœ°å€",key:"address",render:t=>t.order?.address?.detailedAddress||"-"},{title:"å•†å®¶åç§°",key:"merchant",render:t=>t.order?.address?.receiverName||"-"},{title:"çŠ¶æ€",key:"status",render(t){const S=t.acceptedStatus||0,Y=V[S]||{text:"æœªçŸ¥",type:"default"};return te(a(ce),{type:Y.type,size:"small"},{default:()=>Y.text})}},{title:"é‡‘é¢",key:"amount",render:t=>`ï¿¥${t.order?.orderAmount||0}`},{title:"åˆ›å»ºæ—¶é—´",key:"createAt",render:t=>t.order?.createAt||"-"},{title:"æ“ä½œ",key:"actions",render(t){const S=t.acceptedStatus||0,Y=[];return Y.push(te(a(I),{size:"small",type:"primary",onClick:()=>lt(t)},{default:()=>"è¯¦æƒ…"})),S===0?Y.push(te(a(I),{size:"small",type:"success",onClick:()=>xe(t,1)},{default:()=>"æ¥å•"}),te(a(I),{size:"small",type:"warning",onClick:()=>xe(t,2)},{default:()=>"æ‹’å•"})):S===1&&Y.push(te(a(I),{size:"small",type:"info",onClick:()=>et(t)},{default:()=>"å¯¼èˆª"}),te(a(I),{size:"small",type:"success",onClick:()=>xe(t,3)},{default:()=>"å®Œæˆ"})),te(a(ve),null,{default:()=>Y})}}],data:st.value,loading:b.value,pagination:i.value,"onUpdate:page":at},null,8,["columns","data","loading","pagination"])]),_:1})]),_:1}),l(a(Me),{name:"map",tab:"é…é€åœ°å›¾"},{default:r(()=>[l(a(J),{bordered:!1,class:"rounded-16px shadow-lg bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm"},{default:r(()=>[n("div",Vt,[e[30]||(e[30]=n("div",null,[n("h3",{class:"text-lg font-semibold mb-8px"},"å®æ—¶é…é€åœ°å›¾"),n("p",{class:"text-gray-600 text-sm"},"æŸ¥çœ‹éª‘æ‰‹ä½ç½®å’Œé…é€è·¯çº¿")],-1)),l(a(ve),null,{default:r(()=>[l(a(I),{type:"success",onClick:e[4]||(e[4]=t=>o()),loading:G.value},{default:r(()=>[l(a(U),{icon:"mdi:refresh",class:"mr-1"}),e[22]||(e[22]=f(" åˆ·æ–°ä½ç½® "))]),_:1,__:[22]},8,["loading"]),l(a(I),{type:C.value?"success":"warning",onClick:e[5]||(e[5]=t=>Ue(!C.value))},{default:r(()=>[l(a(U),{icon:C.value?"mdi:account-check":"mdi:account-off",class:"mr-1"},null,8,["icon"]),f(" "+v(C.value?"ä¸‹çº¿":"ä¸Šçº¿"),1)]),_:1},8,["type"]),l(a(I),{type:"primary",onClick:y},{default:r(()=>[l(a(U),{icon:"mdi:account-group",class:"mr-1"}),e[23]||(e[23]=f(" é™„è¿‘éª‘æ‰‹ "))]),_:1,__:[23]}),l(a(I),{type:"error",onClick:h},{default:r(()=>[l(a(U),{icon:"mdi:map-marker-off",class:"mr-1"}),e[24]||(e[24]=f(" æ¸…é™¤éª‘æ‰‹æ ‡è®° "))]),_:1,__:[24]}),l(a(I),{type:"info",onClick:e[6]||(e[6]=t=>Ye())},{default:r(()=>[l(a(U),{icon:"mdi:map-marker-multiple",class:"mr-1"}),e[25]||(e[25]=f(" é™„è¿‘æœåŠ¡ "))]),_:1,__:[25]}),l(a(I),{type:"warning",onClick:e[7]||(e[7]=t=>W.value=!0)},{default:r(()=>[l(a(U),{icon:"mdi:route",class:"mr-1"}),e[26]||(e[26]=f(" è·¯çº¿è§„åˆ’ "))]),_:1,__:[26]}),m.value.currentRoute&&!m.value.isNavigating?($(),he(a(I),{key:0,type:"success",onClick:$e},{default:r(()=>[l(a(U),{icon:"mdi:navigation",class:"mr-1"}),e[27]||(e[27]=f(" å¼€å§‹å¯¼èˆª "))]),_:1,__:[27]})):O("",!0),m.value.isNavigating?($(),he(a(I),{key:1,type:"error",onClick:we},{default:r(()=>[l(a(U),{icon:"mdi:stop",class:"mr-1"}),e[28]||(e[28]=f(" ç»“æŸå¯¼èˆª "))]),_:1,__:[28]})):O("",!0),m.value.currentRoute?($(),he(a(I),{key:2,type:"info",onClick:He},{default:r(()=>[l(a(U),{icon:"mdi:refresh",class:"mr-1"}),e[29]||(e[29]=f(" é‡æ–°è§„åˆ’ "))]),_:1,__:[29]})):O("",!0)]),_:1})]),l(At,{ref_key:"amapMapRef",ref:k,center:x.value,zoom:12,"show-riders":!0,"navigation-route":m.value.currentRoute,"is-navigating":m.value.isNavigating,"current-order":w.value,onMapReady:Ve,onLocationUpdate:Ke,onRiderClick:Ge,onNavigationStart:Ze,onNavigationEnd:Xe,onNavigationUpdate:Qe},null,8,["center","navigation-route","is-navigating","current-order"]),n("div",Kt,[l(a(J),{size:"small",class:"text-center"},{default:r(()=>[n("div",Gt,v(x.value.longitude.toFixed(6)),1),e[31]||(e[31]=n("div",{class:"text-sm text-gray-500"},"ç»åº¦",-1))]),_:1,__:[31]}),l(a(J),{size:"small",class:"text-center"},{default:r(()=>[n("div",Yt,v(x.value.latitude.toFixed(6)),1),e[32]||(e[32]=n("div",{class:"text-sm text-gray-500"},"çº¬åº¦",-1))]),_:1,__:[32]}),l(a(J),{size:"small",class:"text-center"},{default:r(()=>[n("div",jt,v(E.value.length),1),e[33]||(e[33]=n("div",{class:"text-sm text-gray-500"},"åŒºåŸŸå†…éª‘æ‰‹",-1)),E.value.length===0?($(),M("div",Jt,'ç‚¹å‡»"é™„è¿‘éª‘æ‰‹"è·å–')):O("",!0)]),_:1,__:[33]}),l(a(J),{size:"small",class:"text-center"},{default:r(()=>[n("div",{class:Ee(["text-lg font-bold",C.value?"text-green-600":"text-gray-500"])},v(C.value?"åœ¨çº¿":"ç¦»çº¿"),3),n("div",Wt,v(G.value?"æ›´æ–°ä¸­...":"çŠ¶æ€"),1)]),_:1})]),n("div",qt,[l(a(J),{size:"small"},{default:r(()=>[n("div",Ht,[l(a(U),{icon:"mdi:map-marker",class:"text-red-500"}),e[34]||(e[34]=n("span",{class:"text-sm text-gray-600"},"å½“å‰ä½ç½®ï¼š",-1)),n("span",Qt,v(D.value||"è·å–ä¸­..."),1)])]),_:1})])]),_:1})]),_:1})]),_:1}),l(a(ie),{show:A.value,"onUpdate:show":e[8]||(e[8]=t=>A.value=t),preset:"card",title:"è®¢å•è¯¦æƒ…",class:"w-[600px]",loading:z.value},{default:r(()=>[!z.value&&c.value?($(),M("div",Zt,[l(a(Ne),{"label-placement":"left",bordered:"",column:1},{default:r(()=>[l(a(L),{label:"è®¢å•å·"},{default:r(()=>[f(v(c.value.order?.orderId||"-"),1)]),_:1}),l(a(L),{label:"é…é€åœ°å€"},{default:r(()=>[f(v(c.value.order?.address?.detailedAddress||"-"),1)]),_:1}),l(a(L),{label:"æ”¶è´§äººå§“å"},{default:r(()=>[f(v(c.value.order?.address?.receiverName||"-"),1)]),_:1}),l(a(L),{label:"æ”¶è´§äººç”µè¯"},{default:r(()=>[f(v(c.value.order?.address?.receiverPhone||"-"),1)]),_:1}),l(a(L),{label:"åˆ†é…æ—¶é—´"},{default:r(()=>[f(v(c.value.assignedAt||"-"),1)]),_:1}),l(a(L),{label:"æ¥å•æ—¶é—´"},{default:r(()=>[f(v(c.value.acceptedAt||"-"),1)]),_:1}),l(a(L),{label:"è®¢å•é‡‘é¢"},{default:r(()=>[f("ï¿¥"+v(c.value.order?.orderAmount||0),1)]),_:1}),l(a(L),{label:"è®¢å•çŠ¶æ€"},{default:r(()=>[l(a(ce),{type:V[c.value.acceptedStatus||0]?.type||"default",size:"small"},{default:r(()=>[f(v(V[c.value.acceptedStatus||0]?.text||"æœªçŸ¥"),1)]),_:1},8,["type"])]),_:1}),l(a(L),{label:"åˆ›å»ºæ—¶é—´"},{default:r(()=>[f(v(c.value.order?.createAt||"-"),1)]),_:1}),l(a(L),{label:"è¶…æ—¶æ—¶é—´"},{default:r(()=>[f(v(c.value.timeOut||0)+" åˆ†é’Ÿ ",1)]),_:1})]),_:1})])):!z.value&&w.value?($(),M("div",Xt,[l(a(Ne),{"label-placement":"left",bordered:"",column:1},{default:r(()=>[l(a(L),{label:"è®¢å•å·"},{default:r(()=>[f(v(w.value.order?.orderId||"-"),1)]),_:1}),l(a(L),{label:"é…é€åœ°å€"},{default:r(()=>[f(v(w.value.order?.address?.detailedAddress||"-"),1)]),_:1}),l(a(L),{label:"æ”¶è´§äººå§“å"},{default:r(()=>[f(v(w.value.order?.address?.receiverName||"-"),1)]),_:1}),l(a(L),{label:"æ”¶è´§äººç”µè¯"},{default:r(()=>[f(v(w.value.order?.address?.receiverPhone||"-"),1)]),_:1}),l(a(L),{label:"è®¢å•é‡‘é¢"},{default:r(()=>[f("ï¿¥"+v(w.value.order?.orderAmount||0),1)]),_:1}),l(a(L),{label:"åˆ›å»ºæ—¶é—´"},{default:r(()=>[f(v(w.value.order?.createAt||"-"),1)]),_:1}),l(a(L),{label:"è®¢å•çŠ¶æ€"},{default:r(()=>[l(a(ce),{type:V[w.value.acceptedStatus||0]?.type||"default",size:"small"},{default:r(()=>[f(v(V[w.value.acceptedStatus||0]?.text||"æœªçŸ¥"),1)]),_:1},8,["type"])]),_:1})]),_:1}),e[35]||(e[35]=n("div",{class:"mt-16px text-center text-gray-500"},[n("p",null,"è¯¦ç»†åˆ†é…ä¿¡æ¯åŠ è½½ä¸­...")],-1))])):z.value?($(),M("div",ea,e[36]||(e[36]=[n("p",{class:"text-gray-500"},"æ­£åœ¨åŠ è½½è®¢å•è¯¦æƒ…...",-1)]))):O("",!0)]),_:1},8,["show","loading"]),l(a(ie),{show:W.value,"onUpdate:show":e[13]||(e[13]=t=>W.value=t),preset:"card",title:"è·¯çº¿è§„åˆ’",class:"w-[700px]"},{default:r(()=>[n("div",ta,[l(a(Re),{"label-placement":"left","label-width":80},{default:r(()=>[l(a(le),{label:"èµ·ç‚¹"},{default:r(()=>[l(De,{"model-value":Q.value,"onUpdate:modelValue":e[9]||(e[9]=t=>Q.value=t),placeholder:"è¯·è¾“å…¥èµ·ç‚¹åœ°å€",city:"åŒ—äº¬",location:`${x.value.longitude},${x.value.latitude}`,onSelect:je},null,8,["model-value","location"])]),_:1}),l(a(le),{label:"ç»ˆç‚¹"},{default:r(()=>[l(De,{"model-value":Z.value,"onUpdate:modelValue":e[10]||(e[10]=t=>Z.value=t),placeholder:"è¯·è¾“å…¥ç»ˆç‚¹åœ°å€",city:"åŒ—äº¬",location:`${x.value.longitude},${x.value.latitude}`,onSelect:Je},null,8,["model-value","location"])]),_:1}),l(a(le),{label:"è·¯çº¿ç±»å‹"},{default:r(()=>[l(a(Ie),{value:H.value.routeType,"onUpdate:value":e[11]||(e[11]=t=>H.value.routeType=t),options:pe},null,8,["value"])]),_:1})]),_:1}),T.value||P.value?($(),M("div",aa,[e[39]||(e[39]=n("h4",{class:"text-sm font-medium mb-8px text-gray-700"},"å·²é€‰æ‹©åœ°å€ï¼š",-1)),T.value?($(),M("div",la,[e[37]||(e[37]=n("span",{class:"font-medium"},"èµ·ç‚¹ï¼š",-1)),f(v(Q.value)+" ",1),n("span",sa," ("+v(T.value.longitude.toFixed(6))+", "+v(T.value.latitude.toFixed(6))+") ",1)])):O("",!0),P.value?($(),M("div",oa,[e[38]||(e[38]=n("span",{class:"font-medium"},"ç»ˆç‚¹ï¼š",-1)),f(v(Z.value)+" ",1),n("span",na," ("+v(P.value.longitude.toFixed(6))+", "+v(P.value.latitude.toFixed(6))+") ",1)])):O("",!0)])):O("",!0),n("div",ra,[l(a(I),{onClick:e[12]||(e[12]=t=>{W.value=!1,qe()})},{default:r(()=>e[40]||(e[40]=[f("å–æ¶ˆ")])),_:1,__:[40]}),l(a(I),{type:"primary",onClick:We,disabled:!T.value||!P.value},{default:r(()=>e[41]||(e[41]=[f(" è§„åˆ’è·¯çº¿ ")])),_:1,__:[41]},8,["disabled"])])])]),_:1},8,["show"]),l(a(ie),{show:q.value,"onUpdate:show":e[14]||(e[14]=t=>q.value=t),preset:"card",title:"é™„è¿‘æœåŠ¡ç‚¹",class:"w-[800px]"},{default:r(()=>[m.value.nearbyServicePoints.length>0?($(),M("div",ia,[l(a(Ce),{columns:[{title:"åç§°",key:"name",width:150},{title:"ç±»å‹",key:"type",width:100,render:t=>tt(t.type||"")},{title:"åœ°å€",key:"address",width:200},{title:"è·ç¦»",key:"distance",width:100,render:t=>de(t.distance||0)},{title:"çŠ¶æ€",key:"isOpen",width:80,render:t=>te(a(ce),{type:t.isOpen?"success":"error"},{default:()=>t.isOpen?"è¥ä¸š":"ä¼‘æ¯"})},{title:"è¯„åˆ†",key:"rating",width:80,render:t=>t.rating?`${t.rating}åˆ†`:"-"},{title:"ç”µè¯",key:"phone",width:120}],data:m.value.nearbyServicePoints,pagination:{pageSize:10}},null,8,["columns","data"])])):($(),M("div",ua," æš‚æ— é™„è¿‘æœåŠ¡ç‚¹ "))]),_:1},8,["show"]),l(a(ie),{show:j.value,"onUpdate:show":e[16]||(e[16]=t=>j.value=t),preset:"card",title:"å¯¼èˆªè·¯çº¿ç¡®è®¤",class:"w-[600px]"},{default:r(()=>[m.value.currentRoute?($(),M("div",da,[n("div",ca,[e[44]||(e[44]=n("h4",{class:"text-lg font-semibold mb-12px text-blue-800"},"è·¯çº¿ä¿¡æ¯",-1)),n("div",va,[n("div",ga,[n("div",pa,v(de(m.value.currentRoute.totalDistance)),1),e[42]||(e[42]=n("div",{class:"text-sm text-gray-600"},"æ€»è·ç¦»",-1))]),n("div",ma,[n("div",fa,v(ye(m.value.currentRoute.estimatedDuration)),1),e[43]||(e[43]=n("div",{class:"text-sm text-gray-600"},"é¢„è®¡æ—¶é—´",-1))])])]),m.value.navigationSteps.length>0?($(),M("div",ya,[e[45]||(e[45]=n("h4",{class:"text-lg font-semibold mb-12px"},"è·¯çº¿æ­¥éª¤",-1)),n("div",wa,[($(!0),M(Oe,null,Pe(m.value.navigationSteps.slice(0,5),(t,S)=>($(),M("div",{key:S,class:"flex items-center p-8px bg-gray-50 rounded-lg"},[n("div",xa,v(S+1),1),n("div",ha,[n("div",_a,v(t.instruction||"ç»§ç»­ç›´è¡Œ"),1),n("div",ba,v(de(t.distance||0))+" Â· "+v(ye(t.duration||0)),1)])]))),128)),m.value.navigationSteps.length>5?($(),M("div",ka," è¿˜æœ‰ "+v(m.value.navigationSteps.length-5)+" ä¸ªæ­¥éª¤... ",1)):O("",!0)])])):O("",!0),n("div",Sa,[l(a(I),{onClick:e[15]||(e[15]=t=>j.value=!1)},{default:r(()=>e[46]||(e[46]=[f("å–æ¶ˆ")])),_:1,__:[46]}),l(a(I),{type:"primary",onClick:$e},{default:r(()=>[l(a(U),{icon:"mdi:navigation",class:"mr-1"}),e[47]||(e[47]=f(" å¼€å§‹å¯¼èˆª "))]),_:1,__:[47]})])])):O("",!0)]),_:1},8,["show"]),l(a(ie),{show:ae.value,"onUpdate:show":e[17]||(e[17]=t=>ae.value=t),preset:"card",title:"å¯¼èˆªä¸­",class:"w-[400px]"},{default:r(()=>[m.value.navigationUpdate?($(),M("div",$a,[n("div",Aa,[e[48]||(e[48]=n("div",{class:"text-lg font-semibold text-blue-800 mb-8px"},"å½“å‰æŒ‡ä»¤",-1)),n("div",Ia,v(m.value.navigationUpdate.nextInstruction),1)]),n("div",Ma,[n("div",Ra,[n("div",Ca,v(de(m.value.navigationUpdate.remainingDistance)),1),e[49]||(e[49]=n("div",{class:"text-sm text-gray-600"},"å‰©ä½™è·ç¦»",-1))]),n("div",Na,[n("div",Da,v(ye(m.value.navigationUpdate.remainingTime)),1),e[50]||(e[50]=n("div",{class:"text-sm text-gray-600"},"é¢„è®¡æ—¶é—´",-1))])]),n("div",za,[n("div",La,"å½“å‰é€Ÿåº¦: "+v(m.value.navigationUpdate.currentSpeed)+" km/h",1)]),n("div",Oa,[l(a(I),{type:"error",onClick:we},{default:r(()=>[l(a(U),{icon:"mdi:stop",class:"mr-1"}),e[51]||(e[51]=f(" ç»“æŸå¯¼èˆª "))]),_:1,__:[51]})])])):O("",!0)]),_:1},8,["show"])]))}}),Ka=ke(Pa,[["__scopeId","data-v-c6465a34"]]);export{Ka as default};
