import{Y as se,d as be,r as u,a9 as re,a0 as ze,aa as ot,ab as Le,a as M,o as $,b as n,I as O,e as l,g as a,B as I,w as r,f,t as v,a8 as ke,q as ge,a1 as U,F as Oe,y as Pe,ac as Ee,a4 as nt,m as rt,Z as it,c as Ae,M as J,p as le,a3 as Ie,ad as Me,Q as te,a5 as ce,h as he,ae as ut,a6 as ie,af as dt,ag as ct}from"./index-C9iIelhG.js";import{_ as vt}from"./Spin-BUlUfB7E.js";import{_ as Re}from"./Form-C6cUAX00.js";import{_ as ve}from"./Space-DQwm9Psp.js";import{N as Ce,a as Ne,b as L}from"./DescriptionsItem-Bi55qOPT.js";function gt(g){return se({url:"/api/Navigation/route",method:"post",data:g})}function pt(g){return se({url:"/api/Navigation/nearby",method:"get",params:g})}function mt(g){return se({url:`/api/RiderLocations/${g}/latest`,method:"get"})}function ft(g){return se({url:"/api/RiderLocations/area",method:"get",params:g})}function Te(g){return se({url:"/api/RiderLocations/online",method:"get",params:g})}function yt(g){return se({url:`/api/RiderLocations/${g}/address`,method:"get"})}function wt(g,N){return se({url:`/api/RiderLocations/${g}/status`,method:"patch",data:N})}function xt(g,N="订单操作失败，请稍后重试"){let _=N,p="";if(g?.response?.data){const b=g.response.data;p=String(b.code||""),_=b.msg||_}const R={ORDER_001:"订单不存在",ORDER_002:"订单状态不允许此操作",ORDER_003:"订单已被其他骑手接单",ORDER_004:"订单已超时",ORDER_005:"订单金额异常",ORDER_006:"订单地址信息不完整"};return p&&R[p]&&(_=R[p]),window.$message?.error(_),{errorCode:p,message:_,originalError:g}}function ht(g,N="操作"){let _=`${N}失败，请稍后重试`,p="";if(g?.response?.data){const R=g.response.data;p=String(R.code||""),_=R.msg||_}return g?.code==="NETWORK_ERROR"?_="网络连接失败，请检查网络设置":g?.code==="TIMEOUT"&&(_="请求超时，请稍后重试"),window.$message?.error(_),{errorCode:p,message:_,originalError:g}}const _e={apiKey:"2bc67deced375a36fb9db0937fb48d56",version:"2.0",plugins:["AMap.Scale","AMap.ToolBar","AMap.Driving","AMap.Geolocation","AMap.Marker","AMap.InfoWindow","AMap.AutoComplete"]},_t={instance:null,loading:!1,callbacks:[],async load(){return this.instance?this.instance:this.loading?new Promise(g=>{this.callbacks.push(g)}):(this.loading=!0,new Promise((g,N)=>{if(window.AMap){this.instance=window.AMap,this.loading=!1,g(this.instance);return}const _=document.createElement("script");_.type="text/javascript",_.async=!0,_.src=`https://webapi.amap.com/maps?v=${_e.version}&key=${_e.apiKey}&plugin=${_e.plugins.join(",")}`,_.onload=()=>{this.instance=window.AMap,this.loading=!1,g(this.instance),this.callbacks.forEach(p=>p(this.instance)),this.callbacks=[]},_.onerror=p=>{this.loading=!1,console.error("高德地图加载失败:",p),N(new Error("Failed to load AMap: 网络连接失败或API密钥无效"))},document.head.appendChild(_)}))}},bt={class:"amap-container"},kt={key:0,class:"map-loading"},St={class:"map-controls"},$t=be({__name:"amap-map",props:{center:{default:()=>{const g=localStorage.getItem("lastKnownLocation");if(g)try{return JSON.parse(g)}catch{}return{longitude:104.195397,latitude:35.86166}}},zoom:{default:12},showRiders:{type:Boolean,default:!0},navigationRoute:{default:null},isNavigating:{type:Boolean,default:!1},currentOrder:{default:null}},emits:["map-ready","location-update","rider-click","navigation-start","navigation-end","navigation-update"],setup(g,{expose:N,emit:_}){const p=g,R=_,b=u(),i=u(null),d=u(!1),A=u(!1),w=u("loading"),c=u(!1),z=u(p.center),B=u([]),x=u([]),E=u(null),K=u(null),k=u(null),D=u(null),C=u(null),F=u([]),G=u(0),V=u(null),oe=u(!1),m=u(!1);re(()=>p.center,o=>{i.value&&o&&(i.value.setCenter([o.longitude,o.latitude]),z.value=o)},{immediate:!0});const W=()=>{const o=new window.AMap.Size(24,24),y=document.createElement("canvas");y.width=24,y.height=24;const h=y.getContext("2d",{willReadFrequently:!0});return h&&(h.beginPath(),h.arc(12,12,10,0,2*Math.PI),h.fillStyle="#4285f4",h.fill(),h.beginPath(),h.arc(12,12,6,0,2*Math.PI),h.fillStyle="#ffffff",h.fill(),h.beginPath(),h.arc(12,12,2,0,2*Math.PI),h.fillStyle="#4285f4",h.fill()),new window.AMap.Icon({size:o,image:y.toDataURL(),imageSize:o})},q=async()=>{if(!(!i.value||!E.value||c.value)){m.value&&(x.value.forEach(o=>o.remove()),x.value=[],m.value=!1);try{const{data:o}=await Te({pageIndex:1,pageSize:100});if(c.value)return;if(o&&Array.isArray(o))B.value=o,console.log("获取到骑手数据:",o.length,"个");else{B.value=[],console.log("未获取到骑手数据");return}}catch(o){console.error("获取骑手位置失败:",o),c.value||(B.value=[]);return}B.value.forEach(o=>{if(c.value)return;const y=W(),h=new window.AMap.Marker({position:[o.longitude,o.latitude],title:`骑手${o.riderId}`,icon:y,anchor:"center"});h.on("click",()=>{c.value||(E.value.setContent(`
        <div style="padding: 10px;">
          <h4 style="margin: 0 0 8px 0; color: #333;">骑手${o.riderId}</h4>
          <p style="margin: 4px 0; color: #666;">状态: ${o.status===1?"在线":"离线"}</p>
          <p style="margin: 4px 0; color: #666;">经度: ${o.longitude.toFixed(6)}</p>
          <p style="margin: 4px 0; color: #666;">纬度: ${o.latitude.toFixed(6)}</p>
          <p style="margin: 4px 0; color: #666;">更新时间: ${new Date(o.locationTime).toLocaleString()}</p>
        </div>
      `),E.value.open(i.value,h.getPosition()),R("rider-click",o))}),h.setMap(i.value),x.value.push(h)}),m.value=!0}},j=async()=>{if(!b.value||c.value){console.warn("地图容器未准备好或组件已销毁");return}try{c.value||(w.value="loading"),console.log("开始加载高德地图...",{container:b.value,containerSize:{width:b.value.offsetWidth,height:b.value.offsetHeight}});const o=await _t.load();if(c.value)return;if(console.log("高德地图加载成功"),b.value.offsetWidth===0||b.value.offsetHeight===0){console.warn("地图容器尺寸为0，等待容器渲染..."),setTimeout(()=>j(),200);return}i.value=new o.Map(b.value,{zoom:p.zoom,center:[z.value.longitude,z.value.latitude],mapStyle:"amap://styles/normal",features:["bg","road","building"],viewMode:"2D"}),i.value.addControl(new o.Scale),i.value.addControl(new o.ToolBar);const y=new o.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB",buttonOffset:new o.Pixel(10,20),zoomToAccuracy:!0,showMarker:!1,showButton:!0,markerOptions:{icon:new o.Icon({size:new o.Size(0,0),image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="})}});if(i.value.addControl(y),K.value=y,y.on("complete",h=>{if(c.value)return;const ee={longitude:h.position.lng,latitude:h.position.lat};z.value=ee;try{localStorage.setItem("lastKnownLocation",JSON.stringify(ee))}catch(ne){console.warn("保存位置信息失败:",ne)}R("location-update",ee),i.value&&!c.value&&i.value.setCenter([h.position.lng,h.position.lat]),window.$message?.success("定位成功！"),console.log("地图定位成功，新位置:",ee)}),y.on("error",h=>{c.value||(console.error("定位失败:",h),window.$message?.error("定位失败，请检查定位权限"))}),E.value=new o.InfoWindow({offset:new o.Pixel(0,-30)}),c.value||(w.value="ready",R("map-ready",i.value)),p.showRiders&&await q(),K.value)try{setTimeout(()=>{K.value.getCurrentPosition()},500)}catch(h){console.log("初始定位失败，使用传入的位置:",h)}}catch(o){console.error("地图初始化失败:",o),c.value||(w.value="error"),b.value&&(b.value.innerHTML=`
        <div style="
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100%;
          background: #f5f5f5;
          border-radius: 12px;
          color: #666;
          text-align: center;
          padding: 20px;
        ">
          <div style="font-size: 48px; margin-bottom: 16px;">🗺️</div>
          <h3 style="margin: 0 0 8px 0; color: #333;">地图加载失败</h3>
          <p style="margin: 0 0 16px 0; font-size: 14px;">网络连接问题或API密钥无效</p>
          <button onclick="window.location.reload()" style="
            background: #4285f4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
          ">重新加载</button>
        </div>
      `)}},ae=o=>{if(!(!i.value||!o.polyline)){H();try{console.log("开始绘制导航路线...");const y=o.polyline.split(";").map(h=>{const[ee,ne]=h.split(",").map(Number);return[ee,ne]});k.value=new AMap.Polyline({path:y,borderWeight:3,strokeColor:"#3366FF",strokeOpacity:.8,strokeWeight:6,strokeStyle:"solid",lineJoin:"round",lineCap:"round",zIndex:5}),i.value.add(k.value),y.length>0&&(D.value=new AMap.Marker({position:y[0],icon:new AMap.Icon({size:new AMap.Size(32,32),image:"data:image/svg+xml;base64,"+btoa(`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#4CAF50">
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
          `),imageSize:new AMap.Size(32,32)}),title:"起点"}),C.value=new AMap.Marker({position:y[y.length-1],icon:new AMap.Icon({size:new AMap.Size(32,32),image:"data:image/svg+xml;base64,"+btoa(`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#F44336">
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
          `),imageSize:new AMap.Size(32,32)}),title:"终点"}),i.value.add(D.value),i.value.add(C.value)),i.value.setFitView([k.value],!1,[50,50,50,50]),console.log("导航路线绘制成功")}catch(y){console.error("导航路线绘制失败:",y)}}},H=()=>{k.value&&(i.value?.remove(k.value),k.value=null),D.value&&(i.value?.remove(D.value),D.value=null),C.value&&(i.value?.remove(C.value),C.value=null),F.value.forEach(o=>o.remove()),F.value=[]},T=()=>{!p.navigationRoute||!i.value||(oe.value=!0,G.value=0,ae(p.navigationRoute),Q(),R("navigation-start"),console.log("导航已开始"))},P=()=>{oe.value=!1,G.value=0,H(),V.value&&(clearInterval(V.value),V.value=null),R("navigation-end"),console.log("导航已结束")},Q=()=>{V.value&&clearInterval(V.value),V.value=setInterval(()=>{oe.value&&p.currentOrder&&Z()},5e3)},Z=async()=>{if(!(!p.currentOrder||!oe.value))try{const o={routeId:p.navigationRoute?.routeId||"",currentLongitude:z.value.longitude,currentLatitude:z.value.latitude,currentSpeed:30,remainingTime:1200,remainingDistance:5e3,nextInstruction:"前方200米右转",timestamp:new Date().toISOString()};R("navigation-update",o)}catch(o){console.error("更新导航状态失败:",o)}},pe=async()=>{if(!c.value){d.value=!0;try{console.log("开始刷新地图..."),x.value.forEach(o=>o.remove()),x.value=[],H(),i.value&&(i.value.destroy(),i.value=null),w.value="loading",setTimeout(async()=>{await j(),window.$message?.success("地图刷新成功")},100)}catch(o){console.error("刷新地图失败:",o),window.$message?.error("地图刷新失败")}finally{d.value=!1}}},X=async()=>{if(!i.value||!K.value){window.$message?.warning("地图未初始化完成，请稍后再试");return}A.value=!0;try{K.value.getCurrentPosition()}catch(o){console.error("定位失败:",o),window.$message?.error("定位失败，请检查定位权限")}finally{A.value=!1}},ue=async()=>{d.value=!0;try{if(m.value?await q():await q(),B.value.length>0){if(window.$message?.success(`成功显示 ${B.value.length} 个骑手位置`),B.value.length>1){const o=new window.AMap.Bounds;B.value.forEach(y=>{o.extend([y.longitude,y.latitude])}),i.value.setBounds(o,{padding:[50,50,50,50]})}}else window.$message?.warning("当前区域暂无在线骑手")}catch(o){console.error("显示骑手失败:",o),window.$message?.error("显示骑手失败，请稍后重试")}finally{d.value=!1}},me=()=>{x.value.length>0?(x.value.forEach(o=>o.remove()),x.value=[],m.value=!1,B.value=[],window.$message?.success("已清除骑手标记")):window.$message?.info("当前没有显示骑手标记")};return re(()=>p.center,o=>{o&&i.value&&!c.value&&(console.log("中心点变化，更新地图:",o),i.value.setCenter([o.longitude,o.latitude]),z.value=o)},{deep:!0}),re(()=>p.navigationRoute,o=>{o&&i.value&&!c.value?(console.log("导航路线变化，绘制路线:",o),ae(o)):!o&&i.value&&(console.log("清除导航路线"),H())},{deep:!0}),re(()=>p.isNavigating,o=>{o&&i.value&&p.navigationRoute?(console.log("进入导航模式"),T()):o||(console.log("退出导航模式"),P())}),ze(async()=>{await ot(),setTimeout(()=>{j()},100)}),Le(()=>{c.value=!0,P(),i.value&&i.value.destroy(),x.value.forEach(o=>o.remove())}),N({clearRiderMarkers:me,addRiderMarkers:q,refreshLocation:X}),(o,y)=>($(),M("div",bt,[n("div",{ref_key:"mapContainer",ref:b,class:"map-container"},[w.value==="loading"?($(),M("div",kt,y[0]||(y[0]=[n("div",{class:"loading-spinner"},null,-1),n("p",null,"地图加载中...",-1)]))):O("",!0)],512),n("div",St,[l(a(I),{type:"primary",size:"small",onClick:pe,loading:d.value},{icon:r(()=>y[1]||(y[1]=[n("span",{class:"text-lg"},"🔄",-1)])),default:r(()=>[y[2]||(y[2]=f(" 刷新地图 "))]),_:1,__:[2]},8,["loading"]),l(a(I),{type:"info",size:"small",onClick:X,loading:A.value},{icon:r(()=>y[3]||(y[3]=[n("span",{class:"text-lg"},"📍",-1)])),default:r(()=>[y[4]||(y[4]=f(" 定位我 "))]),_:1,__:[4]},8,["loading"]),l(a(I),{type:"success",size:"small",onClick:ue,loading:d.value},{default:r(()=>[f(" 显示骑手 ("+v(B.value.length)+") ",1)]),_:1},8,["loading"])])]))}}),At=ke($t,[["__scopeId","data-v-0bcb8f54"]]);async function It(g){return new Promise((N,_)=>{const p="https://restapi.amap.com/v3/assistant/inputtips",R=new URLSearchParams({key:"2bc67deced375a36fb9db0937fb48d56",keywords:g.keywords,city:g.city||"",citylimit:g.citylimit?"true":"false",datatype:"all",output:"json"}),b=`${p}?${R.toString()}`,i=`amap_callback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=document.createElement("script");d.src=`${b}&callback=${i}`,d.async=!0,window[i]=A=>{try{if(A&&A.status==="1"&&A.tips){const w=A.tips.map(c=>({id:c.id||`${c.name}_${c.district}`,name:c.name||"",district:c.district||"",adcode:c.adcode||"",location:c.location||"",address:c.address||"",typecode:c.typecode||""}));N({data:{tips:w}})}else N({data:{tips:[]}})}catch(w){_(w)}finally{document.head.removeChild(d),window[i]=void 0}},d.onerror=()=>{document.head.removeChild(d),window[i]=void 0,_(new Error("网络请求失败"))},document.head.appendChild(d),setTimeout(()=>{document.head.contains(d)&&(document.head.removeChild(d),window[i]=void 0,N({data:{tips:[]}}))},5e3)})}const Mt={class:"address-search"},Rt={class:"search-input-container"},Ct={key:0,class:"suggestions-dropdown"},Nt=["onClick","onMouseenter"],Dt={class:"suggestion-main"},zt={class:"suggestion-name"},Lt={class:"suggestion-address"},Ot={class:"suggestion-district"},Pt={key:1,class:"no-results"},Et={key:2,class:"loading-container"},Tt=be({__name:"AddressSearch",props:{placeholder:{default:"请输入地址"},city:{default:""},location:{default:""},modelValue:{default:""}},emits:["update:modelValue","select"],setup(g,{expose:N,emit:_}){const p=g,R=_,b=u(p.modelValue),i=u([]),d=u(!1),A=u(-1),w=u(!1),c=u(null),z=async()=>{const k=b.value.trim();if(!k){i.value=[],d.value=!1;return}try{w.value=!0;const{data:D}=await It({keywords:k,city:p.city,location:p.location,citylimit:!!p.city});D&&D.tips?(i.value=D.tips,d.value=!0,A.value=-1):(i.value=[],d.value=!0)}catch{i.value=[],d.value=!0}finally{w.value=!1}};re(b,k=>{R("update:modelValue",k),c.value&&clearTimeout(c.value),k.trim()?c.value=setTimeout(()=>{z()},300):(i.value=[],d.value=!1)}),re(()=>p.modelValue,k=>{b.value=k});const B=()=>{i.value.length>0&&(d.value=!0)},x=()=>{setTimeout(()=>{d.value=!1},200)},E=k=>{b.value=k.name,i.value=[],d.value=!1,A.value=-1,R("select",k)},K=k=>{if(!(!d.value||i.value.length===0))switch(k.key){case"ArrowDown":k.preventDefault(),A.value=Math.min(A.value+1,i.value.length-1);break;case"ArrowUp":k.preventDefault(),A.value=Math.max(A.value-1,-1);break;case"Enter":k.preventDefault(),A.value>=0&&A.value<i.value.length&&E(i.value[A.value]);break;case"Escape":d.value=!1,A.value=-1;break}};return N({focus:()=>{},clear:()=>{b.value="",i.value=[],d.value=!1}}),(k,D)=>($(),M("div",Mt,[n("div",Rt,[l(a(ge),{value:b.value,"onUpdate:value":D[0]||(D[0]=C=>b.value=C),placeholder:k.placeholder,size:"large",clearable:"",onInput:z,onFocus:B,onBlur:x,onKeydown:K},{prefix:r(()=>[l(a(U),{icon:"ion:search"})]),_:1},8,["value","placeholder"]),d.value&&i.value.length>0?($(),M("div",Ct,[($(!0),M(Oe,null,Pe(i.value,(C,F)=>($(),M("div",{key:C.id,class:Ee(["suggestion-item",{"is-active":A.value===F}]),onClick:G=>E(C),onMouseenter:G=>A.value=F},[n("div",Dt,[n("div",zt,v(C.name),1),n("div",Lt,v(C.address),1)]),n("div",Ot,v(C.district),1)],42,Nt))),128))])):O("",!0),d.value&&i.value.length===0&&b.value&&!w.value?($(),M("div",Pt,[l(a(nt),{description:"未找到相关地址"})])):O("",!0),w.value?($(),M("div",Et,[l(a(vt),{size:"small"}),D[1]||(D[1]=n("span",{class:"ml-8px"},"搜索中...",-1))])):O("",!0)])]))}}),De=ke(Tt,[["__scopeId","data-v-320dfc5a"]]),Ut={class:"min-h-full p-24px bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800"},Bt={class:"flex items-center gap-3"},Ft={class:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center"},Vt={class:"mb-16px flex items-center justify-between"},Kt={class:"mt-16px grid grid-cols-4 gap-16px"},Gt={class:"text-2xl font-bold text-blue-600"},Yt={class:"text-2xl font-bold text-green-600"},jt={class:"text-2xl font-bold text-purple-600"},Jt={key:0,class:"text-xs text-gray-400 mt-1"},Wt={class:"text-sm text-gray-500"},qt={class:"mt-16px"},Ht={class:"flex items-center gap-2"},Qt={class:"text-sm font-medium"},Zt={key:0},Xt={key:1},ea={key:2,class:"text-center py-32px"},ta={class:"space-y-16px"},aa={key:0,class:"bg-gray-50 p-12px rounded-lg"},la={key:0,class:"text-sm text-gray-600 mb-4px"},sa={class:"text-xs text-gray-500 ml-8px"},oa={key:1,class:"text-sm text-gray-600"},na={class:"text-xs text-gray-500 ml-8px"},ra={class:"flex justify-end space-x-8px"},ia={key:0},ua={key:1,class:"text-center py-32px text-gray-500"},da={key:0,class:"space-y-16px"},ca={class:"bg-blue-50 p-16px rounded-lg"},va={class:"grid grid-cols-2 gap-16px"},ga={class:"text-center"},pa={class:"text-2xl font-bold text-blue-600"},ma={class:"text-center"},fa={class:"text-2xl font-bold text-green-600"},ya={key:0},wa={class:"max-h-200px overflow-y-auto space-y-8px"},xa={class:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold mr-12px"},ha={class:"flex-1"},_a={class:"text-sm font-medium"},ba={class:"text-xs text-gray-500"},ka={key:0,class:"text-center text-gray-500 text-sm"},Sa={class:"flex justify-end space-x-8px"},$a={key:0,class:"space-y-16px"},Aa={class:"bg-blue-50 p-16px rounded-lg text-center"},Ia={class:"text-xl font-bold"},Ma={class:"grid grid-cols-2 gap-16px"},Ra={class:"text-center"},Ca={class:"text-2xl font-bold text-red-600"},Na={class:"text-center"},Da={class:"text-2xl font-bold text-orange-600"},za={class:"text-center"},La={class:"text-lg font-semibold"},Oa={class:"flex justify-center space-x-8px"},Pa=be({name:"delivery",__name:"index",setup(g){const N=rt(),_=it(),p=Ae(()=>_.riderId||N.userInfo.userId),R=u([]),b=u(!1),i=u({page:1,pageSize:10,itemCount:0}),d=u({orderId:"",status:void 0,startDate:null,endDate:null}),A=u(!1),w=u(null),c=u(null),z=u(!1),x=u((()=>{const s=localStorage.getItem("lastKnownLocation");if(s)try{return JSON.parse(s)}catch{}return{longitude:104.195397,latitude:35.86166}})()),E=u([]),K=u(null),k=u(null),D=u(""),C=u(!0),F=u(null),G=u(!1),V={0:{text:"未处理",type:"warning"},1:{text:"已接单",type:"primary"},2:{text:"已拒单",type:"error"},3:{text:"已完成",type:"success"}},oe=[{label:"全部状态",value:void 0},{label:"未处理",value:0},{label:"已接单",value:1},{label:"已拒单",value:2},{label:"已完成",value:3}],m=u({nearbyServicePoints:[],currentRoute:null,isNavigating:!1,navigationUpdate:null,currentStepIndex:0,navigationSteps:[]}),W=u(!1),q=u(!1),j=u(!1),ae=u(!1),H=u({startAddress:"",endAddress:"",routeType:"driving"}),T=u(null),P=u(null),Q=u(""),Z=u(""),pe=[{label:"驾车",value:"driving"},{label:"步行",value:"walking"},{label:"骑行",value:"cycling"},{label:"公共交通",value:"transit"}],X=async()=>{b.value=!0;try{const s={page:i.value.page,pageSize:i.value.pageSize,...d.value.status!==void 0&&{status:d.value.status},...d.value.startDate&&{startDate:d.value.startDate},...d.value.endDate&&{endDate:d.value.endDate}},{data:e}=await dt(p.value,s);if(console.log("data",e),Array.isArray(e)){let t=e;d.value.orderId&&(t=t.filter(S=>S.order?.orderId?.includes(d.value.orderId))),R.value=t,i.value.itemCount=t.length}else R.value=[],i.value.itemCount=0}catch(s){ht(s,"获取订单数据")}finally{b.value=!1}},ue=async s=>{z.value=!0;try{w.value&&(c.value={...w.value,assignedAt:w.value.assignedAt||new Date().toISOString(),acceptedAt:w.value.acceptedAt||null,timeOut:30}),console.log("使用基本信息作为订单详情")}catch(e){console.error("获取订单详情失败:",e),window.$message?.warning("订单详情功能暂时不可用，显示基本信息")}finally{z.value=!1}},me=()=>new Promise((s,e)=>{if(!navigator.geolocation){e(new Error("浏览器不支持GPS定位"));return}navigator.geolocation.getCurrentPosition(t=>{const S={longitude:t.coords.longitude,latitude:t.coords.latitude};console.log("GPS定位成功:",S),s(S)},t=>{console.error("GPS定位失败:",t),e(t)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4})}),o=async()=>{try{try{const e=await me();x.value=e;try{localStorage.setItem("lastKnownLocation",JSON.stringify(e))}catch(t){console.warn("保存位置信息失败:",t)}console.log("GPS位置获取成功:",e);return}catch(e){console.warn("GPS定位失败，尝试从服务器获取位置:",e)}const{data:s}=await mt(p.value);if(console.log("服务器位置数据:",s),s&&s.longitude&&s.latitude){const e={longitude:s.longitude,latitude:s.latitude};x.value=e;try{localStorage.setItem("lastKnownLocation",JSON.stringify(e))}catch(t){console.warn("保存位置信息失败:",t)}console.log("使用服务器位置:",e)}else console.log("服务器位置数据不完整，使用默认位置")}catch(s){console.error("获取骑手位置失败:",s),window.$message?.warning("位置获取失败，使用默认位置")}},y=async()=>{try{window.$message?.loading("正在获取附近骑手...");const{data:s}=await ft({minLongitude:x.value.longitude-.1,maxLongitude:x.value.longitude+.1,minLatitude:x.value.latitude-.1,maxLatitude:x.value.latitude+.1,pageIndex:1,pageSize:100});if(s&&Array.isArray(s))E.value=s,window.$message?.success(`找到 ${s.length} 个附近骑手`);else{const{data:e}=await Te({pageIndex:1,pageSize:100});if(e&&Array.isArray(e)){const S=e.filter(Y=>Math.sqrt((Y.longitude-x.value.longitude)**2+(Y.latitude-x.value.latitude)**2)<=.1);E.value=S,window.$message?.success(`找到 ${S.length} 个附近骑手`)}else E.value=[],window.$message?.warning("未找到附近骑手")}}catch(s){console.error("获取区域内骑手失败:",s),E.value=[],window.$message?.error("获取附近骑手失败")}},h=()=>{k.value?k.value.clearRiderMarkers():window.$message?.warning("地图组件未准备好")},ee=async()=>{try{const{data:s}=await yt(p.value);D.value=s?.address||"地址获取失败"}catch(s){console.error("获取地址失败:",s),D.value="地址获取失败"}},ne=()=>{F.value&&clearInterval(F.value),F.value=setInterval(async()=>{if(C.value&&!G.value){G.value=!0;try{await o(),console.log("定时位置更新完成")}catch(s){console.error("定时位置更新失败:",s)}finally{G.value=!1}}},12e4),console.log("位置更新定时器已启动（2分钟间隔）")},Se=()=>{F.value&&(clearInterval(F.value),F.value=null,console.log("位置更新定时器已停止"))},Ue=async s=>{try{await wt(p.value,{status:s?1:0,timestamp:new Date().toISOString()}),C.value=s,s?(ne(),window.$message?.success("已上线，开始位置更新")):(Se(),window.$message?.success("已下线，停止位置更新"))}catch(e){console.error("更新状态失败:",e),window.$message?.error("更新状态失败")}},Be=()=>{i.value.page=1,X()},Fe=()=>{d.value={orderId:"",status:void 0,startDate:null,endDate:null},i.value.page=1,X()},Ve=s=>{K.value=s,console.log("地图加载完成"),o()},Ke=s=>{x.value=s},Ge=s=>{console.log("点击骑手:",s)},fe=async(s,e)=>{try{console.log("startloc",s),console.log("endloc",e);const t={startLongitude:s.longitude,startLatitude:s.latitude,endLongitude:e.longitude,endLatitude:e.latitude,mode:H.value.routeType};console.log("请求数据:",t);const S=await gt(t);console.log("完整响应:",S),console.log("响应数据:",S.data),S.data?.data?(m.value.currentRoute=S.data.data,m.value.navigationSteps=S.data.data.steps||[],m.value.currentStepIndex=0,W.value=!1,j.value=!0,window.$message?.success("路线规划成功")):(console.warn("响应数据为空"),window.$message?.warning("路线规划返回空数据"))}catch(t){console.error("路线规划失败:",t),console.error("错误详情:",{message:t.message,code:t.code,response:t.response?.data,status:t.response?.status,statusText:t.response?.statusText}),window.$message?.error(`路线规划失败: ${t.message||"未知错误"}`)}},Ye=async()=>{try{const{data:s}=await pt({longitude:x.value.longitude,latitude:x.value.latitude,serviceType:"all",radius:2e3});s&&(m.value.nearbyServicePoints=s.data,q.value=!0,window.$message?.success(`找到 ${s.data.length} 个附近服务点`))}catch(s){console.error("获取附近服务点失败:",s),window.$message?.error(`获取附近服务点失败: ${s.message||"未知错误"}`)}},de=s=>s<1e3?`${s}米`:`${(s/1e3).toFixed(1)}公里`,ye=s=>{const e=Math.floor(s/3600),t=Math.floor(s%3600/60);return e>0?`${e}小时${t}分钟`:`${t}分钟`},je=async s=>{try{const[e,t]=s.location.split(",").map(Number);T.value={longitude:e,latitude:t},Q.value=s.name,window.$message?.success(`已选择起点: ${s.name}`)}catch(e){console.error("处理起点地址失败:",e),window.$message?.error("处理起点地址失败")}},Je=async s=>{try{const[e,t]=s.location.split(",").map(Number);P.value={longitude:e,latitude:t},Z.value=s.name,window.$message?.success(`已选择终点: ${s.name}`)}catch(e){console.error("处理终点地址失败:",e),window.$message?.error("处理终点地址失败")}},We=async()=>{if(!T.value||!P.value){window.$message?.warning("请选择起点和终点地址");return}try{await fe(T.value,P.value)}catch(s){console.error("路线规划失败:",s),window.$message?.error(`路线规划失败: ${s.message||"未知错误"}`)}},qe=()=>{T.value=null,P.value=null,Q.value="",Z.value=""},$e=()=>{if(!m.value.currentRoute){window.$message?.warning("请先规划路线");return}m.value.isNavigating=!0,j.value=!1,ae.value=!0,window.$message?.success("导航已开始"),console.log("开始导航:",m.value.currentRoute)},we=()=>{m.value.isNavigating=!1,m.value.currentRoute=null,m.value.navigationUpdate=null,m.value.currentStepIndex=0,m.value.navigationSteps=[],ae.value=!1,window.$message?.success("导航已结束"),console.log("结束导航")},He=()=>{if(!T.value||!P.value){window.$message?.warning("请重新选择起点和终点"),W.value=!0;return}fe(T.value,P.value)},Qe=s=>{m.value.navigationUpdate=s,console.log("导航更新:",s)},Ze=()=>{console.log("地图导航已开始")},Xe=()=>{console.log("地图导航已结束"),we()},et=async s=>{if(!s.order?.address){window.$message?.warning("订单地址信息不完整");return}try{const e=x.value,t={longitude:116.397428+Math.random()*.01,latitude:39.90923+Math.random()*.01};T.value=e,P.value=t,Q.value="当前位置",Z.value=s.order.address.detailedAddress,await fe(e,t),w.value=s,window.$message?.success("已为订单规划导航路线")}catch(e){console.error("订单导航规划失败:",e),window.$message?.error("订单导航规划失败")}},tt=s=>({gas_station:"加油站",restaurant:"餐厅",hospital:"医院",police:"警察局",other:"其他"})[s]||"未知";ze(async()=>{!N.userInfo.userId&&N.token&&await N.initUserInfo(),N.userInfo.userId||Object.assign(N.userInfo,{userId:`rider_${Date.now()}`,userName:"测试骑手",roles:["rider"],buttons:[]}),await X(),await o(),await ee(),C.value&&ne()});const at=s=>{i.value.page=s,X()};Le(()=>{Se(),K.value&&(K.value=null)});async function lt(s){try{w.value=s,A.value=!0,c.value=null,s.assignId&&await ue(s.assignId)}catch(e){console.error("打开订单详情失败:",e),window.$message?.error("打开订单详情失败，请稍后重试")}}async function xe(s,e){const t={1:"接单",2:"拒单",3:"完成订单"}[e]||"更新状态";try{window.$dialog?.warning({title:`确认${t}`,content:`确定要${t}订单 ${s.order?.orderId} 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const S=s.assignId||"";await ct(p.value,S,{acceptedStatus:e}),window.$message?.success(`${t}成功！`),await X(),A.value&&s.assignId&&await ue(s.assignId)}catch(S){xt(S,`${t}失败，请稍后重试`)}}})}catch(S){console.error("操作失败",S)}}const st=Ae(()=>!R.value||!Array.isArray(R.value)?[]:R.value);return(s,e)=>($(),M("div",Ut,[l(a(J),{bordered:!1,class:"mb-24px bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm"},{default:r(()=>[n("div",Bt,[n("div",Ft,[l(a(U),{icon:"mdi:motorbike",class:"text-2xl text-white"})]),e[18]||(e[18]=n("div",null,[n("h1",{class:"text-2xl text-gray-800 font-bold dark:text-gray-200"},"配送订单管理"),n("p",{class:"mt-2px text-gray-600 dark:text-gray-400"},"查看和管理您的配送订单，及时处理订单状态")],-1))])]),_:1}),l(a(J),{bordered:!1,class:"mb-24px bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-16px shadow-lg"},{default:r(()=>[l(a(Re),{model:d.value,inline:""},{default:r(()=>[l(a(le),{label:"订单号"},{default:r(()=>[l(a(ge),{value:d.value.orderId,"onUpdate:value":e[0]||(e[0]=t=>d.value.orderId=t),placeholder:"请输入订单号",style:{width:"200px"}},null,8,["value"])]),_:1}),l(a(le),{label:"状态"},{default:r(()=>[l(a(Ie),{value:d.value.status,"onUpdate:value":e[1]||(e[1]=t=>d.value.status=t),options:oe,placeholder:"请选择状态",style:{width:"150px"}},null,8,["value"])]),_:1}),l(a(le),{label:"创建时间"},{default:r(()=>[l(a(ve),null,{default:r(()=>[l(a(ge),{value:d.value.startDate,"onUpdate:value":e[2]||(e[2]=t=>d.value.startDate=t),placeholder:"开始日期 (YYYY-MM-DD)",style:{width:"150px"}},null,8,["value"]),e[19]||(e[19]=n("span",null,"至",-1)),l(a(ge),{value:d.value.endDate,"onUpdate:value":e[3]||(e[3]=t=>d.value.endDate=t),placeholder:"结束日期 (YYYY-MM-DD)",style:{width:"150px"}},null,8,["value"])]),_:1,__:[19]})]),_:1}),l(a(le),null,{default:r(()=>[l(a(ve),null,{default:r(()=>[l(a(I),{type:"primary",onClick:Be},{default:r(()=>e[20]||(e[20]=[f("搜索")])),_:1,__:[20]}),l(a(I),{onClick:Fe},{default:r(()=>e[21]||(e[21]=[f("重置")])),_:1,__:[21]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(a(ut),{type:"line",animated:""},{default:r(()=>[l(a(Me),{name:"orders",tab:"订单列表"},{default:r(()=>[l(a(J),{bordered:!1,class:"rounded-16px shadow-lg bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm"},{default:r(()=>[l(a(Ce),{columns:[{title:"订单号",key:"orderId",render:t=>t.order?.orderId||"-"},{title:"配送地址",key:"address",render:t=>t.order?.address?.detailedAddress||"-"},{title:"商家名称",key:"merchant",render:t=>t.order?.address?.receiverName||"-"},{title:"状态",key:"status",render(t){const S=t.acceptedStatus||0,Y=V[S]||{text:"未知",type:"default"};return te(a(ce),{type:Y.type,size:"small"},{default:()=>Y.text})}},{title:"金额",key:"amount",render:t=>`￥${t.order?.orderAmount||0}`},{title:"创建时间",key:"createAt",render:t=>t.order?.createAt||"-"},{title:"操作",key:"actions",render(t){const S=t.acceptedStatus||0,Y=[];return Y.push(te(a(I),{size:"small",type:"primary",onClick:()=>lt(t)},{default:()=>"详情"})),S===0?Y.push(te(a(I),{size:"small",type:"success",onClick:()=>xe(t,1)},{default:()=>"接单"}),te(a(I),{size:"small",type:"warning",onClick:()=>xe(t,2)},{default:()=>"拒单"})):S===1&&Y.push(te(a(I),{size:"small",type:"info",onClick:()=>et(t)},{default:()=>"导航"}),te(a(I),{size:"small",type:"success",onClick:()=>xe(t,3)},{default:()=>"完成"})),te(a(ve),null,{default:()=>Y})}}],data:st.value,loading:b.value,pagination:i.value,"onUpdate:page":at},null,8,["columns","data","loading","pagination"])]),_:1})]),_:1}),l(a(Me),{name:"map",tab:"配送地图"},{default:r(()=>[l(a(J),{bordered:!1,class:"rounded-16px shadow-lg bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm"},{default:r(()=>[n("div",Vt,[e[30]||(e[30]=n("div",null,[n("h3",{class:"text-lg font-semibold mb-8px"},"实时配送地图"),n("p",{class:"text-gray-600 text-sm"},"查看骑手位置和配送路线")],-1)),l(a(ve),null,{default:r(()=>[l(a(I),{type:"success",onClick:e[4]||(e[4]=t=>o()),loading:G.value},{default:r(()=>[l(a(U),{icon:"mdi:refresh",class:"mr-1"}),e[22]||(e[22]=f(" 刷新位置 "))]),_:1,__:[22]},8,["loading"]),l(a(I),{type:C.value?"success":"warning",onClick:e[5]||(e[5]=t=>Ue(!C.value))},{default:r(()=>[l(a(U),{icon:C.value?"mdi:account-check":"mdi:account-off",class:"mr-1"},null,8,["icon"]),f(" "+v(C.value?"下线":"上线"),1)]),_:1},8,["type"]),l(a(I),{type:"primary",onClick:y},{default:r(()=>[l(a(U),{icon:"mdi:account-group",class:"mr-1"}),e[23]||(e[23]=f(" 附近骑手 "))]),_:1,__:[23]}),l(a(I),{type:"error",onClick:h},{default:r(()=>[l(a(U),{icon:"mdi:map-marker-off",class:"mr-1"}),e[24]||(e[24]=f(" 清除骑手标记 "))]),_:1,__:[24]}),l(a(I),{type:"info",onClick:e[6]||(e[6]=t=>Ye())},{default:r(()=>[l(a(U),{icon:"mdi:map-marker-multiple",class:"mr-1"}),e[25]||(e[25]=f(" 附近服务 "))]),_:1,__:[25]}),l(a(I),{type:"warning",onClick:e[7]||(e[7]=t=>W.value=!0)},{default:r(()=>[l(a(U),{icon:"mdi:route",class:"mr-1"}),e[26]||(e[26]=f(" 路线规划 "))]),_:1,__:[26]}),m.value.currentRoute&&!m.value.isNavigating?($(),he(a(I),{key:0,type:"success",onClick:$e},{default:r(()=>[l(a(U),{icon:"mdi:navigation",class:"mr-1"}),e[27]||(e[27]=f(" 开始导航 "))]),_:1,__:[27]})):O("",!0),m.value.isNavigating?($(),he(a(I),{key:1,type:"error",onClick:we},{default:r(()=>[l(a(U),{icon:"mdi:stop",class:"mr-1"}),e[28]||(e[28]=f(" 结束导航 "))]),_:1,__:[28]})):O("",!0),m.value.currentRoute?($(),he(a(I),{key:2,type:"info",onClick:He},{default:r(()=>[l(a(U),{icon:"mdi:refresh",class:"mr-1"}),e[29]||(e[29]=f(" 重新规划 "))]),_:1,__:[29]})):O("",!0)]),_:1})]),l(At,{ref_key:"amapMapRef",ref:k,center:x.value,zoom:12,"show-riders":!0,"navigation-route":m.value.currentRoute,"is-navigating":m.value.isNavigating,"current-order":w.value,onMapReady:Ve,onLocationUpdate:Ke,onRiderClick:Ge,onNavigationStart:Ze,onNavigationEnd:Xe,onNavigationUpdate:Qe},null,8,["center","navigation-route","is-navigating","current-order"]),n("div",Kt,[l(a(J),{size:"small",class:"text-center"},{default:r(()=>[n("div",Gt,v(x.value.longitude.toFixed(6)),1),e[31]||(e[31]=n("div",{class:"text-sm text-gray-500"},"经度",-1))]),_:1,__:[31]}),l(a(J),{size:"small",class:"text-center"},{default:r(()=>[n("div",Yt,v(x.value.latitude.toFixed(6)),1),e[32]||(e[32]=n("div",{class:"text-sm text-gray-500"},"纬度",-1))]),_:1,__:[32]}),l(a(J),{size:"small",class:"text-center"},{default:r(()=>[n("div",jt,v(E.value.length),1),e[33]||(e[33]=n("div",{class:"text-sm text-gray-500"},"区域内骑手",-1)),E.value.length===0?($(),M("div",Jt,'点击"附近骑手"获取')):O("",!0)]),_:1,__:[33]}),l(a(J),{size:"small",class:"text-center"},{default:r(()=>[n("div",{class:Ee(["text-lg font-bold",C.value?"text-green-600":"text-gray-500"])},v(C.value?"在线":"离线"),3),n("div",Wt,v(G.value?"更新中...":"状态"),1)]),_:1})]),n("div",qt,[l(a(J),{size:"small"},{default:r(()=>[n("div",Ht,[l(a(U),{icon:"mdi:map-marker",class:"text-red-500"}),e[34]||(e[34]=n("span",{class:"text-sm text-gray-600"},"当前位置：",-1)),n("span",Qt,v(D.value||"获取中..."),1)])]),_:1})])]),_:1})]),_:1})]),_:1}),l(a(ie),{show:A.value,"onUpdate:show":e[8]||(e[8]=t=>A.value=t),preset:"card",title:"订单详情",class:"w-[600px]",loading:z.value},{default:r(()=>[!z.value&&c.value?($(),M("div",Zt,[l(a(Ne),{"label-placement":"left",bordered:"",column:1},{default:r(()=>[l(a(L),{label:"订单号"},{default:r(()=>[f(v(c.value.order?.orderId||"-"),1)]),_:1}),l(a(L),{label:"配送地址"},{default:r(()=>[f(v(c.value.order?.address?.detailedAddress||"-"),1)]),_:1}),l(a(L),{label:"收货人姓名"},{default:r(()=>[f(v(c.value.order?.address?.receiverName||"-"),1)]),_:1}),l(a(L),{label:"收货人电话"},{default:r(()=>[f(v(c.value.order?.address?.receiverPhone||"-"),1)]),_:1}),l(a(L),{label:"分配时间"},{default:r(()=>[f(v(c.value.assignedAt||"-"),1)]),_:1}),l(a(L),{label:"接单时间"},{default:r(()=>[f(v(c.value.acceptedAt||"-"),1)]),_:1}),l(a(L),{label:"订单金额"},{default:r(()=>[f("￥"+v(c.value.order?.orderAmount||0),1)]),_:1}),l(a(L),{label:"订单状态"},{default:r(()=>[l(a(ce),{type:V[c.value.acceptedStatus||0]?.type||"default",size:"small"},{default:r(()=>[f(v(V[c.value.acceptedStatus||0]?.text||"未知"),1)]),_:1},8,["type"])]),_:1}),l(a(L),{label:"创建时间"},{default:r(()=>[f(v(c.value.order?.createAt||"-"),1)]),_:1}),l(a(L),{label:"超时时间"},{default:r(()=>[f(v(c.value.timeOut||0)+" 分钟 ",1)]),_:1})]),_:1})])):!z.value&&w.value?($(),M("div",Xt,[l(a(Ne),{"label-placement":"left",bordered:"",column:1},{default:r(()=>[l(a(L),{label:"订单号"},{default:r(()=>[f(v(w.value.order?.orderId||"-"),1)]),_:1}),l(a(L),{label:"配送地址"},{default:r(()=>[f(v(w.value.order?.address?.detailedAddress||"-"),1)]),_:1}),l(a(L),{label:"收货人姓名"},{default:r(()=>[f(v(w.value.order?.address?.receiverName||"-"),1)]),_:1}),l(a(L),{label:"收货人电话"},{default:r(()=>[f(v(w.value.order?.address?.receiverPhone||"-"),1)]),_:1}),l(a(L),{label:"订单金额"},{default:r(()=>[f("￥"+v(w.value.order?.orderAmount||0),1)]),_:1}),l(a(L),{label:"创建时间"},{default:r(()=>[f(v(w.value.order?.createAt||"-"),1)]),_:1}),l(a(L),{label:"订单状态"},{default:r(()=>[l(a(ce),{type:V[w.value.acceptedStatus||0]?.type||"default",size:"small"},{default:r(()=>[f(v(V[w.value.acceptedStatus||0]?.text||"未知"),1)]),_:1},8,["type"])]),_:1})]),_:1}),e[35]||(e[35]=n("div",{class:"mt-16px text-center text-gray-500"},[n("p",null,"详细分配信息加载中...")],-1))])):z.value?($(),M("div",ea,e[36]||(e[36]=[n("p",{class:"text-gray-500"},"正在加载订单详情...",-1)]))):O("",!0)]),_:1},8,["show","loading"]),l(a(ie),{show:W.value,"onUpdate:show":e[13]||(e[13]=t=>W.value=t),preset:"card",title:"路线规划",class:"w-[700px]"},{default:r(()=>[n("div",ta,[l(a(Re),{"label-placement":"left","label-width":80},{default:r(()=>[l(a(le),{label:"起点"},{default:r(()=>[l(De,{"model-value":Q.value,"onUpdate:modelValue":e[9]||(e[9]=t=>Q.value=t),placeholder:"请输入起点地址",city:"北京",location:`${x.value.longitude},${x.value.latitude}`,onSelect:je},null,8,["model-value","location"])]),_:1}),l(a(le),{label:"终点"},{default:r(()=>[l(De,{"model-value":Z.value,"onUpdate:modelValue":e[10]||(e[10]=t=>Z.value=t),placeholder:"请输入终点地址",city:"北京",location:`${x.value.longitude},${x.value.latitude}`,onSelect:Je},null,8,["model-value","location"])]),_:1}),l(a(le),{label:"路线类型"},{default:r(()=>[l(a(Ie),{value:H.value.routeType,"onUpdate:value":e[11]||(e[11]=t=>H.value.routeType=t),options:pe},null,8,["value"])]),_:1})]),_:1}),T.value||P.value?($(),M("div",aa,[e[39]||(e[39]=n("h4",{class:"text-sm font-medium mb-8px text-gray-700"},"已选择地址：",-1)),T.value?($(),M("div",la,[e[37]||(e[37]=n("span",{class:"font-medium"},"起点：",-1)),f(v(Q.value)+" ",1),n("span",sa," ("+v(T.value.longitude.toFixed(6))+", "+v(T.value.latitude.toFixed(6))+") ",1)])):O("",!0),P.value?($(),M("div",oa,[e[38]||(e[38]=n("span",{class:"font-medium"},"终点：",-1)),f(v(Z.value)+" ",1),n("span",na," ("+v(P.value.longitude.toFixed(6))+", "+v(P.value.latitude.toFixed(6))+") ",1)])):O("",!0)])):O("",!0),n("div",ra,[l(a(I),{onClick:e[12]||(e[12]=t=>{W.value=!1,qe()})},{default:r(()=>e[40]||(e[40]=[f("取消")])),_:1,__:[40]}),l(a(I),{type:"primary",onClick:We,disabled:!T.value||!P.value},{default:r(()=>e[41]||(e[41]=[f(" 规划路线 ")])),_:1,__:[41]},8,["disabled"])])])]),_:1},8,["show"]),l(a(ie),{show:q.value,"onUpdate:show":e[14]||(e[14]=t=>q.value=t),preset:"card",title:"附近服务点",class:"w-[800px]"},{default:r(()=>[m.value.nearbyServicePoints.length>0?($(),M("div",ia,[l(a(Ce),{columns:[{title:"名称",key:"name",width:150},{title:"类型",key:"type",width:100,render:t=>tt(t.type||"")},{title:"地址",key:"address",width:200},{title:"距离",key:"distance",width:100,render:t=>de(t.distance||0)},{title:"状态",key:"isOpen",width:80,render:t=>te(a(ce),{type:t.isOpen?"success":"error"},{default:()=>t.isOpen?"营业":"休息"})},{title:"评分",key:"rating",width:80,render:t=>t.rating?`${t.rating}分`:"-"},{title:"电话",key:"phone",width:120}],data:m.value.nearbyServicePoints,pagination:{pageSize:10}},null,8,["columns","data"])])):($(),M("div",ua," 暂无附近服务点 "))]),_:1},8,["show"]),l(a(ie),{show:j.value,"onUpdate:show":e[16]||(e[16]=t=>j.value=t),preset:"card",title:"导航路线确认",class:"w-[600px]"},{default:r(()=>[m.value.currentRoute?($(),M("div",da,[n("div",ca,[e[44]||(e[44]=n("h4",{class:"text-lg font-semibold mb-12px text-blue-800"},"路线信息",-1)),n("div",va,[n("div",ga,[n("div",pa,v(de(m.value.currentRoute.totalDistance)),1),e[42]||(e[42]=n("div",{class:"text-sm text-gray-600"},"总距离",-1))]),n("div",ma,[n("div",fa,v(ye(m.value.currentRoute.estimatedDuration)),1),e[43]||(e[43]=n("div",{class:"text-sm text-gray-600"},"预计时间",-1))])])]),m.value.navigationSteps.length>0?($(),M("div",ya,[e[45]||(e[45]=n("h4",{class:"text-lg font-semibold mb-12px"},"路线步骤",-1)),n("div",wa,[($(!0),M(Oe,null,Pe(m.value.navigationSteps.slice(0,5),(t,S)=>($(),M("div",{key:S,class:"flex items-center p-8px bg-gray-50 rounded-lg"},[n("div",xa,v(S+1),1),n("div",ha,[n("div",_a,v(t.instruction||"继续直行"),1),n("div",ba,v(de(t.distance||0))+" · "+v(ye(t.duration||0)),1)])]))),128)),m.value.navigationSteps.length>5?($(),M("div",ka," 还有 "+v(m.value.navigationSteps.length-5)+" 个步骤... ",1)):O("",!0)])])):O("",!0),n("div",Sa,[l(a(I),{onClick:e[15]||(e[15]=t=>j.value=!1)},{default:r(()=>e[46]||(e[46]=[f("取消")])),_:1,__:[46]}),l(a(I),{type:"primary",onClick:$e},{default:r(()=>[l(a(U),{icon:"mdi:navigation",class:"mr-1"}),e[47]||(e[47]=f(" 开始导航 "))]),_:1,__:[47]})])])):O("",!0)]),_:1},8,["show"]),l(a(ie),{show:ae.value,"onUpdate:show":e[17]||(e[17]=t=>ae.value=t),preset:"card",title:"导航中",class:"w-[400px]"},{default:r(()=>[m.value.navigationUpdate?($(),M("div",$a,[n("div",Aa,[e[48]||(e[48]=n("div",{class:"text-lg font-semibold text-blue-800 mb-8px"},"当前指令",-1)),n("div",Ia,v(m.value.navigationUpdate.nextInstruction),1)]),n("div",Ma,[n("div",Ra,[n("div",Ca,v(de(m.value.navigationUpdate.remainingDistance)),1),e[49]||(e[49]=n("div",{class:"text-sm text-gray-600"},"剩余距离",-1))]),n("div",Na,[n("div",Da,v(ye(m.value.navigationUpdate.remainingTime)),1),e[50]||(e[50]=n("div",{class:"text-sm text-gray-600"},"预计时间",-1))])]),n("div",za,[n("div",La,"当前速度: "+v(m.value.navigationUpdate.currentSpeed)+" km/h",1)]),n("div",Oa,[l(a(I),{type:"error",onClick:we},{default:r(()=>[l(a(U),{icon:"mdi:stop",class:"mr-1"}),e[51]||(e[51]=f(" 结束导航 "))]),_:1,__:[51]})])])):O("",!0)]),_:1},8,["show"])]))}}),Ka=ke(Pa,[["__scopeId","data-v-c6465a34"]]);export{Ka as default};
