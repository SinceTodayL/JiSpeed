# 外卖配送与管理系统

2025 年 7 月

同济大学计算机科学与技术学院数据库课程设计项目

# api与通用响应体规范

### (1) API 路径规范：资源使用复数，并明确 GET, POST, PATCH, DELETE 的使用场景

**正规化表述：**

API 路径应遵循 **RESTful 风格**，以清晰、可预测的方式表示对资源的操作。

1. **基础路径：** 所有 API 路径统一以 `/api/` 开头，作为后端服务的入口标识。
2. **资源命名：** 资源名称应使用**小写复数名词**，简洁明了地描述所操作的实体。例如：`users` (用户), `products` (商品), `orders` (订单)。
3. **资源层级：** 通过斜杠 `/` 来表示资源的层级关系。
   - 例如：`/api/orders/{orderId}/items` 表示获取某个订单下的所有商品项。
4. **HTTP 方法（动词）语义化：** 利用 HTTP 方法的语义来表达对资源的**操作类型**，而不是在路径中包含动词。
   - **GET (获取资源)：**
     - 用于**检索**一个或多个资源，不应引起服务器端状态的改变。
     - **幂等性：** 多次执行相同的 GET 请求，结果始终相同。
     - **安全性：** 不会改变服务器状态。
   - **POST (创建资源)：** 用于在服务器上**创建**新资源。
     - 通常请求体包含要创建资源的完整或部分数据。
     - **非幂等性：** 多次执行可能创建多个相同的资源。
   - **PATCH (部分更新资源)：** 用于**部分修改**现有资源。
     - 请求体只包含需要修改的字段。
     - **非幂等性：** 多次执行相同的 PATCH 请求，可能会有不同的结果（取决于如何处理并发）。
   - **DELETE (删除资源)：** 用于**删除**指定资源。
     - **幂等性：** 多次执行相同的 DELETE 请求，资源的最终状态相同（要么已删除，要么不存在）。

**对应例子：**

| HTTP 方法 | 路径                            | 描述                                     |
| --------- | ------------------------------- | ---------------------------------------- |
| GET       | `/api/products`               | 获取所有商品列表                         |
| GET       | `/api/products/{productId}`   | 获取指定 ID 的商品详情                   |
| GET       | `/api/users/{userId}/orders`  | 获取指定用户的所有订单列表               |
| POST      | `/api/products`               | 创建一个新的商品                         |
| POST      | `/api/orders/{orderId}/items` | 在指定订单中添加新的商品项               |
| PATCH     | `/api/products/{productId}`   | 部分更新指定 ID 的商品（仅修改部分字段） |
| DELETE    | `/api/products/{productId}`   | 删除指定 ID 的商品                       |

### (2) 通用响应体 (Common Response) 规范

**正规化表述：**

所有 API 接口的响应都应遵循统一的 **JSON 格式通用响应体**，以确保前后端数据交互的一致性和可预测性。

**通用响应体结构：**

```json
{
  "code": 0,
  "message": "操作成功",
  "data": {
    // 业务数据
  },
  "timestamp": 1678886400000 // UTC 时间戳，毫秒
}
```

## 通用响应格式字段说明

## 字段说明

● **code** (int)：
  ○ 0： 表示请求成功，业务逻辑处理无误。
  ○ 非 0： 表示请求失败或业务处理异常。具体的错误码体系定义如下。

● **message** (string)：
  ○ 对 code 的文字描述，通常是给用户或前端展示的提示信息。
  ○ 当 code 为 0 时，通常为 "操作成功" 或 "查询成功"。
  ○ 当 code 非 0 时，提供具体的错误原因描述。

● **data** (any)：
  ○ 当 code 为 0 (成功) 时，此字段包含后端返回的具体业务数据（可以是对象、数组、字符串或数字等）。
  ○ 当 code 非 0 (失败) 时，此字段通常为 null 或空对象，但有时也可包含额外的错误详情（例如参数验证失败的 errors 列表）。

● **timestamp** (long)：
  ○ 服务器响应请求的 UTC 时间戳，单位为毫秒。用于调试和日志记录。

### data 与 message 何时使用

● **data 的使用场景**： 仅当 code 为 0 (成功) 且前端需要进一步处理后端返回的业务数据时。
  ○ 例如：查询用户列表、获取订单详情、登录成功后的用户信息。

● **message 的使用场景**：
  ○ 成功提示： 当 code 为 0 但没有 data 返回（例如：删除操作、更新操作），或者需要额外提醒用户时，message 可提供成功提示（如 "删除成功", "保存成功"）。
  ○ 错误提示： 当 code 非 0 (失败) 时，message 必须提供明确的错误描述，便于前端向用户展示或进行调试。

## 错误码体系 (code 字段约定)

以下错误码体系旨在为不同类型的错误提供清晰的分类和定义，便于前后端协同处理。

### 1xxx. 通用请求/参数错误 (Client Request/Parameter Errors)

这类错误通常表示客户端发送的请求本身有问题，不符合 API 规范或业务规则。

● **1000**：通用请求错误
  ○ 描述： 当请求不符合基本规范，但没有更具体的 code 来描述时。
  ○ 示例：

```json
{ "code": 1000, "message": "无效的请求", "data": null }
```

● **1001**：参数验证失败
  ○ 描述： 请求中包含无效或不合法的参数值（例如，邮箱格式错误、年龄超出范围）。
  ○ 建议： 配合 errors 字段返回具体的字段错误信息，方便前端定位问题。
  ○ 示例：

```json
{
  "code": 1001,
  "message": "参数验证失败",
  "data": {
    "errors": [
      { "field": "email", "message": "邮箱格式不正确" },
      { "field": "age", "message": "年龄必须在18到60岁之间" }
    ]
  }
}
```

● **1002**：缺少必填参数
  ○ 描述： 请求中缺少了必要的参数。
  ○ 示例：

```json
{ "code": 1002, "message": "缺少必填参数: 'username'", "data": null }
```

● **1003**：请求格式错误
  ○ 描述： 请求体不是合法的 JSON/XML 格式，或 Content-Type 不匹配。
  ○ 示例：

```json
{ "code": 1003, "message": "请求体格式错误，请检查Content-Type或JSON语法", "data": null }
```

● **1004**：请求方法不支持
  ○ 描述： 对资源使用了不支持的 HTTP 方法（例如，尝试用 GET 来创建资源）。
  ○ 示例：

```json
{ "code": 1004, "message": "当前资源不支持GET方法，请使用POST", "data": null }
```

### 2xxx. 认证与授权错误 (Authentication & Authorization Errors)

这类错误与用户的身份验证和权限有关。

● **2000**：通用认证/授权失败
  ○ 描述： 认证或授权失败，但没有更具体的 code。
  ○ 示例：

```json
{ "code": 2000, "message": "认证或授权失败", "data": null }
```

● **2001**：未登录/Token 失效
  ○ 描述： 用户未提供有效的认证凭证，或者提供的 Token 已过期或无效。
  ○ 前端处理： 通常引导用户重新登录。
  ○ 示例：

```json
{ "code": 2001, "message": "登录凭证无效或已过期，请重新登录", "data": null }
```

● **2002**：权限不足
  ○ 描述： 用户已登录，但没有执行此操作的权限。
  ○ 示例：

```json
{ "code": 2002, "message": "您没有执行此操作的权限", "data": null }
```

● **2003**：账号被禁用/锁定
  ○ 描述： 用户账号因某种原因无法使用。
  ○ 示例：

```json
{ "code": 2003, "message": "您的账号已被禁用，请联系管理员", "data": null }
```

● **2004**：凭证错误
  ○ 描述： 登录时用户名或密码不正确。
  ○ 示例：

```json
{ "code": 2004, "message": "用户名或密码不正确", "data": null }
```

### 3xxx. 业务逻辑错误 (Business Logic Errors)

这类错误表示请求本身有效，但由于业务规则限制，操作无法完成。

● **3000**：通用业务错误
  ○ 描述： 业务逻辑失败，但没有更具体的 code。
  ○ 示例：

```json
{ "code": 3000, "message": "业务处理失败", "data": null }
```

● **3001**：资源已存在/重复创建
  ○ 描述： 尝试创建的资源（如用户名、手机号、商品 SKU）已存在。
  ○ 示例：

```json
{ "code": 3001, "message": "该手机号已被注册", "data": null }
```

● **3002**：资源不存在
  ○ 描述： 尝试访问或操作的资源（如用户 ID、订单 ID）不存在。
  ○ 示例：

```json
{ "code": 3002, "message": "订单号不存在", "data": null }
```

● **3003**：库存不足
  ○ 描述： 尝试购买的商品库存不足。
  ○ 示例：

```json
{ "code": 3003, "message": "商品'牛奶'库存不足", "data": null }
```

● **3004**：状态不正确
  ○ 描述： 资源当前状态不允许执行此操作（例如，已完成的订单不能取消，已发货的订单不能修改地址）。
  ○ 示例：

```json
{ "code": 3004, "message": "订单已完成，无法取消", "data": null }
```

● **3005**：余额不足
  ○ 描述： 用户账户余额不足以支付。
  ○ 示例：

```json
{ "code": 3005, "message": "您的账户余额不足，请充值", "data": null }
```

● **3006**：操作过于频繁
  ○ 描述： 短时间内请求次数过多，触发限流机制。
  ○ 示例：

```json
{ "code": 3006, "message": "操作过于频繁，请稍后再试", "data": null }
```

### 5xxx. 系统/服务内部错误 (System/Service Internal Errors)

这类错误通常表示后端服务在处理请求时发生了意料之外的问题，通常与服务器本身或其依赖的服务有关。

● **5000**：通用系统错误
  ○ 描述： 服务器内部发生未知错误，通常是未捕获的异常。
  ○ 前端处理： 通常提示"系统繁忙，请稍后再试"，避免直接暴露后端错误信息。
  ○ 示例：

```json
{ "code": 5000, "message": "系统繁忙，请稍后再试", "data": null }
```

● **5001**：数据库操作失败
  ○ 描述： 数据库连接、查询、写入等操作失败。
  ○ 示例：

```json
{ "code": 5001, "message": "数据库服务异常，请稍后再试", "data": null }
```

● **5002**：第三方服务调用失败
  ○ 描述： 后端服务在调用外部依赖（如支付网关、短信服务、地图 API）时发生错误。
  ○ 示例：

```json
{ "code": 5002, "message": "支付服务暂不可用，请稍后再试", "data": null }
```

● **5003**：服务熔断/降级
  ○ 描述： 某个后端服务因过载或故障而熔断或降级，无法提供服务。
  ○ 示例：

```json
{ "code": 5003, "message": "核心服务过载，部分功能暂时受限", "data": null }
```
