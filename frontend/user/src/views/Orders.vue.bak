<template>
  <div class="orders-page">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="header">
      <button @click="goBack" class="back-btn">
        <i class="back-icon">â†</i>
      </button>
      <h1 class="header-title">æˆ‘çš„è®¢å•</h1>
    </div>

    <!-- è®¢å•çŠ¶æ€ç­›é€‰ -->
    <div class="status-filter">
      <div 
        v-for="status in orderStatuses"
        :key="status.value"
        :class="['filter-item', { active: activeStatus === status.value }]"
        @click="filterByStatus(status.value)"
      >
        <span class="filter-text">{{ status.label }}</span>
      </div>
    </div>

    <!-- è®¢å•åˆ—è¡¨ -->
    <div class="orders-container">
      <!-- åŠ è½½çŠ¶æ€ -->
      <div v-if="loading" class="loading-container">
        <div class="loading-spinner"></div>
        <p>æ­£åœ¨åŠ è½½è®¢å•...</p>
      </div>

      <!-- è®¢å•åˆ—è¡¨ -->
      <div v-else-if="orders.length > 0" class="orders-grid">
        <div 
          v-for="order in orders"
          :key="order.orderId"
          class="order-card"
          @click="viewOrderDetail(order.orderId)"
        >
          <!-- è®¢å•å¤´éƒ¨ -->
          <div class="order-header">
            <div class="merchant-info center">
              <img 
                :src="order.merchantLogo || getRandomMerchantImage(order.orderId, order.merchantName)"
                :alt="order.merchantName"
                class="merchant-logo"
              />
              <span class="merchant-name">{{ order.merchantName }}</span>
              <div class="order-time">{{ formatTime(order.createAt) }}</div>
            </div>
            <div class="header-right">
              <div class="order-status">
                <span :class="['status-text', getStatusClass(order.orderStatus)]">
                  {{ order.orderStatusText }}
                </span>
              </div>
            </div>
          </div>

          <!-- è®¢å•å•†å“ -->
          <div class="order-items">
            <div 
              v-for="(item, index) in order.orderItems"
              :key="item.dishId"
              class="order-item"
            >
              <img 
                :src="item.coverUrl || '/api/placeholder/60/60'"
                :alt="item.dishName"
                class="item-image"
              />
              <div class="item-info">
                <div class="item-name">{{ item.dishName }}</div>
                <div class="item-meta">
                  <span class="item-price">Â¥{{ item.price }}</span>
                  <span class="item-quantity">Ã—{{ item.quantity }}</span>
                </div>
              </div>
            </div>
            <!-- æ›´å¤šå•†å“æç¤º -->
            <div v-if="(order.orderDishes && order.orderDishes.length > 2)" class="more-items">
              è¿˜æœ‰{{ order.orderDishes.length - 2 }}ä»¶å•†å“
            </div>
          </div>

          <!-- è®¢å•åº•éƒ¨ -->
          <div class="order-footer">
            <div class="order-info">
              <div class="order-amount">
                <div class="order-amount center">
                  å…±{{ order.itemsCount }}ä»¶å•†å“ å®ä»˜Â¥{{ order.finalAmount }}
                </div>
              </div>
            </div>
            
            <div class="order-actions">
              <button 
                v-if="order.orderStatus === 0"
                @click.stop="payOrder(order)"
                class="action-btn primary"
              >
                ç«‹å³æ”¯ä»˜
              </button>
              
              <button 
                v-if="order.orderStatus === 1"
                @click.stop="confirmOrder(order.orderId)"
                class="action-btn primary"
              >
                ç¡®è®¤æ”¶è´§
              </button>
              
              <button 
                v-if="[0].includes(order.orderStatus)"
                @click.stop="cancelOrder(order.orderId)"
                class="action-btn secondary"
              >
                å–æ¶ˆè®¢å•
              </button>
              
              <button 
                v-if="order.orderStatus === 2"
                @click.stop="reviewOrder(order.orderId)"
                class="action-btn secondary"
              >
                è¯„ä»·
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ç©ºçŠ¶æ€ -->
      <div v-else class="empty-state">
        <div class="empty-icon">ğŸ“‹</div>
        <p class="empty-text">æš‚æ— è®¢å•</p>
        <button @click="goShopping" class="shop-btn">å»ä¸‹å•</button>
      </div>
    </div>

    <!-- åˆ†é¡µåŠ è½½ -->
    <div v-if="hasMore && !loading" class="load-more">
      <button @click="loadMore" class="load-more-btn">åŠ è½½æ›´å¤š</button>
    </div>
  </div>
</template>
